<html>
  <head>
    <meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>spring | zuolinlin</title>
<link rel="shortcut icon" href="https://zuolinlin.github.io/zuo.github.io//favicon.ico?v=1651563126192">
<link href="https://cdn.jsdelivr.net/npm/remixicon@2.3.0/fonts/remixicon.css" rel="stylesheet">
<link rel="stylesheet" href="https://zuolinlin.github.io/zuo.github.io//styles/main.css">
<link rel="alternate" type="application/atom+xml" title="spring | zuolinlin - Atom Feed" href="https://zuolinlin.github.io/zuo.github.io//atom.xml">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Droid+Serif:400,700">



    <meta name="description" content="spring
ç›®å½•

ç²¾é€‰é¢è¯•é¢˜ï¼šSpringIOCå®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹

IOCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ
Resourceå®šä½
è½½å…¥BeanDefinition
å°†BeanDefinitionæ³¨å†Œåˆ°å®¹å™¨


SpringIOCä¾èµ–æŸ¥æ‰¾

æ ¹æ®Beanåç§°..." />
    <meta name="keywords" content="æ¡†æ¶" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">
    <script src="https://cdn.bootcss.com/highlight.js/9.12.0/highlight.min.js"></script>
  </head>
  <body>
    <div class="main">
      <div class="main-content">
        <div class="site-header">
  <a href="https://zuolinlin.github.io/zuo.github.io/">
  <img class="avatar" src="https://zuolinlin.github.io/zuo.github.io//images/avatar.png?v=1651563126192" alt="">
  </a>
  <h1 class="site-title">
    zuolinlin
  </h1>
  <p class="site-description">
    æœ‰äº›äººå¹¶ä¸æ˜¯ä½ çš„èŠ±ï¼Œä½ åªæ˜¯é€”å¾„äº†å®ƒçš„ç»½æ”¾ğŸŒ¹ã€‚
  </p>
  <div class="menu-container">
    
      
        <a href="https://zuolinlin.github.io/zuo.github.io/" class="menu">
          é¦–é¡µ
        </a>
      
    
      
        <a href="https://zuolinlin.github.io/zuo.github.io/archives" class="menu">
          å½’æ¡£
        </a>
      
    
      
        <a href="https://zuolinlin.github.io/zuo.github.io/tags" class="menu">
          æ ‡ç­¾
        </a>
      
    
      
        <a href="https://zuolinlin.github.io/zuo.github.io/post/about" class="menu">
          å…³äº
        </a>
      
    
  </div>
  <div class="social-container">
    
      
    
      
    
      
    
      
    
      
    
  </div>
</div>

        <div class="post-detail">
          <article class="post">
            <h2 class="post-title">
              spring
            </h2>
            <div class="post-info">
              <span>
                2022-04-08
              </span>
              <span>
                109 min read
              </span>
              
                <a href="https://zuolinlin.github.io/zuo.github.io/tag/DTrX5zKuV/" class="post-tag">
                  # æ¡†æ¶
                </a>
              
            </div>
            
              <img class="post-feature-image" src="https://gimg2.baidu.com/image_search/src=http%3A%2F%2Fjava.tedu.cn%2Fupload%2F20180306%2F20180306104159_146.jpg&amp;refer=http%3A%2F%2Fjava.tedu.cn&amp;app=2002&amp;size=f9999,10000&amp;q=a80&amp;n=0&amp;g=0n&amp;fmt=auto?sec=1652016331&amp;t=fecbda1428feac86c4b318dee3f61830" alt="">
            
            <div class="post-content-wrapper">
              <div class="post-content">
                <h1 id="spring">spring</h1>
<h2 id="ç›®å½•">ç›®å½•</h2>
<ul>
<li><a href="#%E7%B2%BE%E9%80%89%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9ASpringIOC%E5%AE%B9%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B">ç²¾é€‰é¢è¯•é¢˜ï¼šSpringIOCå®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹</a>
<ul>
<li><a href="#IOC%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84">IOCæ˜¯å¦‚ä½•å·¥ä½œçš„ï¼Ÿ</a></li>
<li><a href="#Resource%E5%AE%9A%E4%BD%8D">Resourceå®šä½</a></li>
<li><a href="#%E8%BD%BD%E5%85%A5BeanDefinition">è½½å…¥BeanDefinition</a></li>
<li><a href="#%E5%B0%86BeanDefinition%E6%B3%A8%E5%86%8C%E5%88%B0%E5%AE%B9%E5%99%A8">å°†BeanDefinitionæ³¨å†Œåˆ°å®¹å™¨</a></li>
</ul>
</li>
<li><a href="#SpringIOC%E4%BE%9D%E8%B5%96%E6%9F%A5%E6%89%BE">SpringIOCä¾èµ–æŸ¥æ‰¾</a>
<ul>
<li><a href="#%E6%A0%B9%E6%8D%AEBean%E5%90%8D%E7%A7%B0%E6%9F%A5%E6%89%BE">æ ¹æ®Beanåç§°æŸ¥æ‰¾</a></li>
<li><a href="#%E6%A0%B9%E6%8D%AEBean%E7%B1%BB%E5%9E%8B%E6%9F%A5%E6%89%BE">æ ¹æ®Beanç±»å‹æŸ¥æ‰¾</a></li>
<li><a href="#%E4%BE%9D%E8%B5%96%E6%9F%A5%E6%89%BE%E4%B8%AD%E7%9A%84%E7%BB%8F%E5%85%B8%E5%BC%82%E5%B8%B8%EF%BC%9ABean%E6%89%BE%E4%B8%8D%E5%88%B0%EF%BC%9FBean%E4%B8%8D%E6%98%AF%E5%94%AF%E4%B8%80%E7%9A%84%EF%BC%9F">ä¾èµ–æŸ¥æ‰¾ä¸­çš„ç»å…¸å¼‚å¸¸ï¼šBeanæ‰¾ä¸åˆ°ï¼ŸBeanä¸æ˜¯å”¯ä¸€çš„ï¼Ÿ</a></li>
</ul>
</li>
<li>[æºç å‰–æï¼šSpring IOCå®¹å™¨Beanåˆå§‹åŒ–æµç¨‹ï¼Ÿ](#æºç å‰–æï¼šSpring IOCå®¹å™¨Beanåˆå§‹åŒ–æµç¨‹ï¼Ÿ)</li>
<li><a href="#SpringIOC%E4%BE%9D%E8%B5%96%E6%9F%A5%E6%B3%A8%E5%85%A5">SpringIOCä¾èµ–æŸ¥æ³¨å…¥</a></li>
<li><a href="#%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90%EF%BC%9A@Autowire%E6%B3%A8%E8%A7%A3%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E7%9A%84%E5%8E%9F%E7%90%86">æºç å‰–æï¼š@Autowireæ³¨è§£ä¾èµ–æ³¨å…¥çš„åŸç†</a></li>
<li><a href="#%E7%B2%BE%E9%80%89%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9A@Autowire%E5%92%8C@Resource%E5%8C%BA%E5%88%AB">ç²¾é€‰é¢è¯•é¢˜ï¼š@Autowireå’Œ@ResourceåŒºåˆ«</a></li>
<li>[Spring IOCä¾èµ–æ¥æºæœ‰å“ªäº›ï¼Ÿ](#Spring IOCä¾èµ–æ¥æºæœ‰å“ªäº›ï¼Ÿ)</li>
<li>[ç²¾é€‰é¢è¯•é¢˜ï¼š@Valueæ˜¯å¦‚ä½•å°†å¤–éƒ¨åŒ–é…ç½®æ³¨å…¥åˆ°spring beanä¸­ï¼Ÿ](#ç²¾é€‰é¢è¯•é¢˜ï¼š@Valueæ˜¯å¦‚ä½•å°†å¤–éƒ¨åŒ–é…ç½®æ³¨å…¥åˆ°spring beanä¸­ï¼Ÿ)</li>
<li>[ç²¾é€‰é¢è¯•é¢˜ï¼šspring IOCå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼Ÿ](#ç²¾é€‰é¢è¯•é¢˜ï¼šspring IOCå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼Ÿ)</li>
<li><a href="#JDK%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%92%8CCGLIB%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†</a></li>
<li>[_Aspectã€Join Pointsã€Pointcuts å’Œ Advice è¯­æ³•](#Aspectã€Join Pointsã€Pointcutså’ŒAdviceè¯­æ³•)</li>
<li>[_æºç åˆ†æï¼šSpring AOP JDKåŠ¨æ€ä»£ç†å®ç°åŸç†](#_æºç åˆ†æï¼šSpring AOP JDKåŠ¨æ€ä»£ç†å®ç°åŸç†)</li>
<li>[ç²¾é€‰é¢è¯•é¢˜ï¼šSpring AOPå’ŒAspectJ AOPå­˜åœ¨å“ªäº›åŒºåˆ«ï¼Ÿ](#ç²¾é€‰é¢è¯•é¢˜ï¼šSpring AOPå’ŒAspectJ AOPå­˜åœ¨å“ªäº›åŒºåˆ«ï¼Ÿ)</li>
<li><a href="#%E5%BC%95%E5%85%A5logback%E6%A1%86%E6%9E%B6%E8%BF%9B%E8%A1%8C%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0">å¼•å…¥logbackæ¡†æ¶è¿›è¡Œæ—¥å¿—æ‰“å°</a></li>
<li><a href="#@Aspect%E6%B3%A8%E8%A7%A3%E6%98%AF%E6%80%8E%E4%B9%88%E8%BF%90%E4%BD%9C%E8%B5%B7%E6%9D%A5%E7%9A%84">@Aspectæ³¨è§£æ˜¯æ€ä¹ˆè¿ä½œèµ·æ¥çš„</a></li>
<li>[_ä»£ç å®æˆ˜ï¼šåŸºäºSpring AOPæœºåˆ¶ï¼Œå®ç°å…¨å±€å¼‚å¸¸å¤„ç†](#_ä»£ç å®æˆ˜ï¼šåŸºäºSpring AOPæœºåˆ¶ï¼Œå®ç°å…¨å±€å¼‚å¸¸å¤„ç†)</li>
<li>[åŸºäºSpring AOPæœºåˆ¶æ‹¦æˆªå¤„ç†ç™»é™†ä¿¡æ¯](#åŸºäºSpring AOPæœºåˆ¶æ‹¦æˆªå¤„ç†ç™»é™†ä¿¡æ¯)</li>
<li>[ç²¾é€‰é¢è¯•é¢˜ï¼šSpring AOPçš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ](#ç²¾é€‰é¢è¯•é¢˜ï¼šSpring AOPçš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ)</li>
<li><a href="#%E5%85%88%E6%9D%A5%E7%9C%8B%E7%9C%8B%E5%8E%9F%E7%94%9FJDBC%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C">å…ˆæ¥çœ‹çœ‹åŸç”Ÿ JDBC å¦‚ä½•è¿›è¡Œæ•°æ®åº“æ“ä½œ</a></li>
<li><a href="#%E5%9F%BA%E4%BA%8EDruid%E8%BF%9E%E6%8E%A5%E6%B1%A0%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%EF%BC%8C%E6%8F%90%E5%8D%87%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD">åŸºäº Druid è¿æ¥æ± è¿›è¡Œæ•°æ®æ“ä½œï¼Œæå‡ç³»ç»Ÿæ€§èƒ½</a></li>
<li><a href="#SpringEvent%E4%BA%8B%E4%BB%B6%E9%80%9A%E7%9F%A5%E6%9C%BA%E5%88%B6%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86">Spring Eventäº‹ä»¶é€šçŸ¥æœºåˆ¶åº•å±‚åŸç†</a></li>
<li>[ç©è½¬Spring Cacheä¸­@Cacheableæ³¨è§£çš„åº•å±‚åŸç†](#ç©è½¬Spring Cacheä¸­@Cacheableæ³¨è§£çš„åº•å±‚åŸç†)</li>
<li><a href="#%E7%B2%BE%E9%80%89%E9%9D%A2%E8%AF%95%E9%A2%98%EF%BC%9A%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E5%AF%BC%E8%87%B4Spring%E4%BA%8B%E5%8A%A1%E5%A4%B1%E6%95%88%EF%BC%9F">ç²¾é€‰é¢è¯•é¢˜ï¼šä»€ä¹ˆæƒ…å†µå¯¼è‡´Springäº‹åŠ¡å¤±æ•ˆï¼Ÿ</a></li>
</ul>
<h1 id="ç›®å½•-2">ç›®å½•</h1>
<h2 id="ç²¾é€‰é¢è¯•é¢˜springiocå®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹">ç²¾é€‰é¢è¯•é¢˜ï¼šSpringIOCå®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹</h2>
<h3 id="iocæ˜¯å¦‚ä½•å·¥ä½œçš„">IOCæ˜¯å¦‚ä½•å·¥ä½œçš„</h3>
<pre><code class="language-java">
ApplicationContext appContext=new ClassPathXmlApplicationContext(&quot;/bean.xml&quot;);
        User user=(User)appContext.getBean(&quot;user&quot;);

</code></pre>
<pre><code>å¦‚ä¸Šè¿°ä»£ç æ‰€ç¤ºï¼Œé€šè¿‡ApplicationContext åˆ›å»ºSpringå®¹å™¨ï¼Œè¯¥å®¹å™¨ä¼šè¯»å–é…ç½®æ–‡ä»¶ &quot;/bean.xml&quot;,
å¹¶ç»Ÿä¸€ç®¡ç†ç”±è¯¥æ–‡ä»¶ä¸­å®šä¹‰å¥½çš„Beanå®ä¾‹å¯¹è±¡ï¼Œå¦‚æœè¦è·å–æŸä¸ªbeanå®ä¾‹ï¼Œä½¿ç”¨getBeanæ–¹æ³•å°±è¡Œäº†ï¼Œ
å‡è®¾å°†useré…ç½®åœ¨beans.xmlæ–‡ä»¶ä¸­ï¼Œä¹‹åå°±ä¸éœ€è¦ä½¿ç”¨new User()çš„æ–¹å¼åˆ›å»ºå¯¹è±¡ï¼Œ
è€Œæ˜¯é€šè¿‡ApplicationContext å®¹å™¨æ¥è·å–Userçš„å®ä¾‹
</code></pre>
<p>å‰–æåˆ›å»ºIOCå®¹å™¨è¦ç»å†çš„å‡ ä¸ªé˜¶æ®µï¼š Resourceå®šä½ã€è½½å…¥BeanDefinitionã€å°†BeanDefinitionæ³¨å†Œåˆ°å®¹å™¨</p>
<h4 id="resourceå®šä½">Resourceå®šä½</h4>
<pre><code>Resourceå®šä½æ˜¯Springä¸­ç”¨äºå°è£…I/Oæ“ä½œçš„æ¥å£ã€‚åœ¨åˆ›å»ºSpringå®¹å™¨æ—¶ï¼Œä¼šå»è®¿é—®xmlé…ç½®æ–‡ä»¶ï¼Œè¿˜å¯ä»¥é€šè¿‡æ–‡ä»¶ç±»å‹
ã€äºŒè¿›åˆ¶ç•™ã€URLç­‰æ–¹å¼è®¿é—®èµ„æºã€‚è¿™äº›éƒ½å¯ä»¥ç†è§£ä¸ºResourceã€‚å…¶ä½“ç³»ç»“æ„å¦‚ä¸‹å¦‚æ‰€ç¤ºï¼š
</code></pre>
<ul>
<li>
<p>FileSystemResourceï¼šä»¥æ–‡ä»¶ç»å¯¹è·¯å¾„è®¿é—®èµ„æº</p>
</li>
<li>
<p>ClassPathResourceï¼šä»¥ç±»è·¯å¾„çš„æ–¹å¼è®¿é—®èµ„æº</p>
</li>
<li>
<p>ServletContextResourceï¼šwebåº”ç”¨æ ¹ç›®å½•çš„æ–¹å¼è®¿é—®èµ„æº</p>
</li>
<li>
<p>UrlResourceï¼šè®¿é—®ç½‘ç»œèµ„æºçš„å®ç°ç±»</p>
</li>
<li>
<p>ByteArrayResource:è®¿é—®å­—èŠ‚æ•°ç»„èµ„æºçš„å®ç°ç±»</p>
<pre><code>é‚£ä¹ˆè¿™äº›ç±»å‹åœ¨Springä¸­æ˜¯å¦‚ä½•è®¿é—®çš„å‘¢ï¼ŸSpring æä¾›äº†ResourceLoaderæ¥å£ç”¨äºå®ç°ä¸åŒçš„ResourceåŠ è½½ç­–ç•¥ï¼Œ
è¯¥æ¥å£çš„å®ä¾‹å¯¹è±¡ä¸­å¯ä»¥è·å–ä¸€ä¸ªresourceå¯¹è±¡ã€‚
å¦‚ä¸‹ä»£ç æ‰€ç¤º,åœ¨ResourceLoaderæ¥å£ä¸­åªå®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•ï¼š
</code></pre>
</li>
</ul>
<pre><code class="language-java">
public ResourceLoader{
        //é€šè¿‡æä¾›çš„èµ„æºlocationå‚æ•°è·å–Resource å®ä¾‹
        Resource getResource(String location);

// è·å–ClassLoaderï¼Œé€šè¿‡ClassLoaderå¯å°†èµ„æºè½½å…¥åˆ°JVM
        ClassLoader getClassLoader(String location);

        }


</code></pre>
<p>æ³¨ï¼š</p>
<pre><code>   ApplicationContextå¾·æ‰€æœ‰å®ç°ç±»éƒ½å®ç°ResourceLoaderæ¥å£ï¼Œå› æ­¤å¯ä»¥ç›´æ¥è°ƒç”¨getResource(location)è·å–Resource å¯¹è±¡ï¼Œã€‚
   ä¸åŒçš„ApplicationContextå®ç°ç±»ä½¿ç”¨getResourceæ–¹æ³•è·å–èµ„æºç±»å‹ä¸åŒã€‚
   ä¾‹å¦‚ï¼š
    FileSystemXmlApplicationContent.getResourceè·å–çš„å°±æ˜¯FileSystemResourceå®ä¾‹
    ClassPathXmlApplicationContext.getResourceè·å–çš„å°±æ˜¯ClassPathResourceå®ä¾‹
    XmlWebApplicationContent.getResourceè·å–çš„å°±æ˜¯ClassPathResourceå®ä¾‹
     å¦å¤–åƒä¸éœ€è¦é€šè¿‡xmlç›´æ¥ä½¿ç”¨æ³¨è§£@Configurationæ–¹å¼åŠ è½½èµ„æºçš„AnnotationConfigApplicationContextç­‰ç­‰
</code></pre>
<p>åœ¨èµ„æºå®šä½è¿‡ç¨‹å®Œæˆä»¥åï¼Œå°±ä¸ºèµ„æºæ–‡ä»¶ä¸­çš„beançš„è½½å…¥åˆ›é€ äº†I/Oæ“ä½œçš„æ¡ä»¶ã€‚</p>
<h4 id="è½½å…¥beandefinition">è½½å…¥BeanDefinition</h4>
<p>å¦‚ä½•è¯»å–èµ„æºä¸­å¾·æ•°æ®------BeanDefinitionçš„è½½å…¥è¿‡ç¨‹ä¸­çš„æè¿°</p>
<pre><code>BeanDefinitionæ˜¯ä¸€ä¸ªæ•°æ®ç»“æ„ï¼ŒBeanDefinitionæ˜¯æ ¹æ®Resourceå¯¹è±¡ä¸­beanæ¥ç”Ÿæˆçš„ã€‚beanä¼šåœ¨SpringIocå®¹å™¨å†…éƒ¨ä»¥BeanDefinitionçš„å½¢å¼å­˜åœ¨ï¼Œ
Iocå®¹å™¨å¯¹Beançš„ç®¡ç†å’Œä¾èµ–æ³¨å…¥çš„å®ç°æ˜¯é€šè¿‡BeanDefinitionæ¥å®Œæˆçš„ã€‚BeanDefinitionå°±æ˜¯Beanåœ¨Iocå®¹å™¨ä¸­çš„å­˜åœ¨å½¢å¼ã€‚

ç”±äºSpringçš„é…ç½®æ–‡ä»¶ä¸»è¦æ˜¯XMLæ ¼å¼ï¼Œä¸€èˆ¬è€Œè¨€ä¼šä½¿ç”¨AbstractXmlApplicationContextç±»è¿›è¡Œæ–‡ä»¶è¯»å–ï¼Œå¦‚å›¾ï¼Œè¯¥ç±»å®šä¹‰äº†ä¸€ä¸ªåä¸º
loadBeanDefinition(DefaultListableBeanFactory beanFactory)çš„æ–¹æ³•æ¥è·å–BeanDefinition

æ–¹æ³•å†…ä¼šnew ä¸€ä¸ªBeanDefinitionReaderå¯¹è±¡ï¼Œç„¶åå°†ç”Ÿæˆçš„å®ä¾‹ä¼ å…¥loadBeanDefinitionæ–¹æ³•
</code></pre>
<pre><code class="language-java">
import java.io.IOException;

public class AbstractXmlApplicationContext {

    //è·å–BeanDefinition
    protected void loadBeanDefinition(DefaultListableBeanFactory beanFactory) throws BeanException, IOException {

        XmlBeanDefinitionReader beanDefinitionReader = new XmlBeanDefinitionReader(beanFactory);
        beanDefinitionReader.setEnvironment(this.getEnvironment());
        beanDefinitionReader.setResourceLoader(this);
        beanDefinitionReader.setEntityResolver(new ResourceEntityResolver(this));
        //ç”¨äºè·å–BeanDefinition
        this.loadBeanDefinitions(beanDefinitionReader);
    }

    protected void loadBeanDefinitions(XmlBeanDefinitionReader reader) throws BeanException, IOException {
        //è·å–æ‰€æœ‰å®šä½åˆ°çš„resourceèµ„æºå®šä½ï¼ˆç”¨æˆ·å®šä¹‰ï¼‰
        Resource[] configResources = getConfigResources();
        if (configResources != null) {
            //è½½å…¥resource
            reader.loadBeanDefinitions(configResources);
        }
        //è·å–æ‰€æœ‰æœ¬åœ°é…ç½®æ–‡ä»¶çš„ä½ç½®ï¼ˆå®¹å™¨æœ¬èº«ï¼‰
        String[] configLocations = getConfigLocations();
        if (configLocations != null) {
            //è½½å…¥resource
            reader.loadBeanDefinitions(configLocations);
        }
    }
}

</code></pre>
<p>é¡ºç€çœ‹readerä¸­loadBeanDefinitionsæ–¹æ³•ï¼Œè¯¥æ–¹æ³•overrideäº†AbstractBeanDefinitionReaderç±»ï¼Œçˆ¶æ¥å£çš„BeanDefinitionReaderã€‚<br>
æ–¹æ³•ä½“ä¸­ï¼Œå°†æ‰€æœ‰èµ„æºå…¨éƒ¨åŠ è½½ï¼Œå¹¶ä¸”äº¤ç»™AbstractBeanDefinitionReaderçš„å®ç°å­ç±»å¤„ç†è¿™äº›resourceã€‚</p>
<pre><code class="language-java">
public class AbstractBeanDefinitionReader extends BeanDefinitionReader {

    @Override
    public int loadBeanDefinitions(Resource... resources) throws BeanDefinitionStoreException {
        Assert. assert (resources,&quot;Resource array must not be null&quot;);
        int counter = 0;
        for (Resource resource : resources) {
            //å°†æ‰€æœ‰èµ„æºå…¨éƒ¨åŠ è½½ï¼Œäº¤ç»™AbstractBeanDefinitionReaderçš„å®ç°å­ç±»å¤„ç†è¿™ä¸ªresource
            counter += loadBeanDefinitions(resource);
        }
        return counter;
    }

}



</code></pre>
<p>å†BeanDefinitionReader æ¥å£ä¸­å®šä¹‰äº† int loadBeanDefinitions(Resource resource) æ–¹æ³•</p>
<pre><code class="language-java">public interface BeanDefinitionReader {

    int loadBeanDefinition(Resource Resource) throws BeanDefinitionStoreException;

    int loadBeanDefinition(Resource... Resource) throws BeanDefinitionStoreException;
}

</code></pre>
<p>æ­¤æ—¶å›åˆ°XmlBeanDefinitionReaderä¸Šæ¥,å®ƒä¸»è¦æ˜¯é’ˆå¯¹XMLæ–¹å¼çš„Beanè¿›è¡Œè¯»å–ï¼ŒXmlBeanDefinitionReader ä¸»è¦æ˜¯å®ç°äº†AbstractBeanDefinitionReaderæŠ½è±¡ç±»ï¼Œ<br>
è€Œè¯¥ç±»ç»§æ‰¿ä¸BeanDefinitionReaderï¼Œä¸»è¦å®ç°çš„æ–¹æ³•ä¹Ÿæ˜¯æ¥è‡ªäºBeanDefinitionReaderçš„loadBeanDefinitions(Resource) æ–¹æ³•</p>
<figure data-type="image" tabindex="1"><img src="images/XmlBeanDefinitionReader%E7%BB%A7%E6%89%BF%E5%85%B3%E7%B3%BB%E5%9B%BE.png" alt="img_1.png" loading="lazy"></figure>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œè¯»å–Beanä¹‹åå°±æ˜¯åŠ è½½Beançš„è¿‡ç¨‹äº†ï¼ŒXmlBeanDefinitionReaderä¸­çš„loadBeanDefinitionsæ–¹æ³•ä¸»è¦æ¥å¤„ç†åŠ è½½Beançš„å·¥ä½œã€‚<br>
é¦–å…ˆå¯¹èµ„æºç»è¡ŒéªŒè¯ï¼Œç„¶åä»èµ„æºå¯¹è±¡ä¸­åŠ è½½Documentå¯¹è±¡ï¼Œä½¿ç”¨äº†documentLoaderä¸­çš„loadDocumentæ–¹æ³•ï¼Œ<br>
ç„¶åè·Ÿä¸ŠregisterBeanDefinitionå¯¹æ–‡æ¡£å¯¹åº”çš„Resourceè¿›è¡Œæ³¨å†Œï¼Œä¹Ÿå°±æ˜¯å°†XMLæ–‡ä»¶ä¸­Bean è½¬æ¢æˆå®¹å™¨ä¸­BeanDefinitionã€‚</p>
<pre><code class="language-java">    public class AbstractBeanDefinitionReader {

    protected int doLoadBeanDefinitions(InPutSource inputSource, Resource Resource) throws BeanDefinitionStoreException {

        try {
            //è·å–æŒ‡å®šèµ„æºçš„éªŒè¯æ–¹æ³•
            int validation = getValidationModeFotResource(Resource);
            //å°†èµ„æºå¯¹è±¡ä¸­åŠ è½½Documentå¯¹è±¡ï¼Œå¤§è‡´è¿‡ç¨‹ä¸ºï¼šå°†Resourceèµ„æºæ–‡ä»¶çš„å†…å®¹è¯»å…¥åˆ°document
            //DocumentReader åœ¨å®¹å™¨ä¸­è¯»å–XMLæ–‡ä»¶è¿‡ç¨‹ä¸­æœ‰ç€ä¸¾è¶³è½»é‡çš„ä½œç”¨ï¼
            // XmlBeanDefinitionReaderå®ä¾‹åŒ–æ—¶ä¼šåˆ›å»ºä¸€ä¸ªDefaultDocumentLoaderå‹ç§æœ‰å±æ€§ï¼Œç»§è€Œè°ƒç”¨loadDocumentæ–¹æ³•
            // inputSource --è¦åŠ è½½çš„æ–‡æ¡£è¾“å…¥æº
            this.documentLoader.loadDocument(inputSource,
                    this.entityResolver,
                    this.errorHandler, validationMode,
                    this.namespaceAware);

            //å°†documentæ–‡ä»¶çš„beanå°è£…æˆBeanDefinitionï¼Œå¹¶æ³¨å†Œåˆ°å®¹å™¨
            return registerBeanDefinition(doc, resource);
        } catch {
            //
        }
    }


}



</code></pre>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ¥ä¸‹æ¥å°±æ˜¯registerBeanDefinitionsæ–¹æ³•äº†ï¼Œå®ƒä¸»è¦æ˜¯é’ˆå¯¹Spring Bean è¯­ä¹‰è¿›è¡Œè½¬æ¢ï¼Œå˜æˆBeanDefinitionç±»å‹ã€‚</p>
<p>é¦–å…ˆè·å–DefaultBeanDefinitionDocumentReaderå®ä¾‹ï¼Œç„¶åè·å–å®¹å™¨ä¸­çš„beanæ•°é‡ï¼Œé€šè¿‡documentReaderä¸­çš„registerBeanDefinition</p>
<p>æ–¹æ³•è¿›è¡Œæ³¨å†Œå’Œè½¬æ¢å·¥ä½œ</p>
<pre><code class="language-java">
public class XmlBeanDefinitionReader {

    public int registerBeanDefinitions(Document doc, Resource resource) throws BeanDefinitionStoreException {
        //è·å–åˆ°DefaultBeanDefinitionDocumentReaderå®ä¾‹
        BeanDefaultDocumentReader documentReader = createBeanDefinitionDocumentReader();
        //è·å–å®¹å™¨ä¸­beançš„æ•°é‡
        int countBefore = getRegister().getBeanDefinitionCount();
        documentReader.registerBeanDefinitions(doc, createReaderContext(resource));
        return getRegister().getBeanDefinitionCount() - countBefore;

    }

}


</code></pre>
<p>é¡ºç€ä¸Šé¢çš„æ€è·¯ç»§ç»­å¾€ä¸‹ï¼Œåœ¨DefaultBeanDefinitionDocumentReaderä¸­çš„registerBeanDefinitionsæ–¹æ³•å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå…¶è·å–documentçš„æ ¹æ®æ ¹èŠ‚ç‚¹ç„¶åé¡ºåŠ¿è®¿é—®æ‰€æœ‰å­èŠ‚ç‚¹ã€‚åŒæ—¶æŠŠå¤„ç†<br>
BeanDefinitionçš„è¿‡ç¨‹å§”æ‰˜ç»™BeanDefinitionParserDelegateå¯¹è±¡å®Œæˆã€‚</p>
<pre><code class="language-java">
import org.w3c.dom.Element;

public class DefaultBeanDefinitionDocumentReader implements BeanDefinitionDocumentReader {

    public void registerBeanDefinitions(Document doc, XmlReaderContext readerContext) {
        this.readerContext = readerContext;
        logger.debug(&quot;Loading bean definitions &quot;)
        // è·å–doc çš„root èŠ‚ç‚¹ ï¼Œé€šè¿‡è¯¥èŠ‚ç‚¹èƒ½å¤Ÿè®¿é—®æ‰€æœ‰å­èŠ‚ç‚¹
        Element root = doc.getDocumentElement();
        // å¤„ç†beanDefinitionçš„è¿‡ç¨‹å§”æ‰˜ç»™beanDefinitionParseDelegateå®ä¾‹å¯¹è±¡å®Œæˆ
        BeanDefinitionParseDelegate delegate = createHelper(readerContext, root);
        preProcessXml(root);
        //æ ¸å¿ƒæ–¹æ³• ä»£ç†
        parseBeanDefinitions(root, delegate);
        postProcessXml(root);

    }

    /**
     * BeanDefinitionParseDelegateç±»ä¸»è¦è´Ÿè´£BeanDefinitionçš„è§£æ
     *è¿™é‡Œæ¶‰åŠåˆ°JDKå’ŒCGLIBåŠ¨æ€ä»£ç†çš„çŸ¥è¯†
     * BeanDefinitionParseDelegatesä»£ç†å®Œå…¨å¯¹ç¬¦åˆSpringè¯­ä¹‰è§„åˆ™çš„å¤„ç†ã€‚
     * æ¯”å¦‚&lt;bean&gt;&lt;/bean&gt;ã€&lt;import&gt;&lt;/import&gt;ã€&lt;alias&gt;&lt;/alias&gt;ç­‰çš„æ£€æµ‹
     * å°±æ˜¯å¦‚ä¸‹
     * BeanDefinitionParseDelegateä»£ç†ç±»ä¸­çš„parseBeanDefinitionsæ–¹æ³•ï¼Œç”¨æ¥å¯¹XMLæ–‡ä»¶ä¸­èŠ‚ç‚¹è¿›è¡Œè§£æã€‚
     * é€šè¿‡éå†&lt;import&gt;&lt;/import&gt;æ ‡ç­¾èŠ‚ç‚¹è°ƒç”¨importBeanDefinitionResourceæ–¹æ³•å¯¹å…¶è¿›è¡Œå¤„ç†ï¼Œç„¶ååˆ©ç”¨éå†
     * beanèŠ‚ç‚¹è°ƒç”¨processBeanDefinitionå¯¹å…¶è°ƒç”¨ã€‚
     *
     */

    protected void parseBeanDefinitions(Element root, BeanDefinitionParseDelegate delegate) {
        if (delegate.isDefaultNamespace) {
            NodeList nl = root.getChildNodes();
            // éå†æ‰€æœ‰èŠ‚ç‚¹ï¼Œåšå¯¹åº”è§£æå·¥ä½œ
            // å¦‚éå†åˆ°&lt;import&gt; æ ‡ç­¾èŠ‚ç‚¹å°±è°ƒç”¨importBeanDefinitionResource(ele)æ–¹æ³•å¯¹åº”å¤„ç†
            // éå†åˆ°&lt;bean&gt; æ ‡ç­¾å°±è°ƒç”¨processBeanDefinition(ele ,delegate)æ–¹æ³•å¯¹åº”å¤„ç†
            for (int i = 0; i &lt; nl.getElementCount(); i++) {
                Node node = nl.get(i);
                if (node instanceof Element) {
                    Element ele = (Element) node;
                    if (delegate.isDefaultNamespace(ele)) {
                        parseDefaultElement(ele, delegate);
                    } else {
                        // å¤„ç†ç”¨æˆ·è‡ªå®šä¹‰èŠ‚ç‚¹çš„å¤„ç†æ–¹æ³•
                        delegate.parseCustomElement(ele);
                    }
                }
            }
        } else {
            delegate.parseCustomElement(root);
        }
    }
}


</code></pre>
<p>å¦‚å›¾ å†çœ‹parseBeanDefinitionsæ–¹æ³•ä¸­è°ƒç”¨çš„parseDefaultElementæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰å®ƒæ˜¯å¯¹èŠ‚ç‚¹å…ƒç´ è¿›è¡Œå¤„ç†ã€‚ ä»æ–¹æ³•ä½“çš„è¯­å¥å¯ä»¥çœ‹å‡ºå®ƒå¯¹<br>
importæ ‡ç­¾ã€aliasæ ‡ç­¾ã€beanæ ‡ç­¾è¿›è¡Œå¤„ç†ã€‚æ¯ç±»æ ‡ç­¾å¯¹åº”ä¸åŒçš„ BeanDefinitionçš„å¤„ç†æ–¹æ³•ã€‚</p>
<pre><code class="language-java">
private void parseDefaultElement(Element ele,BeanDefinitionParserDelegate delegate){

        // è§£æ&lt;import&gt;æ ‡ç­¾
        if(delegate.nodeNameEquals(ele,IMPORT_ELEMENT)){
        importBeanDefinitionResource(ele);
        }
        // è§£æ &lt;alias&gt; æ ‡ç­¾
        else if(delegate.nodeNameEquals(ele,ALIAS_ELEMENT)){
        processAliasRegistrations(ele);
        }
        // è§£æbeanæ ‡ç­¾
        else if(delegate.nodeNameEquals(ele,BEAN_ELEMENT)){
        processBeanDefinition(ele,delegate);
        }
        // è§£æbeans æ ‡ç­¾
        else if(delegate.nodeNameEquals(ele,NESTED_BEANS_ELEMENT)){
        // recurse
        doRegisterBeanDefinitions(ele);
        }

        }

</code></pre>
<p>åœ¨parseDefaultElement è°ƒç”¨äº†ä¼—å¤šæ–¹æ³•ä¸­ï¼Œæˆ‘ä»¬é€‰å–processBeanDefinitionæ–¹æ³•ç»™å¤§å®¶è®²è§£ã€‚è¯¥æ–¹æ³•æ˜¯ç”¨æ¥å¤„ç†Beançš„ã€‚<br>
é¦–å…ˆé€šè¿‡delegateçš„parseBeanDefaultElementæ–¹æ³•ä¼ å…¥èŠ‚ç‚¹ä¿¡æ¯ï¼Œè·å–è¯¥bean å¯¹åº”çš„nameå’Œaliasã€‚<br>
ç„¶åé€šè¿‡BeanDefinitionReaderUtilsä¸­çš„registerBeanDefinitionsæ–¹æ³•å¯¹å…¶è¿›è¡Œå®¹å™¨æ³¨å†Œï¼Œä¹Ÿå°±æ˜¯å°†Beanå®ä¾‹ æ³¨å†Œåˆ°å®¹å™¨ä¸­è¿›è¡Œç®¡ç†ã€‚æœ€åå‘é€æ³¨å†Œäº‹ä»¶ã€‚</p>
<pre><code class="language-java">
protected void processBeanDefinition(Element ele,BeanDefinitionParserDelegate delegate){
        // è¯¥å¯¹è±¡æŒæœ‰beanDefinitionçš„nameå’Œalias ï¼Œå¯ä»¥ä½¿ç”¨è¯¥å¯¹è±¡å®ŒæˆbeanDefinitionå‘å®¹å™¨æ³¨å†Œ
        BeanDefinitionHolder bHolder=delegate.parseBeanDefinitionElement(ele);
        if(bHolder!=null){
            bHolder  =  delegate.decorateBeanDefinitionElement(ele , bHolder);
            try{
                // æ³¨å†Œæœ€ç»ˆè¢«ä¿®é¥°beanå®ä¾‹ ï¼Œä¸‹æ–‡æ³¨å†ŒbeanDefinitionåˆ°å®¹å™¨ä¼šè®²è§£è¯¥æ–¹æ³•
                BeanDefinitionReaderUtils.registerBeanDefinition(bHolder ,getReaderContext().getRegister());
           }catch(BeanDefinitionStoreException ex){
                getReaderContext.error(&quot;Faild to register bean definition with me &quot; +
                    bHolder.getBeanName() +&quot;&quot; ,ele ,ex);
            );

            // å‘é€æ³¨å†Œäº‹ä»¶
           getReaderContext().fireComponentRegistered(new BeanComponentDefinition(bHolder));
        }
    }
}


</code></pre>
<p>åˆ°æ­¤å®Œæˆäº†BeanDefinitionçš„åŠ è½½å·¥ä½œ</p>
<h4 id="å°†beandefinitionæ³¨å†Œåˆ°å®¹å™¨">å°†BeanDefinitionæ³¨å†Œåˆ°å®¹å™¨</h4>
<p>åœ¨åŠ è½½Beanä¹‹åï¼Œå°±éœ€è¦å°†å…¶æ³¨å†Œåˆ°å®¹å™¨ä¸­è¿›è¡Œç®¡ç†ã€‚å¦‚å›¾æ‰€ç¤ºï¼ŒBeanä¼šè¢«è§£ææˆBeanDefinitionå¹¶äºBeanNameã€Aliasä¸€åŒå°è£…åˆ°BeanDefinitionHolderç±»ä¸­ã€‚<br>
ä¹‹åbeanFactory.registerBeanDefinitions(beanName ,bHolder.getBeanDefinition())æ–¹æ³•;</p>
<p>æ³¨å†Œåˆ°DefaultListableBeanFactory.beanDefinitionMapä¸­ã€‚å¦‚æœå®¢æˆ·ç«¯éœ€è¦è·å–beanå¯¹è±¡ï¼Œ<br>
Springå®¹å™¨ä¼šæ ¹æ®æ³¨å†Œçš„BeanDefinitionä¿¡æ¯è¿›è¡Œå®ä¾‹åŒ–ã€‚</p>
<pre><code class="language-java">
        public static registerBeanDefinition(BeanDefinitionHolder dfHolder, BeanDefinitionRegistry beanFactory)throws BeansException {
           // æ³¨å†ŒBeanDefinition ï¼ï¼ï¼
            String beanName = bdHolder.getBeanName();
            beanFactory.registerBeanDefinition(beanName, bdHolder.getBeanDefinition());
            //å¦‚æœæœ‰åˆ«åä¹Ÿæ³¨å†Œè¿›å»ï¼Œ register aliases for bean name ï¼Œ if any
                String[] aliases = bdHolder.getAliases();
                if (aliases != null){
                    for (int i = 0 ; i &lt; aliases.length ; i++){
                        beanFactory.registerAlias(beanName, aliases[i]);
                    }   
                }
        }
</code></pre>
<p>DefaultListableBeanFactoryå®ç°äº†ä¸Šé¢è°ƒç”¨BeanDefinitionRegistryæ¥å£çš„registerBeanDefinition(beanName ,bHolder.getBeanDefinition()) æ–¹æ³•ã€‚<br>
å¦‚ä¸‹å¦‚æ‰€ç¤ºï¼Œè¿™ä¸€éƒ¨åˆ†çš„ä¸»è¦é€»è¾‘æ˜¯å‘DefaultListableBeanFactoryå¯¹è±¡çš„beanDefinitionMapå­˜æ”¾beanDefinitionï¼Œ<br>
ä¹Ÿå°±æ˜¯è¯´beanDefinitionéƒ½å­˜æ”¾åœ¨beanDefinitionMapä¸­è¿›è¡Œç®¡ç†ã€‚<br>
å½“å®¹å™¨è¿›è¡Œbeanåˆå§‹åŒ–æ—¶ï¼Œåœ¨beançš„ç”Ÿå‘½å‘¨æœŸåˆ†æé‡Œå¿…ç„¶ä¼šåœ¨è¿™ä¸ªbeanDefinitionMapä¸­è·å–beanDefinitionå®ä¾‹</p>
<pre><code class="language-java">
public void registerBeanDefinition(String beanName ,BeanDefinition beanDefinition) throws BeanDefinitionStoreException{
    
        if(beanDefinition instanceof AbstractBeanDefinition){
            try{
            ((AbstractBeanDefinition) beanDefinition).validate();
           }catch(BeanDefinitionValidationException ex){
                throw new BeanDefinitionStoreException(beanDefinition.getResourceDescription(),beanName,
                , &quot;Validation of bean definition failed&quot; ,ex); 
          }
       }
        // beanDefinitionMapæ˜¯ä¸ªConcurrentHashMapç±»å‹æ•°æ®ï¼Œç”¨äºå­˜æ”¾beanDefinitionï¼Œå®ƒçš„key æ˜¯beanName
        Object oldBeanDefinition =  this.beanDefinitionMap.get(beanName);
        if(oldBeanDefinition != null){
            if(!this.allowBeanDefinitionOverriding()){
                throw new BeanDefinitionStoreException(beanDefinition.getResourceDescription(),beanName,
                &quot;Cannot register bean definition[&quot; + beanDefinition +&quot;]&quot; +beanName + &quot; there's already [&quot; + oldBeanDefinition +&quot;] bound&quot; )
          }
            else{
                if (logger.IsInfoEnabled()){
                    logger.info(&quot;Overriding bean definition for bean &quot; + beanName + &quot;: replacing [&quot; + oldBeanDefinition +&quot;] with&quot; + beanDefinition +&quot;]&quot; );
           }
        }
      }else{
            this.beanDefinitionNames.add(beanName);
        }
        //å°†è·å–åˆ°çš„BeanDefinition æ”¾å…¥Map ä¸­ï¼Œå®¹å™¨æ“ä½œä½¿ç”¨beanæ—¶ï¼Œé€šè¿‡è¿™ä¸ªHashMapæ‰¾åˆ°å…·ä½“çš„BeanDefinition
        this.beanDefinitionMap.put(beanName, BeanDefinition);
        removeSingleton(beanName);
    }


</code></pre>
<h2 id="springiocä¾èµ–æŸ¥æ‰¾">SpringIOCä¾èµ–æŸ¥æ‰¾</h2>
<p>æ€»æ‰€å‘¨çŸ¥ï¼ŒSpring IOCæ˜¯ç”¨æ¥åˆ›å»ºå’Œç®¡ç†Beanå®ä¾‹çš„ï¼ŒSpring IOCå®¹å™¨é’ˆå¯¹Beanåˆ›å»ºå®ä¾‹ä»¥åï¼Œä¼šè¢«å…¶ä»–ç±»ä½¿ç”¨ï¼Œå½“ä¸€ä¸ªå®ä¾‹è°ƒç”¨å¦ä¸€ä¸ªå®ä¾‹çš„æ—¶å€™ï¼Œå°±ä¼šå¯¹è°ƒç”¨çš„å®ä¾‹äº§ç”Ÿä¾èµ–ï¼Œ<br>
è™½ç„¶è¿™ä¸ªä¾èµ–çš„å®ä¾‹ç”±Spring IOCå®¹å™¨åˆ›å»ºå¹¶ç®¡ç†ï¼Œä½†å¦‚æœè¦ä½¿ç”¨è¿™ä¸ªBeanå®ä¾‹éœ€è¦é€šè¿‡æŸç§é€”å¾„ï¼Œå…¶ä¸­ä¸€ç§å°±æˆä¸ºä¾èµ–æŸ¥è¯¢ã€‚ä¾èµ–æŸ¥è¯¢çš„ç§ç±»å¾ˆå¤šï¼Œè¿™é‡Œä»‹ç»æœ€ç®€å•çš„ä¸¤ç§æŸ¥è¯¢æ–¹å¼ï¼š<br>
æ ¹æ®Beanåç§°æŸ¥è¯¢ï¼Œæ ¹æ®Beanç±»å‹æŸ¥è¯¢ã€‚</p>
<h3 id="æ ¹æ®beanåç§°æŸ¥æ‰¾">æ ¹æ®Beanåç§°æŸ¥æ‰¾</h3>
<p>ç”±äºgetBean(Class)æœ€ç»ˆä¼šè°ƒç”¨resolveNameBean æ–¹æ³•å®ŒæˆBeançš„æŸ¥æ‰¾ï¼Œå› æ­¤æºç åˆ†æå›´ç»•resolveNameBeanå±•å¼€ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå°†resolveNameBeanæ–¹æ³•ä¸¤å¼ å›¾ï¼Œåé¢æˆ‘ä»¬ä¼šé’ˆå¯¹å›¾ä¸­çš„æ­¥éª¤<br>
é€æ­¥å±•å¼€</p>
<pre><code class="language-java">  private &lt;T&gt; NameBeanHolder&lt;T&gt; resolveNameBean(ResolvableType requestType,Object[]args,boolean nonUniqueAsNull) throws BeansException {

    // æ ¹æ®ç±»å‹æŸ¥æ‰¾ï¼Œä¸ä¼šå®ä¾‹åŒ–bean 
       String[] candidateNames = getBeanNameForType(requestType);
        // å¤šç§ç±»å‹  å¦‚ä½•è¿‡æ»¤
        
        if(candidateNames.length &gt;0 ){
            List&lt;String&gt; autoWireCandidates = new ArrayList&lt;String&gt;(candidateNames.length);
            for(String beanName : autoWireCandidates){
                //å¦‚æœå®¹å™¨ä¸­å®šä¹‰äº†beanDefinition.autowireCandidate = false(é»˜è®¤ä¸ºtrue) åˆ™å‰”é™¤
                //â‘ æ²¡æœ‰å®šä¹‰è¯¥beanDefinition æˆ–â‘¡beanDefinition.autowireCandidate = true æ—¶åˆæ³•
                // ä»€ä¹ˆåœºæ™¯ä¸‹å‡ºç°ï¼šæ²¡æœ‰å®šä¹‰BeanDefinitionï¼Œä½†æ ¹æ®ç±»å‹æŸ¥æ‰¾è¯¥beanName 
                if(!containsBeanDefinition(beanName) || getBeanDefinition(beanName).isAutowireCandidate()){
                    autowireCandidate.add(beanName);                    
                }       
            }
            
            if(!autowireCandidates.isEmpty()){
                candidateNames = StringUtils.toStringArray(autowireCandidates);
            }
        }
        // å•ä¸ªcandidateNamesï¼Œåˆ™è°ƒç”¨getBean(beanName) å®ä¾‹åŒ–è¯¥Bean
        if (candidateNames.length == 1 ){
            String beanName = candidateNames[0];
            return new NameBeanHolder&lt;&gt;(beanName ,(T)getBean(beanName,requestType.toClass(),args))
        // å¤šä¸ªcandidateNamesï¼Œå…ˆå°è¯•æ˜¯å¦æ ‡æ³¨Primaryå±æ€§ï¼Œåœ¨å°è¯•ç±»ä¸Šçš„@primaryæ³¨è§£
        }else{
            Map&lt;String ,Object&gt;  candidates = new LinkedHashMap&lt;String,Object&gt;(candidateNames.length);
            for(String beanName:candidateNames){
                if(containsSingleton(beanName) &amp;&amp; args == null){
                   Object beanInstance = getBean(beanName);
                  candidates.put(beanName, beanInstance instanceof NullBean ? null : beanInstance);
                  
            }else{
                    candidates.put(beanName ,getType(beanName))
          }
      }
            //4.a æŸ¥æ‰¾Primary Bean ï¼Œå³beanDefinition.primary = true
            String candidateName = determinePrimaryCandidate(candidates,requiredType.toClass);
            // æ¯”è¾ƒbeançš„ä¼˜å…ˆçº§ @javax.annotation.Priority
            if(candidateName == null){
                determineHighestPriorityCandidate(candidates,requiredType.toClass);
        }
            //4.b è¿‡æ»¤åªè¦ä¸€ä¸ªç¬¦åˆæ¡ä»¶ï¼ŒgetBean(candidateName) å®ä¾‹åŒ–
        if (candidateName != null ){
            Object beanInstance = candidates.get(candidateName);
            if (beanInstance == null || beanInstance instanceof Class){
                beanInstance = getBean(candidateName,requestType.class ,args);
           }
            return new NamedBeanHolder&lt;&gt;(candidateName, (T)beanInstance);
        }
        //4.c  å¤šä¸ªbean ï¼ŒæŠ›å‡ºNoUniqueDefinitionExceptionå¼‚å¸¸
        if (!nonUniqueAsNull){
            throws new NoUniqueDefinitionException(requestType,candidates.keySet());
        }
    }
}

</code></pre>
<p>æˆ‘ä»¬æ ¹æ®resolveNamedBeanä»£ç æ³¨é‡Šä¸­çš„æ­¥éª¤è§£é‡Šå¦‚ä¸‹ï¼š<br>
1.æ ¹æ®Beanç±»å‹æŸ¥æ‰¾Spring Iocå®¹å™¨ä¸­æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„Beanåç§°ï¼Œå¯èƒ½æ˜¯ä»¥å’Œæˆ–è€…å¤šä¸ªã€‚getBeanNameForTypeåªä¼šè¯»å–BeanDefinitionä¿¡æ¯ï¼Œè¿™é‡Œå¹¶æ²¡æœ‰å¯¹beanå®ä¾‹åŒ–ã€‚<br>
2.æŸ¥æ‰¾å®Œç±»å‹ä¼šå°†å…¶æ”¾åˆ°candidateNamesä¸­ï¼Œè¿™é‡Œè¿‡æ»¤æ¡ä»¶æ—¶æ²¡æœ‰å®šä¹‰Beanå¯¹åº”çš„BeanDefinitionæˆ–è€…BeanDefinitionçš„autowireCandidateä¸ºtrueçš„æƒ…å†µä¸‹ã€‚<br>
å¦‚æœæ»¡è¶³ä¸Šè¯‰æƒ…å†µå°±å°†å…¶åŠ å…¥åˆ°autowireCandidates<br>
3.å¦‚æœå®¹å™¨ä¸­åªæ³¨å†Œäº†ä¸€ä¸ªè¿™ç§ç±»å‹çš„Beanï¼Œä¹Ÿå°±æ˜¯candidateNamesé•¿åº¦ä¸º1çš„æ—¶å€™ï¼Œç›´æ¥å®ä¾‹åŒ–è¯¥Beanåè¿”å›å³å¯ã€‚<br>
4.å½“Spring IOC å®¹å™¨æ³¨å†Œå¤šä¸ªBeançš„æ—¶å€™éœ€è¦å®Œæˆä¸€ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š<br>
5.æŸ¥æ‰¾primary Beanï¼Œå³beanDefinition.primary = true.å¦‚æœæœ‰å¤šä¸ªï¼Œåˆ™æŠ›å‡ºNoUniqueDefinitionExceptionå¼‚å¸¸<br>
6.æ¯”è¾ƒBeançš„ä¼˜å…ˆçº§ã€‚Spring é»˜è®¤çš„æ¯”è¾ƒå™¨æ˜¯AnnotationAwareOrderComparatorï¼Œæ¯”è¾ƒBeanä¸Š@javax.annitation.Priority çš„ä¼˜å…ˆçº§ï¼Œ<br>
å€¼è¶Šå°ï¼Œä¼˜å…ˆçº§è¶Šé«˜ã€‚åŒæ ·çš„å¦‚æœæœ€é«˜çº§åˆ«çš„å¤šä¸ªï¼Œåˆ™æŠ›å‡ºNoUniqueDefinitionExceptionå¼‚å¸¸<br>
7.å¤šä¸ªBeanï¼Œåˆ™æŠ›å‡ºNoUniqueDefinitionExceptionå¼‚å¸¸ã€‚</p>
<h3 id="æ ¹æ®beanç±»å‹æŸ¥æ‰¾">æ ¹æ®Beanç±»å‹æŸ¥æ‰¾</h3>
<p>ä¸è·å–å•ä¸ªBeanå®ä¾‹ç±»å‹è¿‡ç¨‹ç›¸ä¼¼çš„æ˜¯ï¼Œè·å–é›†åˆbeanç±»å‹å®ä¾‹æœ‰å¤šä¸ªcandidateNamesæ˜¯ä¸ç”¨è¿‡æ»¤ï¼Œå…¨éƒ¨è¿”å›å³å¯ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒgetBeanOfTypeåŒæ ·è°ƒç”¨getBeanNameForTypeè·å–æ‰€æœ‰beanç±»å‹åŒ¹é…çš„beanNamesï¼Œ<br>
ç„¶åè°ƒç”¨getBean(beanName)å®ä¾‹åŒ–æ‰€æœ‰çš„Bean.</p>
<pre><code class="language-java">
    @Override
    public &lt;T&gt; Map&lt;String, T&gt; getBeanOfType(@Nullable Class&lt;T&gt; type) throws BeanException {
            
        return getBeanOfType(type ,true ,true);
    }

    public &lt;T&gt; Map&lt;String, T&gt; getBeanOfType(@Nullable Class&lt;T&gt; type ,boolean includeNonSingles,boolean allowEagarInit) throws  BeanException {
       String[] beanNames = getBeanNameForType(type,includeNonSingles,allowEagarInit);
        Map&lt;String ,T&gt; result = new LinkedHashMap&lt;String, T&gt;(beanNames.length);
        for(String beanName : beanNames){
           Object beanInstance = getBean(beanName);
           if(!(beanInstance instanceof NullBean)){
               result.put(beanName, (T)beanInstance);
            }
        }
        return result;
    }

</code></pre>
<p>è·å–é›†åˆBeanç±»å‹<br>
å¦‚æœéœ€è¦è·å–é›†åˆBeanç±»å‹éœ€è¦ä½¿ç”¨getBeanNameForTypeæ–¹æ³•ï¼ŒSprinå†…éƒ¨æ ¹æ®ç±»å‹åŒ¹é…æ‰€æœ‰çš„beanNamesã€‚<br>
getBeanNameForTypeä¸ä¼šåˆå§‹åŒ–Beanï¼Œæ ¹æ®å…¶BeanDefinition æˆ–è€…FactoryBean#getObjectTypeè·å–å…¶ç±»å‹</p>
<pre><code class="language-java">    
    public String[] getBeanNamesForType(@Nullable Class&lt;T&gt; type ,boolean includeNonSingletons ,boolean allowEagerInit){
    //1.æŸ¥è¯¢ç»“æœä¸ä½¿ç”¨ç¼“å­˜
    //2.configurationFrozenè¡¨ç¤ºæ˜¯å¦å†»ç»“BeanDefinition,ä¸å…è®¸ä¿®æ”¹ï¼Œå› æ­¤æŸ¥è¯¢ç»“æœå¯èƒ½æœ‰è¯¯
    //ä¸€æ—¦è°ƒç”¨refresh æ–¹æ³•ï¼Œåˆ™configurationFrozen = trueï¼Œä¹Ÿå°±æ˜¯å®¹å™¨å¯åŠ¨è¿‡ç¨‹ä¸­ä¼šèµ°ifè¯­å¥
    // type = null,æŸ¥æ‰¾æ‰€æœ‰bean
    // !allowEagarInit è¡¨ç¤ºä¸å…è®¸æå‰åˆå§‹åŒ–FactoryBean
    if(!isCOnfigurationFrozen || type == null !allowEagarInit) {
       return doGetBeanNamesForType(ResolvableType.forRawClass(type) ,includeNonSingletons,allowEagarInit);
    }
    //2.å…è®¸ä½¿ç”¨ç¼“å­˜ï¼Œæ­¤å®¹å™¨å·²ç»å¯åŠ¨å®Œæˆï¼Œbeanå·²åŠ è½½ï¼ŒBeanDefinitionä¸å…è®¸è¢«ä¿®æ”¹
     Map&lt;Class&lt;?&gt;,String[]&gt; cache = includeNonSingletons ?this.allBeanNamesByType:this.singletonsBeanNamesByType;
    String[] resolvedBeanNames = cache.get(type);
    if(resolvedBeanNames != null){
        return resolvedBeanNames;
     }
      resolvedBeanNames =  doGetBeanNamesForType(ResolvableType.forRawClass(type) ,includeNonSingletons,true);
    if(ClassUtils.isCacheSafe){
        cache.put(type,resolvedBeanNames);
    } 
    return resolvedBeanNames;
}


</code></pre>
<p>å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæ–¹æ³•getBeanNamesForTypeä¸­è°ƒç”¨äº†doGetBeanNamesForTypeæ–¹æ³•ã€‚</p>
<p>å‚æ•°typeè¡¨ç¤ºè¦æŸ¥æ‰¾çš„ç±»å‹ï¼ŒincludeNonSingletonsè¡¨ç¤ºæ˜¯å¦åŒ…å«éå•ä¾‹beanï¼ŒallowEagarInitè¡¨ç¤ºæ˜¯å¦æå‰éƒ¨åˆ†åˆå§‹åŒ–<br>
FactoryBeanã€‚</p>
<p>1ã€æŸ¥è¯¢ç»“æœä¸ä½¿ç”¨ç¼“å­˜ï¼Œåˆ™éœ€è¦æ»¡è¶³ä»¥ä¸‹åœºæ™¯ï¼š</p>
<ul>
<li>
<p>configurationFrozen = false ï¼Œè¡¨ç¤ºSpringå®¹å™¨åœ¨åˆå§‹åŒ–é˜¶æ®µï¼Œå¯ä»¥å¯¹BeanDefinitionè¿›è¡Œè°ƒæ•´ï¼Œå½“ç„¶ç¼“å­˜ç»“æœ<br>
æ¯«æ— æ„ä¹‰ã€‚åœ¨refreshåä¼šè®¾ç½®ä¸ºtrueï¼Œè¡¨ç¤ºå¯ä»¥å¯¹ç»“æœè¿›è¡Œç¼“å­˜ã€‚</p>
</li>
<li>
<p>type =null?</p>
</li>
<li>
<p>allowEagerInit = false;è¡¨ç¤ºä¸å…è®¸å®ä¾‹åŒ–FactoryBeanæ¥è·å–Beanç±»å‹ï¼Œé‚£å°±åªèƒ½é€šè¿‡FactoryBeanä¸Šçš„<br>
æ³›å‹æ¥è·å–å…¶ç±»å‹äº†ï¼Œä¹Ÿå¯èƒ½å¯¼è‡´æŸ¥è¯¢ç»“æœä¸å‡†ç¡®ã€‚</p>
</li>
</ul>
<p>2ã€å…è®¸ä½¿ç”¨ç¼“å­˜ï¼Œå½“getBeanNamesForTypeæ–¹æ³•æ ¹æ®ç±»å‹æŸ¥æ‰¾åŒ¹é…beanNamesç»“æœæ—¶ï¼Œè¿™ä¸ªåŒ¹é…è¿‡ç¨‹å¹¶ä¸ååˆ†å‡†ç¡®ã€‚<br>
å› ä¸ºæ–¹æ³•ä¸ä¼šé€šè¿‡æå‰å®ä¾‹åŒ–Beançš„æ–¹æ³•è·å–å…¶ç±»å‹ï¼Œåªä¼šæ ¹æ®BeanDefinitionæˆ–è€…FactoryBean#getObjectType<br>
è·å–å…¶ç±»å‹ã€‚å¦‚æœä¸å®ä¾‹åŒ–å¯¹è±¡ï¼Œæœ‰äº›åœºæ™¯å¯èƒ½å¹¶ä¸èƒ½è·å–å¯¹è±¡ç±»å‹ã€‚å› æ­¤è¿™ä¸ªä½¿ç”¨ç¼“å­˜ã€‚åœ¨å®¹å™¨å¯åŠ¨å®Œæˆåªä¼šBeanå·²ç»åŠ è½½å®Œæ¯•<br>
BeanDefinitionå°±ä¸å…è®¸ä¿®æ”¹ã€‚</p>
<h3 id="ä¾èµ–æŸ¥æ‰¾ä¸­çš„ç»å…¸å¼‚å¸¸beanæ‰¾ä¸åˆ°beanä¸æ˜¯å”¯ä¸€çš„">ä¾èµ–æŸ¥æ‰¾ä¸­çš„ç»å…¸å¼‚å¸¸ï¼šBeanæ‰¾ä¸åˆ°ï¼ŸBeanä¸æ˜¯å”¯ä¸€çš„ï¼Ÿ</h3>
<p>ä¸ŠèŠ‚è¯¾æˆ‘ä»¬é€šè¿‡æºç æ–¹å¼ä»‹ç»äº†ï¼šè·å–å•ä¸ªBeanç±»å‹å®ä¾‹ï¼Œè·å–é›†åˆBeanç±»å‹å®ä¾‹ï¼›è·å–é›†åˆBeanç±»å‹åç§°ã€‚<br>
æœ¬èŠ‚è¯¾ï¼Œä¼šç»™å¤§å®¶ä¾èµ–æŸ¥æ‰¾ä¸­ç»å…¸å¼‚å¸¸é—®é¢˜çš„è®¨è®ºï¼šBeanæ‰¾ä¸åˆ°çš„æƒ…å†µä»¥åŠBeanä¸æ˜¯å”¯ä¸€çš„æƒ…å†µã€‚<br>
çœ‹çœ‹è¿™ç§æƒ…å†µå¦‚ä½•å¤„ç†ã€‚ä»Šå¤©ä¸»è¦ä»‹ç»Spring ä¾èµ–æŸ¥æ‰¾ï¼Œæœ‰å¦‚ä½•å†…å®¹ï¼š</p>
<ul>
<li>BeansExceptionçš„å­æ¥å£</li>
<li>NoSuchBeanDefinitionExceptionä¸å­˜åœ¨æŸ¥æ‰¾çš„Bean</li>
<li>NoUniqueDefinitionException å®¹å™¨ä¸­å­˜åœ¨å¤šä¸ªåŒç±»å‹çš„Bean</li>
</ul>
<h4 id="beansexception">BeansException</h4>
<p>å¦‚å›¾ä¸€æ‰€ç¤ºï¼Œé€šå¸¸æ¥è¯´åœ¨æ“ä½œBeançš„æ—¶å€™ä¼šå‡ºç°å¼‚å¸¸ï¼Œè¿™äº›å¼‚å¸¸éƒ½æ¥è‡ªBeansExceptionçš„å­æ¥å£ã€‚<br>
ä¾‹å¦‚æŸ¥æ‰¾çš„Beanä¸å­˜åœ¨äºIocå®¹å™¨ï¼Œç±»å‹ç”¨æ¥æŸ¥æ‰¾æ—¶IOCå®¹å™¨å­˜åœ¨å¤šä¸ªBeanå®ä¾‹ï¼›</p>
<p>å½“Beanå¯¹åº”çš„ç±»å‹éå…·ä½“ç±»æ—¶ï¼›å½“Beanåˆå§‹åŒ–è¿‡ç¨‹å‡ºç°å¼‚å¸¸ï¼›å½“BeanDefinitioné…ç½®å…ƒæ•°æ®æ—¶å‡ºç°å¼‚å¸¸ã€‚è¿™äº›å¼‚å¸¸éƒ½ä¼šåœ¨ä¸åŒçš„åœºæ™¯ä¸­å‡ºç°ã€‚</p>
<table>
<thead>
<tr>
<th>å¼‚å¸¸ç±»å‹</th>
<th>è§¦å‘æ¡ä»¶(ä¸¾ä¾‹)</th>
<th>åœºæ™¯ä¸¾ä¾‹</th>
</tr>
</thead>
<tbody>
<tr>
<td>NoSuchBeanDefinitionException</td>
<td>å½“æŸ¥æ‰¾çš„Beanä¸åœ¨IOCå®¹å™¨æ—¶</td>
<td>BeanFactory#getBean</td>
</tr>
<tr>
<td>NoUniqueDefinitionException</td>
<td>ä¾èµ–æŸ¥æ‰¾æ—¶IOCå®¹å™¨ä¸­å­˜åœ¨å¤šä¸ªBeanå®ä¾‹</td>
<td>BeanFactory#getBean</td>
</tr>
<tr>
<td>BeanInstantiationException</td>
<td>å½“Beanæ‰€å¯¹åº”çš„ç±»å‹éå…·ä½“ç±»æ—¶</td>
<td>BeanFactory#getBean</td>
</tr>
<tr>
<td>BeanCreationException</td>
<td>å½“Beanåˆå§‹åŒ–è¿‡ç¨‹ä¸­</td>
<td>Beanåˆå§‹åŒ–æ–¹æ³•æ‰§è¡Œå¼‚å¸¸æ—¶</td>
</tr>
<tr>
<td>BeanDefinitionStoreException</td>
<td>å½“BeanDefinitioné…ç½®å…ƒæ•°æ®éæ³•æ—¶</td>
<td>XMLé…ç½®èµ„æºæ— æ³•æ‰“å¼€æ—¶</td>
</tr>
</tbody>
</table>
<p>è¿™é‡Œæˆ‘ä»¬ç€é‡è®¨è®ºNoSuchBeanDefinitionException å’ŒNoUniqueDefinitionException ä¸¤ç§å¼‚å¸¸çš„ä½¿ç”¨åœºæ™¯</p>
<h3 id="æºç å‰–æspring-iocå®¹å™¨beanåˆå§‹åŒ–æµç¨‹">æºç å‰–æï¼šSpring IOCå®¹å™¨Beanåˆå§‹åŒ–æµç¨‹ï¼Ÿ</h3>
<p>é€šè¿‡SpringIOCå®¹å™¨åˆå§‹åŒ–Beançš„æµç¨‹ï¼Œåœ¨ä¹‹å‰çš„ç« èŠ‚ä¸­ä»‹ç»äº†SpringIOCå®¹å™¨æ—¶å¦‚ä½•ä»é…ç½®æ–‡ä»¶ä¸­è¯»å–Beanä¿¡æ¯ï¼Œå¹¶ä¸”å°†å…¶è½¬æ¢ä¸ºBeanDefinitionï¼Œå¹¶ä¸”æ³¨å†Œåˆ°SpringIOC<br>
å®¹å™¨ä¸­è¿›è¡Œç»Ÿä¸€ç®¡ç†çš„ã€‚ä»Šå¤©è®²çš„æ˜¯ï¼Œåœ¨SpringIOCå®¹å™¨ä¸­çš„Beanå®ä¾‹æ˜¯å¦‚ä½•è¢«åˆ›å»ºå‡ºæ¥çš„ï¼Œä¹Ÿå°±æ˜¯è§£å†³å¦‚ä½•ä»SpringIOCå–å‡ºBeanè¿›è¡Œä½¿ç”¨ã€‚</p>
<p>åˆ›å»ºBeançš„æ—¶åºå›¾</p>
<figure data-type="image" tabindex="2"><img src="../framework/images/Bean%E5%88%9B%E5%BB%BA%E6%97%B6%E5%BA%8F%E5%9B%BE.png" alt="åˆ›å»ºBeanæ—¶è®¸å›¾" loading="lazy"></figure>
<p>ç”±äºä¸€ä¸ªBeançš„åˆ›å»ºç»å†äº†è‹¥å¹²ä¸ªç±»ï¼Œè°ƒç”¨äº†å¾ˆå¤šæ–¹æ³•ï¼Œä¸ºäº†å°†è¿™ä¸ªè¿‡ç¨‹ç†è§£æ¸…æ¥šï¼Œè¿™é‡Œæ ¹æ®å›¾1çš„æ—¶åºå›¾ç»™å¤§å®¶å±•å¼€æè¿°ã€‚<br>
è¿™é‡Œæ¶‰åŠåˆ°å‡ ä¸ªä¸»è¦è°ƒç”¨çš„ç±»ï¼Œæˆ‘ä»¬ä¼šæ ¹æ®é‡ç‚¹ï¼ŒæŒ‰ç…§å›¾ä¸Šçº¢è‰²æ•°å­—æ ‡å·è¿›è¡Œè®²è§£ã€‚</p>
<p>å¦‚å›¾ä¸€æ‰€ç¤ºï¼ŒæŒ‰ç…§çº¢è‰²æ ‡å·çš„é¡ºåºå¦‚ä¸‹ï¼š</p>
<p>1.é¦–å…ˆé€šè¿‡ClassPathXmlApplicationContextè·å–è¦åˆ›å»ºçš„Beanï¼Œè¿™é‡Œçš„æ–¹æ³•æ˜¯getBeanã€‚</p>
<p>2.åœ¨AbstractBeanFactoryä¸­ä¼šé€šè¿‡è°ƒç”¨doGetBeanæ–¹æ³•å®Œæˆè·å–Beançš„æ“ä½œã€‚</p>
<p>3.æ­¤æ—¶DefaultSingletonBeanResigstryä¼šæ‰§è¡ŒgetSingletoné€šè¿‡å•ä¾‹çš„æ–¹å¼è¿”å›Beanã€‚</p>
<p>4.åœ¨è·å–Beanä»¥åä¼šé€šè¿‡createBeanæ–¹æ³•è°ƒç”¨AbstractAutowireCapableBeanFactoryä¸­çš„æ–¹æ³•å¯¹Beanè¿›è¡Œåˆå§‹åŒ–ã€‚<br>
è¿™é‡Œé‡è¦çš„ä¸‰ä¸ªæ–¹å¼åˆ†åˆ«æ˜¯ï¼šdoCreateBeanã€createBeanInstanceã€instantiateBeanBeanã€‚ä»å›¾ä¸Šå¯ä»¥çœ‹å‡ºBeanåˆå§‹åŒ–éƒ½æ˜¯åœ¨è¿™ä¸ªç±»ä¸­å®Œæˆçš„ã€‚</p>
<p>5.ç´§æ¥ç€é€šè¿‡instantiateé€šè¿‡è°ƒç”¨SimpleInstantiationStrategyä¸­çš„instantiateWithMethodInjectionåšåˆå§‹åŒ–çš„æ“ä½œã€‚</p>
<p>6.CglibSubclassingInstantiationStrategyä½œä¸ºCGLIBä»£ç†å®ç°ç­–ç•¥ç±»ï¼Œé€šè¿‡CglibSubclassCreator.instantiateæ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶ä¸”è¿”å›<br>
AbstractAutowireCapableBeanFactoryã€‚æ­¤æ—¶AbstractAutowireCapableBeanFactoryä¼šæ¥ç€populateBeanå’ŒApplyPropertyValuesæ–¹æ³•å¯¹Beanè¿›è¡Œå¡«å……ï¼Œä»¥åŠè®¾ç½®å±æ€§å€¼ã€‚</p>
<p>7.æœŸé—´ä¼šé€šè¿‡è°ƒç”¨beanDefinitionValueResolverä¸­çš„resolveValueIfNecessaryæ–¹æ³•å®Œæˆå¯¹BeanDefinitionä¸­çš„å€¼å¡«å……ã€‚</p>
<h3 id="springiocä¾èµ–æŸ¥æ³¨å…¥">SpringIOCä¾èµ–æŸ¥æ³¨å…¥</h3>
<p>ä¾èµ–æ³¨å…¥çš„æ–¹å¼ï¼šæ„é€ å™¨æ³¨å…¥ï¼Œsetæ³¨å…¥</p>
<p>SpringIOC ä¾èµ–æ³¨å…¥ä¹Ÿç§°ä¸ºè‡ªåŠ¨è½¬è½½ï¼Œå½“ä¸¤ä¸ªç±»å­˜åœ¨ä¾èµ–å…³ç³»ï¼Œé€šè¿‡é…ç½®Beanå…ƒç´ çš„autowireå±æ€§è‡ªåŠ¨è£…é…<bean>æ ‡ç­¾çš„æ–¹å¼è·å–ä¾èµ–ç±»çš„å®ä¾‹ã€‚<br>
è¿™é‡Œä»‹ç»ä¸¤ç§å¸¸è§çš„ä¾èµ–æ³¨å…¥æ–¹å¼:</p>
<ul>
<li>
<p>æ ¹æ®Beanåç§°æ³¨å…¥</p>
<p>æ ¹æ®Beanåç§°æ³¨å…¥ï¼Œä½¿ç”¨byNameæ ‡ç­¾ï¼Œæ­¤é€‰é¡¹å°†æ£€æŸ¥å®¹å™¨å¹¶æ ¹æ®åå­—æŸ¥æ‰¾ä¸å±æ€§å®Œå…¨ä¸€è‡´çš„bean,å¹¶å°†å…¶ä¸å±æ€§è‡ªåŠ¨è£…é…ã€‚</p>
</li>
<li>
<p>æ ¹æ®Beanç±»å‹æ³¨å…¥</p>
<p>æ ¹æ®Beanç±»å‹æ³¨å…¥ï¼Œä½¿ç”¨byTypeæ ‡ç­¾ï¼Œå¦‚æœå®¹å™¨ä¸­å­˜åœ¨ä¸€ä¸ªä¸æŒ‡å®šå±æ€§ç±»å‹ç›¸åŒçš„Bean,é‚£ä¹ˆå°†å…¶ä¸è¯¥å±æ€§è‡ªåŠ¨è£…é…ï¼›<br>
å¦‚æœå­˜åœ¨å¤šä¸ªè¯¥ç±»å‹Bean,é‚£ä¹ˆæŠ›å‡ºå¼‚å¸¸ï¼Œå¹¶æŒ‡å‡ºä¸èƒ½ä½¿ç”¨byTypeæ–¹å¼è¿›è¡Œè‡ªåŠ¨çŠ¶æ€ï¼›<br>
å¦‚æœæ²¡æœ‰æ‰¾åˆ°å‘åŒ¹é…çš„Beanï¼Œåˆ™ä»€ä¹ˆäº‹æƒ…éƒ½ä¸ä¼šå‘ç”Ÿã€‚</p>
</li>
</ul>
<h3 id="æºç å‰–æautowireæ³¨è§£ä¾èµ–æ³¨å…¥çš„åŸç†">æºç å‰–æï¼š@Autowireæ³¨è§£ä¾èµ–æ³¨å…¥çš„åŸç†</h3>
<h4 id="autowireçš„å®šä¹‰">@Autowireçš„å®šä¹‰</h4>
<pre><code>é€šå¸¸æ¥è¯´ï¼Œæˆ‘ä¹ˆä¼šä½¿ç”¨@Autowireè¿›è¡Œä¾èµ–æ³¨å…¥çš„æ“ä½œï¼Œå¦‚å›¾1æ‰€ç¤ºé€šè¿‡@Autowireæ³¨è§£çš„æºç å®šçœ‹å‡ºï¼Œå®ƒè¢«æ ‡æ³¨å¯ä»¥ä½œç”¨äºï¼šæ„é€ å‡½æ•°ï¼ˆConstructorï¼‰ã€æ–¹æ³•ï¼ˆMethodï¼‰ã€å‚æ•°ï¼ˆParameterï¼‰ã€å­—æ®µï¼ˆFieldï¼‰
æ³¨è§£ï¼ˆAnnotationï¼‰ï¼Œä¹Ÿå°±æ˜¯é’ˆå¯¹è¿™äº›æè¿°éƒ½å¯ä»¥ä½¿ç”¨@Autowireçš„æ–¹å¼å®ç°è‡ªåŠ¨çš„ä¾èµ–æ³¨å…¥ã€‚
</code></pre>
<pre><code class="language-java">

@Target({ElementType.CONSTRUCTOR, ElementType.METHOD, ElementType.PARAMETER, ElementType.FIELD, ElementType.ANNOTATION_TYPE})
@Retention(RetentionPolicy.RUNTIME)
@Documented
public @interface Autowired {

	/**
	 * Declares whether the annotated dependency is required.
	 * &lt;p&gt;Defaults to {@code true}.
	 */
	boolean required() default true;

}



</code></pre>
<h4 id="autowireçš„å·¥ä½œåŸç†">@Autowireçš„å·¥ä½œåŸç†</h4>
<p>@Autowireæ³¨è§£æ˜¯ç”±AutowireAnnotationBeanProcessorå®ç°çš„ï¼Œå¦‚å›¾2æ‰€ç¤ºï¼ŒæŸ¥çœ‹è¯¥ç±»çš„æºç ä¼šå‘ç°å®ƒå®ç°äº†MergedBeanDefinitionPostProcessoræ¥å£ã€‚</p>
<pre><code class="language-java">
public class AutowiredAnnotationBeanPostProcessor extends InstantiationAwareBeanPostProcessorAdapter
		implements MergedBeanDefinitionPostProcessor, PriorityOrdered, BeanFactoryAware {


</code></pre>
<p>å¦‚å›¾æ‰€ç¤ºï¼ŒåŒæ—¶AutowiredAnnotationBeanPostProcessorå®ç°äº†MergedBeanDefinitionPostProcessorä¸­çš„postProcessMergedBeanDefinitionæ–¹æ³•ï¼Œ<br>
@Autowiredæ³¨è§£æ­£æ˜¯é€šè¿‡è¿™ä¸ªæ–¹æ³•å®ç°æ³¨å…¥ç±»å‹ç±»å‹çš„é¢„è§£æï¼Œå°†éœ€è¦ä¾èµ–æ³¨å…¥çš„å±æ€§ä¿¡æ¯å°è£…åˆ°InjectionMetadataç±»ä¸­ã€‚</p>
<pre><code class="language-java">
	@Override
	public void postProcessMergedBeanDefinition(RootBeanDefinition beanDefinition, Class&lt;?&gt; beanType, String beanName) {
		InjectionMetadata metadata = findAutowiringMetadata(beanName, beanType, null);
		metadata.checkConfigMembers(beanDefinition);
	}


</code></pre>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼ŒInjectionMetadataç±»ä¸­åŒ…å«äº†éœ€è¦æ³¨å…¥çš„å…ƒç´ (injectElements)åŠå…ƒç´ æ³¨å…¥çš„ç›®æ ‡ç±»(tagetClass)</p>
<pre><code class="language-java">    
public class InjectionMetadate{
    private static final Log logger = LogFactory.getLog(InjectionMetadata.class);

    private final Class&lt;?&gt; targetClass;

    private final Collection&lt;InjectedElement&gt; injectedElements;

    @Nullable
    private volatile Set&lt;InjectedElement&gt; checkedElements;
}

</code></pre>
<p>æ—¢ç„¶AutowiredAnnotationBeanPostProcessoræ˜¯å®ç°Autowireä¸»åŠ›ç±»ï¼Œé‚£ä¹ˆå¦‚ä½•æ‰§è¡Œå®ƒå®ç°ä¾èµ–æ³¨å…¥å‘¢ï¼Ÿ<br>
Springå®¹å™¨åœ¨å¯åŠ¨çš„æ—¶å€™ä¼šæ‰§è¡ŒAbstractApplicationContextç±»çš„refreshæ–¹æ³•ï¼Œrefreshæ–¹æ³•ä¸­<br>
registerBeanPostProcessor(beanFactory)å®Œæˆäº†å¯¹AutowireAnnotationBeanPostProcessorçš„æ³¨å†Œï¼Œå½“æ‰§è¡ŒfinishBeanFactoryInitialization(beanFactory)æ–¹æ³•<br>
å¯¹éå»¶è¿Ÿåˆå§‹åŒ–çš„å•ä¾‹beanè¿›è¡Œåˆå§‹åŒ–æ—¶ï¼Œä¼šæ‰§è¡ŒAbstractAutowireCapableBeanFactoryç±»çš„doCreateBeanæ–¹æ³•ã€‚</p>
<pre><code class="language-java">    public void refresh() throws BeansException, IllegalStateException {
        synchronized(this.startupShutdownMonitor) {
            this.prepareRefresh();
            ConfigurableListableBeanFactory beanFactory = this.obtainFreshBeanFactory();
            this.prepareBeanFactory(beanFactory);

            try {
                this.postProcessBeanFactory(beanFactory);
                this.invokeBeanFactoryPostProcessors(beanFactory);
                this.registerBeanPostProcessors(beanFactory);
                this.initMessageSource();
                this.initApplicationEventMulticaster();
                this.onRefresh();
                this.registerListeners();
                this.finishBeanFactoryInitialization(beanFactory);
                this.finishRefresh();
            } catch (BeansException var9) {
                if (this.logger.isWarnEnabled()) {
                    this.logger.warn(&quot;Exception encountered during context initialization - cancelling refresh attempt: &quot; + var9);
                }

                this.destroyBeans();
                this.cancelRefresh(var9);
                throw var9;
            } finally {
                this.resetCommonCaches();
            }

        }
    }

</code></pre>
<p>å¦‚å›¾6æ‰€ç¤ºdoCreateBeanæ–¹æ³•ä¸­å›å»è°ƒç”¨applyMergedBeanDefinitionPostProcessoræ–¹æ³•</p>
<pre><code class="language-java">
 synchronized(mbd.postProcessingLock){
    
    if(!md.postProcessed){
      try {
          applyMergedBeanDefinitionPostProcessors(mbd,beanType,beanName);
          
         }catch{
           throw new BeanCreationException(
                   mbd.getResourceDescription(),beanName,&quot;Post-processing of merge bean definition failed&quot;,ex);
         }
      mbd.postProcessed = true;
     }
 }

</code></pre>
<p>å¦‚å›¾æ‰€ç¤ºï¼ŒæŸ¥çœ‹postProcessMergedBeanDefinitionæ–¹æ³•å…·ä½“çš„å®ç°ç±»ï¼Œä¼šå‘ç°è°ƒç”¨çš„æ˜¯<br>
AutowireAnnotationBeanPostProcessorç±»postProcessMergedBeanDefinitionæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•ä¸­å®Œæˆäº†å¯¹æ³¨å…¥å…ƒç´ <br>
æ³¨è§£çš„é¢„è§£æã€‚</p>
<p>æœ€åè¿˜æ˜¯å§çœ¼å…‰ç§»å›doCreateBeanæ–¹æ³•ä¸­ä¼šéå†æ‰€æœ‰æ³¨å†Œè¿‡çš„BeanPostProcessoræ¥å£å®ç°ç±»çš„å®ä¾‹ï¼Œå¦‚æœå®ä¾‹å±äº<br>
InstantiationAwareBeanPostProcessorç±»å‹çš„ï¼Œåˆ™ä¼šæ‰§è¡Œå®ä¾‹ç±»çš„postProcessPropertyValuesæ–¹æ³•</p>
<pre><code class="language-java">
    if(hasInstAwareBpps || needsDepCheck){
        PropertyDecriptore[] filteredPds = filterPropertyDescriptorForDependencyCheck(bw,mbd.allowCaching);
        if (hasInstAwareBpps) {
            for (BeanPostProcessor bp : getBeanPostProcessors()) {
                if(bo instanceof InstantiationAwareBeanPostProcessor) {
                    InstantiationAwareBeanPostProcessor ibp = (InstantiationAwareBeanPostProcessor) bp
                    pvs = ibp.postProcessPropertyValues(pvs,filtredPds,bw.getWrappedInstance(),beanName);
                    if (pvs == null){
                        return ;    
                    }
                }       
            }
            if(needsDepCheck){
                checkDependcies(beanName,mbd,filteredPds,pvs);
            }
        }
        
        applyPropertyValues(beanName,mbd,bw,pvs);
    }

</code></pre>
<p>å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œè¿›å…¥åˆ°postProcessPropertyValuesæ–¹æ³•å†…éƒ¨ã€‚ç”±äºAutowiredAnnotationBeanPostProcessorç»§æ‰¿äº†InstantiationAwarePostBeanPostProcessorAdapter<br>
,è€ŒAutowiredAnnotationBeanPostProcessoré—´æ¥å®ç°äº†InstantiationAwareBeanPostProcessoræ¥å£ï¼Œæ‰€ä»¥è¿™é‡Œä¼šæ‰§è¡Œåˆ°<br>
AutowiredAnnotationBeanPostProcessorç±»çš„postProcessPropertyValuesæ–¹æ³•ã€‚å…¶ä¸­ä¼šè°ƒç”¨metadata.inject(bean ,beanName,pvs)ä»£ç è¿›è¡Œæ³¨å…¥æ“ä½œã€‚</p>
<pre><code class="language-java">
public void  inject(Object target ,String beanName ,PropertyValues pvs) throws Throwable {
          Collection&lt;InjectedElement&gt; elementsToInterate = this.checkedElements != null? this.checkElements:this.injectedElements);
          if(!elementsToInterate.isEmpty()){
              boolean debug =  logger.isDebugEnabled();
              for (InjectedElement element : elementsToInterate) {
                    if(debug) {
                        logger.debug(&quot;Processing injected element of bean &quot; + beanName +&quot;:&quot; +element)
                }           
              }
              element.inject(target,beanName,pvs);
        }        
          
}
</code></pre>
<p>ä¸Šé¢ä¸¤ç§æ–¹å¼çš„æ³¨å…¥è¿‡ç¨‹éƒ½å·®ä¸å¤šï¼Œæ ¹æ®éœ€è¦æ³¨å…¥çš„å…ƒç´ çš„æè¿°ä¿¡æ¯ï¼ŒæŒ‰ç±»å‹æˆ–è€…åç§°æŸ¥æ‰¾éœ€è¦çš„ä¾èµ–å€¼ï¼Œå¦‚æœä¾èµ–æ²¡æœ‰æ‰¾åˆ°å®ä¾‹å…ˆå®ä¾‹åŒ–ä¾èµ–ï¼Œç„¶åä½¿ç”¨åå°„è¿›è¡Œèµ‹å€¼ã€‚<br>
ä¸‹å›¾æ˜¯fieldæ³¨å…¥çš„åœºæ™¯ï¼Œ</p>
<pre><code class="language-java">
 if (value != null) {
     ReflectionUtils.makeAccessible(field);
     field.setValue(bean ,value);
 }

</code></pre>
<p>field æ³¨å…¥</p>
<pre><code class="language-java">
if (arguments != null){
     try{
        ReflectionUtils.makeAccessible(field);
        method.invoke(bean ,arguments);
    }catch(InvocationTargetException ex){
         throw ex.getTargetException();
    }
}
</code></pre>
<h3 id="ç²¾é€‰é¢è¯•é¢˜autowireå’ŒresourceåŒºåˆ«">ç²¾é€‰é¢è¯•é¢˜ï¼š@Autowireå’Œ@ResourceåŒºåˆ«</h3>
<h4 id="resourceçš„æ³¨å…¥æ–¹å¼">@Resourceçš„æ³¨å…¥æ–¹å¼</h4>
<p>ä¸Šä¸€èŠ‚è¯¾ä»‹ç»çš„æ˜¯@Autowireçš„æ³¨å…¥æ–¹å¼ï¼Œåœ¨å¯¹@Resourceå’Œ@AutowireåšåŒºåˆ«ä¹‹å‰å…ˆä»‹ç»ä¸€ä¸‹@Resourceçš„å¸¸ç”¨æ³¨å…¥å±æ€§nameå’Œtypeï¼Œè¿™é‡Œæ ¹æ®ç»„åˆåˆ†ä¸º4ç§æƒ…å†µï¼š</p>
<ul>
<li>æŒ‡å®šnameå’Œtypeï¼šé€šè¿‡nameæ‰¾åˆ°å”¯ä¸€beanï¼Œæ‰¾ä¸åˆ°æŠ›å‡ºå¼‚å¸¸ï¼›å¦‚æœtypeå’Œå­—æ®µç±»å‹ä¸ä¸€è‡´ï¼Œä¹Ÿä¼šæŠ›å‡ºå¼‚å¸¸ã€‚</li>
<li>æŒ‡å®šnameï¼šé€šè¿‡nameæ‰¾åˆ°å”¯ä¸€çš„beanï¼Œæ‰¾ä¸åˆ°åˆ™æŠ›å‡ºå¼‚å¸¸</li>
<li>æŒ‡å®štypeï¼šé€šè¿‡typeæ‰¾å”¯ä¸€çš„Beanï¼Œå¦‚æœä¸å”¯ä¸€ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼šNoSuchBeanDefinitionExceptionã€‚</li>
<li>ä¸æŒ‡å®šnameå’Œtypeï¼šé€šè¿‡å­—æ®µåä½œä¸ºkeyå»æŸ¥æ‰¾ï¼›æ‰¾ä¸åˆ°åˆ™é€šè¿‡å­—æ®µç±»å‹å»æŸ¥æ‰¾ï¼Œå¦‚æœä¸å”¯ä¸€ï¼Œåˆ™æŠ›å‡ºå¼‚å¸¸ï¼šNoSuchBeanDefinitionException</li>
</ul>
<p>@Resourceè£…é…çš„é¡ºåºå¦‚ä¸‹ï¼š</p>
<p>1.å¦‚æœåŒæ—¶æŒ‡å®šäº†nameå’Œtypeå—ï¼Œåˆ™ä¼šä»Springä¸Šä¸‹æ–‡ç§æ‰¾åˆ°å”¯ä¸€åŒ¹é…çš„beanè¿›è¡Œè£…é…ï¼Œæ‰¾ä¸åˆ°åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚<br>
2.å¦‚æœæŒ‡å®šäº†nameï¼Œåˆ™ä»Springä¸Šä¸‹æ–‡ç§æŸ¥æ‰¾åç§°(id)åŒ¹é…çš„beanè¿›è¡Œè£…é…ï¼Œæ‰¾ä¸åˆ°åˆ™æŠ›å‡ºå¼‚å¸¸<br>
3.å¦‚æœæŒ‡å®šäº†typeï¼Œåˆ™ä»Springä¸Šä¸‹æ–‡ç§æ‰¾åˆ°æŒ‡å®šç±»å‹åŒ¹é…çš„å”¯ä¸€Beanè¿›è¡Œè£…é…ï¼Œæ‰¾ä¸åˆ°æˆ–è€…æ‰¾åˆ°å¤šä¸ªéƒ½æŠ›å‡ºå¼‚å¸¸<br>
4.å¦‚æœæ—¢æ²¡æŒ‡å®šnameï¼Œä¹Ÿæ²¡æœ‰æŒ‡å®štypeï¼Œåˆ™è‡ªåŠ¨æŒ‰ç…§byNameæ–¹å¼è¿›è¡Œè£…é…ï¼Œå¦‚æœæ²¡æœ‰åŒ¹é…ï¼Œåˆ™å›é€€ä¸€ä¸ªåŸå§‹ç±»å‹è¿›è¡ŒåŒ¹é…ï¼Œå¦‚æœåŒ¹é…åˆ™è‡ªåŠ¨è£…é…ã€‚</p>
<p>@Resourceä¸@AutowireåŒºåˆ«<br>
é€šè¿‡å¯¹@Resourceçš„ä»‹ç»å‘ç°å®ç°è‡ªåŠ¨è£…é…çš„æ–¹å¼ä¸@Autowireå¤§åŒå°å¼‚ï¼Œé‚£ä¹ˆåˆ°åº•ä»–ä»¬ä¹‹é—´æœ‰ä»€ä¹ˆåŒºåˆ«å‘¢ï¼Ÿæˆ‘ä»¬ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥çœ‹ï¼š</p>
<ul>
<li>@Autowireæ˜¯Springå®šä¹‰çš„æ³¨è§£ ï¼Œè€Œ@Resourceæ˜¯JSR-250å®šä¹‰çš„æ³¨è§£</li>
<li>@Autowireé»˜è®¤æŒ‰ç…§ByTypeè‡ªåŠ¨è£…é…ï¼Œè€Œ@Resourceé»˜è®¤byNameè‡ªåŠ¨è£…é…</li>
<li>@AutowireåªåŒ…å«ä¸€ä¸ªå‚æ•°ï¼šrequiredï¼Œè¡¨ç¤ºæ˜¯å¦å¼€å¯è‡ªåŠ¨è£…é…,é»˜è®¤æ˜¯trueã€‚è€Œ@ResourceåŒ…å«ä¸ƒä¸ªå‚æ•°ï¼Œå…¶ä¸­æœ€é‡è¦çš„å‚æ•°æ˜¯nameå’Œtypeã€‚</li>
<li>@Autowireå¦‚æœä½¿ç”¨byNameï¼Œéœ€è¦ä½¿ç”¨@Qualifiedä¸€èµ·é…åˆã€‚è€Œ@Resourceå¦‚æœæŒ‡å®šname,åˆ™ç”¨byNameè‡ªåŠ¨è£…é…ï¼Œå¦‚æœæŒ‡å®šäº†byTypeï¼Œåˆ™ç”¨byTypeè‡ªåŠ¨è£…é…ã€‚</li>
<li>@Autowireèƒ½å¤Ÿç”¨åœ¨æ„é€ å™¨ï¼Œæ–¹æ³•ï¼Œå‚æ•°ï¼Œæˆå‘˜å˜é‡å’Œæ³¨è§£ä¸Šã€‚è€Œ@Resourceèƒ½ç”¨åœ¨ç±»ã€æˆå‘˜å˜é‡ã€æ–¹æ³•ä¸Šã€‚</li>
</ul>
<p>å¦å¤–ä»–ä»¬çš„è£…é…é¡ºåºä¸åŒ</p>
<p>@Autowireè£…é…é¡ºåºï¼ŒæŒ‰ç…§ç±»å‹æŸ¥æ‰¾Beanï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›´æ¥æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œåˆ¤æ–­æ˜¯å¦æ‰¾åˆ°ä¸€ä¸ªbeanï¼Œå¦‚æœæ˜¯åªæœ‰ä¸€ä¸ªbeanè¿›è¡Œè‡ªåŠ¨è£…é…ã€‚<br>
å¦‚æœå­˜åœ¨å¤šä¸ªbeançš„æƒ…å†µåˆ¤æ–­æ˜¯å¦é…ç½®äº†Qualifierï¼Œå¦‚æœé…ç½®äº†é‚£ä¹ˆæŒ‰ç…§Qualifierå‚æ•°æŸ¥æ‰¾bean,å¦‚æœæ‰¾åˆ°è¿›è¡Œè‡ªåŠ¨è£…é…ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚<br>
å¦‚æœæ²¡æœ‰é…ç½®QualifieræŒ‰ç…§åç§°æŸ¥æ‰¾beanï¼Œæ‰¾åˆ°äº†å°±è‡ªåŠ¨è£…é…ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ã€‚</p>
<figure data-type="image" tabindex="3"><img src="../framework/images/spring-autowire.png" alt="Autowiredè‡ªåŠ¨è£…é…" loading="lazy"></figure>
<p>@ResourceåŒæ—¶æŒ‡å®šäº†nameå’Œtypeè£…é…é¡ºåºå¦‚ä¸‹å›¾æ‰€ç¤º</p>
<p>å¦‚æœæŒ‡å®šäº†nameå’Œtypeçš„æƒ…å†µï¼Œå›å»æŸ¥æ‰¾nameå’Œtypeå”¯ä¸€çš„beanå¦‚æœæ²¡æœ‰æ‰¾åˆ°æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæ‰¾åˆ°äº†è‡ªåŠ¨è£…é…ã€‚</p>
<figure data-type="image" tabindex="4"><img src="../framework/images/spring-resource-name-type.png" alt="Resourceè£…é…" loading="lazy"></figure>
<p>å½“ResourceæŒ‡å®šäº†nameçš„æƒ…å†µï¼Œä¼šæŸ¥æ‰¾nameå”¯ä¸€åŒ¹é…çš„beanï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæ‰¾åˆ°äº†è‡ªåŠ¨è£…é…ã€‚</p>
<figure data-type="image" tabindex="5"><img src="../framework/images/spring-resource-name.png" alt="Resourceè£…é…" loading="lazy"></figure>
<p>å½“ResourceæŒ‡å®šäº†typeçš„æƒ…å†µï¼Œä¼šæŸ¥æ‰¾typeå”¯ä¸€åŒ¹é…çš„beanï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæ‰¾åˆ°äº†è‡ªåŠ¨è£…é…ã€‚</p>
<figure data-type="image" tabindex="6"><img src="../framework/images/spring-resource-type.png" alt="Resourceè£…é…" loading="lazy"></figure>
<p>å½“Resourceæ—¢æ²¡æŒ‡å®šnameåˆæ²¡æŒ‡å®štypeæ—¶ï¼Œé¦–å…ˆæŒ‰ç…§åç§°æŸ¥æ‰¾beanï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°åœ¨æŒ‰ç…§ç±»å‹æŸ¥æ‰¾beanï¼Œå¦‚æœæ²¡æœ‰æ‰¾åˆ°æˆ–è€…æ‰¾åˆ°å¤šä¸ªå°±æŠ›å‡ºå¼‚å¸¸ï¼Œå¦‚æœæ‰¾åˆ°ä¸€ä¸ªå°±è¿›è¡Œè‡ªåŠ¨è£…é…ã€‚</p>
<figure data-type="image" tabindex="7"><img src="../framework/images/spring-resource-noname-notype.png" alt="Resourceè£…é…" loading="lazy"></figure>
<h3 id="spring-iocä¾èµ–æ¥æºæœ‰å“ªäº›">Spring IOCä¾èµ–æ¥æºæœ‰å“ªäº›ï¼Ÿ</h3>
<p>å‰é¢ä¸¤èŠ‚è¯¾ä»‹ç»äº†Spring IOCçš„ä¾èµ–æŸ¥æ‰¾å’Œä¾èµ–æ³¨å…¥çš„ä¸¤ç§æ–¹å¼ï¼Œå®é™…ä¸Šé’ˆå¯¹è¿™ä¸¤ç§æ–¹å¼éƒ½å¯¹åº”äº†ä¾èµ–æ¥æºã€‚ä»Šå¤©é’ˆå¯¹SpringIOCçš„ä¾èµ–å±•å¼€ä»‹ç»ï¼ŒåŒ…æ‹¬å¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>è‡ªå®šä¹‰Beanä½œä¸ºä¾èµ–é¡¹</li>
<li>å®¹å™¨å†…å»ºBeanå¯¹è±¡ä½œä¸ºä¾èµ–æ¥æº</li>
<li>å®¹å™¨å†…å»ºä¾èµ–ä½œä¸ºä¾èµ–æ¥æº</li>
</ul>
<p>å®¹å™¨å†…å»ºçš„Beanå¯¹è±¡å¹¶ä¸æ˜¯æˆ‘ä»¬åˆ›å»ºçš„è€Œæ˜¯Springå†…éƒ¨å®ä¾‹åŒ–äº§ç”Ÿçš„ï¼Œè¯´ç™½äº†å°±æ˜¯Springå†…éƒ¨è‡ªå·±éœ€è¦ä½¿ç”¨ä»è€Œåˆ›å»ºçš„Beanã€‚åŒæ—¶ä¹Ÿå¯ä»¥é€šè¿‡beanFactory.getBean()çš„æ–¹å¼è¿›è¡Œä¾èµ–æŸ¥æ‰¾ã€‚</p>
<ul>
<li>Environmentå¯¹è±¡ï¼Œåœ¨å¤–éƒ¨åŒ–é…ç½®å’ŒProfilesåœºæ™¯ä½¿ç”¨</li>
<li>java.util.Propertieså¯¹è±¡ï¼Œè¢«ç”¨åˆ°Javaç³»ç»Ÿå±æ€§åœºæ™¯ã€‚</li>
<li>Java.util.Mapå¯¹è±¡ï¼Œå¯ä»¥ä½¿ç”¨åˆ°æ“ä½œç³»ç»Ÿç¯å¢ƒå˜é‡çš„åœºæ™¯</li>
<li>MessageSourceå¯¹è±¡ï¼Œä½œä¸ºå›½é™…åŒ–æ–‡æ¡ˆ</li>
<li>LifecycleProcessorå¯¹è±¡ï¼Œç”¨æ¥å¤„ç†LifecycleBeanå¤„ç†å™¨</li>
<li>ApplicationEventMulticasterå¯¹è±¡ï¼Œç”¨æ¥å¤„ç†Springæ—¶é—´å¹¿æ’­å™¨</li>
</ul>
<p>å®¹å™¨å†…å»ºä¾èµ–ä½œä¸ºä¾èµ–é¡¹</p>
<p>å®¹å™¨å†…å»ºä¾èµ–ä¹Ÿç§°ä½œä¸ºéBeanå¯¹è±¡ï¼Œä¸ºä»€ä¹ˆè¿™ä¹ˆè¯´å‘¢ï¼Ÿå› ä¸ºè¿™ç±»å¯¹è±¡å¹¶ä¸æ˜¯Spring çš„Beanï¼Œæ¯”å¦‚è¯´Bean Factoryå°±æ˜¯è¿™ç±»å¯¹è±¡ï¼Œ<br>
ä½†æ˜¯è¿™ç±»å¯¹è±¡å¿…é¡»æ—¶Springå¯åŠ¨å¿…é¡»çš„ç»„ä»¶ï¼Œä¹Ÿå°±æ˜¯åŸºç¡€ç»„ä»¶ã€‚åŸºäºä»¥ä¸ŠåŸå› å®¹å™¨å†…å»ºä¾èµ–æ˜¯ä¸èƒ½é€šè¿‡beanFactory.getBean()çš„æ–¹å¼ä¾èµ–æŸ¥æ‰¾å‡ºæ¥çš„ã€‚</p>
<p>å¯¹äºå®¹å™¨å†…å»ºä¾èµ–å…·æœ‰ä¸€ä¸‹ç‰¹å¾ï¼šæ— ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼Œæ— æ³•å®ç°å»¶è¿Ÿåˆå§‹åŒ–Beanï¼Œæ— æ³•é€šè¿‡ä¾èµ–æŸ¥æ‰¾ã€‚æ­¤ç±»å¯¹è±¡åŒ…æ‹¬ï¼š<br>
beanFactoryã€ResourceLoaderã€ApplicationEventPublisherã€ApplicationContextä»åå­—ä¸Šçœ‹éƒ½æ˜¯ç³»ç»Ÿçº§åˆ«çš„å¯¹è±¡ã€‚<br>
å¦‚æœä¸€å®šè¦å¯¹è¿™äº›å˜é‡æ³¨å†Œï¼Œå¯ä»¥ä½¿ç”¨ConfigurableListableBeanFactoryç§çš„registerResolvableDependencyæ–¹æ³•ã€‚</p>
<h3 id="ç²¾é€‰é¢è¯•é¢˜valueæ˜¯å¦‚ä½•å°†å¤–éƒ¨åŒ–é…ç½®æ³¨å…¥åˆ°spring-beanä¸­">ç²¾é€‰é¢è¯•é¢˜ï¼š@Valueæ˜¯å¦‚ä½•å°†å¤–éƒ¨åŒ–é…ç½®æ³¨å…¥åˆ°spring beanä¸­ï¼Ÿ</h3>
<p>å‰ä¸¤èŠ‚è¯¾ä»‹ç»äº†SpringIOCä¾èµ–æŸ¥æ‰¾å’Œä¾èµ–æ³¨å…¥çš„ä¸¤ç§æ–¹å¼ï¼Œå®é™…ä¸Šé’ˆå¯¹è¿™ä¸¤ç§æ–¹å¼éƒ½å¯¹åº”äº†ä¾èµ–æ¥æºã€‚ä»Šå¤©ç»™å¤§å®¶è®²è§£@Valueå¦‚ä½•å°†å¤–éƒ¨åŒ–é…ç½®<br>
æ³¨å…¥åˆ°Spring Beanä¸­ï¼ŒåŒ…æ‹¬å¦‚ä¸‹å†…å®¹ï¼š</p>
<ul>
<li>@Valueè·å–é…ç½®çš„ä»‹ç»</li>
<li>åŸºäºé…ç½®æ–‡ä»¶æ³¨å…¥</li>
<li>åŸºäºéé…ç½®æ–‡ä»¶æ³¨å…¥</li>
<li>é»˜è®¤å€¼æ³¨å…¥</li>
</ul>
<h4 id="valueè·å–é…ç½®çš„ç®€ä»‹">@Valueè·å–é…ç½®çš„ç®€ä»‹</h4>
<p>@Value æ˜¯ä¸€ç§è·å–å¤–éƒ¨é…ç½®çš„æ–¹å¼ï¼Œæ˜¯SpringBootä¸­çš„ä¸€ç§ç”¨æ³•ï¼Œåœ¨SpringBootå…è®¸å°†é…ç½®æ–‡ä»¶å¤–éƒ¨åŒ–ï¼Œè¿™æ ·èƒ½å¤Ÿåœ¨ä¸åŒçš„ç¯å¢ƒä¸‹<br>
ä½¿ç”¨ç›¸åŒçš„ä»£ç ã€‚å¯ä»¥ä½¿ç”¨propertiesæ–‡ä»¶ï¼Œymlæ–‡ä»¶ç¯å¢ƒå˜é‡å’Œå‘½ä»¤è¡Œå‚æ•°æ¥å¤–éƒ¨åŒ–é…ç½®ã€‚ä½¿ç”¨@Valueæ³¨è§£ï¼Œå¯ä»¥ç›´æ¥å°†å±æ€§å€¼æ³¨å…¥åˆ°beansä¸­ã€‚<br>
ç„¶åé€šè¿‡Springçš„EnvironmentæŠ½è±¡æˆ–è€…é€šè¿‡@ConfigurationPropertiesç»‘å®šåˆ°ç»“æ„åŒ–å¯¹è±¡æ¥è®¿é—®ï¼Œè¿™é‡Œæˆ‘ä»¬ä»‹ç»3ç§æ–‡ä»¶æ³¨å…¥çš„æ–¹å¼ï¼Œ<br>
åˆ†åˆ«æ˜¯åŸºäºé…ç½®æ–‡ä»¶æ³¨å…¥ï¼ŒåŸºäºéé…ç½®æ–‡ä»¶æ³¨å…¥ï¼Œé»˜è®¤å€¼æ³¨å…¥ã€‚</p>
<h4 id="åŸºäºé…ç½®æ–‡ä»¶æ³¨å…¥">åŸºäºé…ç½®æ–‡ä»¶æ³¨å…¥</h4>
<pre><code>åŸºäºé…ç½®æ–‡ä»¶æ³¨å…¥ï¼Œé¡¾åæ€ä¹‰èµ·æºå¤´æ¥è‡ªäºé…ç½®æ–‡ä»¶ã€‚è¿™äº›é…ç½®æ–‡ä»¶æ³¨å…¥applcation.propertiesæˆ–è€…è‡ªå®šä¹‰*.properties.
ä¾‹å¦‚ï¼šapplication.propertiesé…ç½®æ–‡ä»¶ç§å®šä¹‰å±æ€§å€¼çš„å½¢å¼å¦‚ä¸‹ï¼›
user.name=admin
å‡è®¾å­˜åœ¨è‡ªå®šä¹‰é…ç½®æ–‡ä»¶my.properties,é…ç½®æ–‡ä»¶ä¸­å®šä¹‰äº†å¦‚ä¸‹å±æ€§
user.password=123456 
å¦‚æœéœ€è¦åšåœ¨ç±»ä¸­ä½¿ç”¨è¿™ä¸¤ä¸ªé…ç½®å€¼å¦‚ä½•åšå‘¢ï¼Œçœ‹å¦‚ä¸‹ç¼–ç ï¼š
</code></pre>
<pre><code class="language-java">    @PropertySource(&quot;classpath:my.properties&quot;)
    @RestController
    public class ValueController{
    
     /**
      *
       *è·å–application.propertiesä¸­çš„é…ç½®å±æ€§
       */
     @Value(&quot;$(user.name)&quot;)
     private String name;
    /**
     *
     *è·å–my.propertiesä¸­çš„é…ç½®å±æ€§
     */
    @Value(&quot;$(user.password)&quot;)
    private String password;
}

</code></pre>
<pre><code>ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºä»application.propertiesé…ç½®ä¸­è·å–user.nameçš„ä¿¡æ¯å¡«å……åˆ°å˜é‡nameä¸­ï¼Œ
åœ¨ä»è‡ªå®šä¹‰é…ç½®æ–‡ä»¶ä¸­è·å–my.propertiesä¸­user.propertieså¡«å……åˆ°passwordå˜é‡ä¸­ã€‚

å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœè‡ªå®šä¹‰my.propertiesæ–‡ä»¶ï¼Œéœ€è¦åœ¨æŸä¸ªç±»ä¸­é€šè¿‡PropertySourceå¼•å…¥æ”¹é…ç½®æ–‡ä»¶é¢ï¼Œè€Œapplication.propertiesä¸­çš„å±æ€§ä¼šè‡ªåŠ¨è¢«åŠ è½½ã€‚


é€šè¿‡@Valueæ³¨å…¥å•ä¸ªèˆ’å¿ƒçš„åŒæ—¶ï¼Œä¹Ÿå¯ä»¥æ³¨å…¥æ•°ç»„å’Œåˆ—è¡¨å½¢å¼ã€‚å¦‚æœå­˜åœ¨ä¸€ä¸‹é…ç½®ï¼š
tools=car,train,airplane

é‚£ä¹ˆå¯ä»¥é€šè¿‡å¦‚ä¸‹ä»£ç è¿›è¡Œæ³¨å…¥ï¼š
</code></pre>
<pre><code class="language-java">
    /**
     * 
     * æ³¨å…¥æ•°ç»„ï¼Œè‡ªåŠ¨æ ¹æ®&quot;,&quot;åˆ†å‰²
     */
    @Value(&quot;${tools}&quot;)
    private String[] tools;
    /**
     *
     * æ³¨å…¥åˆ—è¡¨ï¼Œè‡ªåŠ¨æ ¹æ®&quot;,&quot;åˆ†å‰²
     */
    @Value(&quot;${tools}&quot;)
    private List&lt;String&gt; tools;
</code></pre>
<pre><code>Springé»˜è®¤æƒ…å†µä¸‹ä¼šä»¥&quot;,&quot;è¿›è¡Œåˆ†å‰²ï¼Œå°†é…ç½®æ–‡ä»¶ä¸­çš„toolåŒ…å«å†…å®¹åˆ‡å‰²åŸ&quot;car&quot;ï¼Œ&quot;train&quot;ï¼Œ&quot;airplane&quot;ç»„æˆçš„æ•°ç»„æˆ–è€…åˆ—è¡¨ä¿å­˜åˆ°æ•°ç»„æˆ–è€…åˆ—è¡¨ä¸­ã€‚
</code></pre>
<h4 id="åŸºäºéé…ç½®æ–‡ä»¶æ³¨å…¥">åŸºäºéé…ç½®æ–‡ä»¶æ³¨å…¥</h4>
<pre><code>  åŸºäºéé…ç½®æ–‡ä»¶æ³¨å…¥ï¼Œéœ€è¦ç”¨åˆ°SPEl(Spring Expression Language)å³Springè¡¨è¾¾å¼è¯­è¨€å¯¹@Valueè¿›è¡Œä¿®é¥°è€Œä¼ é€’é…ç½®ä¿¡æ¯

  ä¸‹é¢å°±æ¥çœ‹å‡ ä¸ªåº”ç”¨åœºæ™¯

  æ³¨å…¥æ™®é€šå­—ç¬¦ä¸²ï¼Œç›¸å½“äºç›´æ¥ç»™å±æ€§é»˜è®¤å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š
</code></pre>
<pre><code class="language-java">
    /**
     *æ³¨å…¥æ™®é€šå­—ç¬¦ä¸²ï¼Œä»£ç å¦‚ä¸‹ï¼š
     */
    @Value(&quot;æµ‹è¯•&quot;)
    private String wechatSubscription;

    /**
     *æ³¨å…¥æ™®é€šå­—ç¬¦ä¸²ï¼Œä»£ç å¦‚ä¸‹ï¼š
     */
    @Value(&quot;#{systemProperties['os.name']}&quot;)
    private String systemPropertiesName;

    /**
     *æ³¨å…¥è¡¨è¾¾å¼ç»“æœï¼Œä»£ç å¦‚ä¸‹ï¼š
     */
    @Value(&quot;#{T(java.lang.math).random()*100}&quot;)
    private String systemPropertiesName;
    /**
     *æ³¨å…¥å…¶å®ƒBeanå±æ€§:æ³¨å…¥configå¯¹è±¡å±æ€§toolï¼Œä»£ç å¦‚ä¸‹ï¼š
     */
    @Value(&quot;#{config.tool}&quot;)
    private String systemPropertiesName;
    
    /**
     *æ³¨å…¥åˆ—è¡¨å½¢å¼ï¼ˆè‡ªåŠ¨æ ¹æ®&quot;ï½œ&quot;åˆ†å‰²ï¼‰ï¼Œä»£ç å¦‚ä¸‹ï¼š
     */
    @Value(&quot;#{'${word}'}.split('\\|')&quot;)
    private List&lt;String&gt; numList;


    /**
     *æ³¨å…¥URLèµ„æºï¼Œä»£ç å¦‚ä¸‹ï¼š
     */
    @Value(&quot;http://www.baidu.com&quot;)
    private List&lt;String&gt; numList;

</code></pre>
<h4 id="é»˜è®¤å€¼æ³¨å…¥">é»˜è®¤å€¼æ³¨å…¥</h4>
<pre><code>è¯´äº†é…ç½®æ–‡ä»¶å’Œéé…ç½®æ–‡ä»¶çš„#Valueæ³¨å…¥ï¼Œè¿™é‡Œå†åŠ å…¥é»˜è®¤å€¼çš„æ³¨å…¥æ–¹å¼ï¼Œé¡¾åæ€ä¹‰å°±æ˜¯åœ¨é…ç½®ä¸ºç©ºæˆ–è€…æ²¡æœ‰è®¾ç½®å…·ä½“å€¼çš„æ—¶å€™ï¼Œä½¿ç”¨é»˜è®¤å€¼å¡«å……ç›®æ ‡å¯¹è±¡ã€‚
è¿™é‡Œæˆ‘ä»¬æ•´ç†äº†é›†ä¸­æƒ…å†µï¼Œå¤§å®¶å‚è€ƒã€‚
</code></pre>
<pre><code class="language-java"> /**
  *å¦‚æœå±æ€§ä¸­ä¸ºé…ç½®ipï¼Œåˆ™ä½¿ç”¨é»˜è®¤å€¼ï¼Œä»£ç å¦‚ä¸‹ï¼š
  */

 @Value(&quot;${ip:127.0.0.1}&quot;)
 private String ip;

/**
 *å¦‚æœç³»ç»Ÿä¸­æœªè·å–åˆ°portçš„å€¼ï¼Œåˆ™ä½¿ç”¨8888ï¼Œä»£ç å¦‚ä¸‹ï¼š
 * å…¶ä¸­${}ä¸­ç›´æ¥ä½¿ç”¨ï¼šå¯¹æœªå®šä¹‰æˆ–è€…æœªç©ºçš„å€¼è¿›è¡Œé»˜è®¤å€¼è®¾ç½®ï¼Œè€Œ#{}åˆ™éœ€è¦ä½¿ç”¨&quot;ï¼Ÿï¼š&quot;å¯¹æœªè®¾ç½®çš„å±æ€§è¿›è¡Œé»˜è®¤å€¼è®¾ç½®ã€‚
 */

@Value(&quot;#{systemProperties['port']ï¼Ÿ:8888}&quot;)
private String port;

 
</code></pre>
<h3 id="ç²¾é€‰é¢è¯•é¢˜spring-iocå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜">ç²¾é€‰é¢è¯•é¢˜ï¼šspring IOCå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼Ÿ</h3>
<h4 id="ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–">ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–</h4>
<pre><code>SpringIOCä¸­å¾ªç¯ä¾èµ–å…¶å®å°±æ˜¯å¾ªç¯å¼•ç”¨ï¼Œä¸¤ä¸ªæˆ–è€…ä¸¤ä¸ªä»¥ä¸Šçš„Beanäº’ç›¸æŒæœ‰å¯¹æ–¹ï¼Œæœ€ç»ˆå½¢æˆé—­ç¯ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œå¦‚Aä¾èµ–äºBï¼Œ
Bä¾èµ–äºCï¼ŒCåˆä¾èµ–äºAã€‚è¿™ç§ä¸€ä¸ªåœºæ™¯ï¼Œåˆå§‹åŒ–Açš„æ—¶å€™éœ€è¦å‡ºåˆå§‹åŒ–Bçš„åˆå§‹åŒ–ï¼Œè€Œå®ŒæˆBçš„åˆå§‹åŒ–åˆéœ€è¦å®Œæˆåˆå§‹åŒ–Cçš„åˆå§‹åŒ–ï¼Œ
æœ€åCåˆä¾èµ–äºAï¼Œå¦‚æ­¤è¿™èˆ¬Aæ°¸è¿œæ— æ³•å®Œæˆåˆå§‹åŒ–æ“ä½œã€‚è¿™ç§å¯¹è±¡ç›¸äº’ä¾èµ–å½¢æˆé—­å…³çš„å…³ç³»ç§°ä¸ºå¾ªç¯ä¾èµ–ã€‚
</code></pre>
<figure data-type="image" tabindex="8"><img src="../framework/images/xunhuanyilai.png" alt="å¾ªç¯ä¾èµ–" loading="lazy"></figure>
<pre><code>åœ¨SpringIOCçš„ä½¿ç”¨åœºæ™¯ä¸­æœ‰ä¸¤ç±»å¾ªç¯ä¾èµ–æ˜¯æ— è§£çš„ï¼š
</code></pre>
<ul>
<li>æ„é€ å™¨å¾ªç¯ä¾èµ–ï¼šæ„é€ å™¨è¦è°ƒç”¨æ„é€ å‡½æ•°newå‡ºä¸€ä¸ªå¯¹è±¡æ¥ï¼Œè€Œå‚æ•°æœ‰ä¾èµ–å¦å¤–ä¸€ä¸ªå¯¹è±¡ã€‚åˆ›å»ºç±»Aä¾èµ–äºç±»Bï¼Œnewçš„æ—¶å€™å»åˆ›å»ºç±»Bå‘ç°ç±»Bä¸å­˜åœ¨å°±ä¼šæŠ›å‡ºBeanCurrentlyCreationExceptionå¼‚å¸¸</li>
<li>prototypeåŸå‹beançš„åˆå§‹åŒ–è¿‡ç¨‹ä¸­ä¸è®ºæ˜¯é€šè¿‡æ„é€ å™¨å‚æ•°å¾ªç¯ä¾èµ–è¿˜æ˜¯é€šè¿‡setæ–¹å¼äº§ç”Ÿå¾ªç¯ä¾èµ–ä¹Ÿä¼šæŠ›å‡ºå¼‚å¸¸.</li>
</ul>
<p>ç„¶è€Œé’ˆå¯¹singleton beançš„å¾ªç¯ä¾èµ–çš„åœºæ™¯å¯ä»¥é€šè¿‡ä¸‰çº§ç¼“å­˜çš„æ–¹å¼è§£å†³,ä¸‹é¢å°±æ ¹æ®è¯¥è§£å†³æ–¹æ¡ˆå±•å¼€è¯´æ˜.</p>
<h4 id="spring-iocå¤„ç†å¾ªç¯ä¾èµ–çš„æ€è·¯">spring iocå¤„ç†å¾ªç¯ä¾èµ–çš„æ€è·¯</h4>
<p>å†æ•´ç†spring iocå¤„ç†singleton beanå¾ªç¯ä¾èµ–çš„æ€è·¯ä¹‹å‰å…ˆæ¥å¤ä¹ ä¸€ä¸‹beançš„ç”Ÿå‘½å‘¨æœŸ,å…¶åŒ…æ‹¬ä¸‰ä¸ªæ­¥éª¤:</p>
<ul>
<li>å®ä¾‹åŒ–,æ‰§è¡Œbeançš„æ„é€ æ–¹æ³•,beanä¸­çš„ä¾èµ–å¯¹è±¡è¿˜æœªèµ‹å€¼.</li>
<li>è®¾ç½®å±æ€§,ç»™beanä¸­ä¾èµ–çš„å¯¹è±¡èµ‹å€¼,è‹¥è¢«ä¾èµ–çš„å¯¹è±¡å°šæœªåˆå§‹åŒ–,åˆ™å…ˆè¿›è¡Œè¯¥å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ(é€’å½’).</li>
<li>åˆå§‹åŒ–:æ‰§è¡Œbeançš„åˆå§‹åŒ–æ–¹æ³•,å›è°ƒæ–¹æ³•ç­‰.</li>
</ul>
<p>è§£å†³å¾ªç¯ä¾èµ–çš„æ€è·¯å°±è—åœ¨è¿™ä¸‰ä¸ªæ­¥éª¤ä¸­,åœ¨å®ä¾‹åŒ–äºè®¾ç½®å±æ€§ä¸¤ä¸ªä¸èµ°ä¹‹é—´å¼•å…¥ç¼“å­˜æœºåˆ¶,å°†å·²ç»å»ºå¥½çš„å®ä¾‹ä½†æ˜¯å¹¶æ²¡æœ‰è®¾ç½®å±æ€§çš„beanæ”¾å…¥ç¼“å­˜ä¸­,ç¼“å­˜ä¸­æ˜¯æ²¡æœ‰å±æ€§è®¾ç½®çš„å®ä¾‹å¯¹è±¡,å‡è®¾Aå¯¹è±¡å’ŒBå¯¹è±¡ç›¸äº’ä¾èµ–,<br>
Aå¯¹è±¡çš„åˆ›å»ºéœ€è¦å¼•ç”¨Bå¯¹è±¡,è€ŒBå¯¹è±¡çš„åˆ›å»ºä¹Ÿéœ€è¦Aå¯¹è±¡.åœ¨åˆ›å»ºAå¯¹è±¡çš„æ—¶å€™å¯ä»¥å°†å…¶æ”¾å…¥ç¼“å­˜ä¸­,å½“Bå¯¹è±¡åˆ›å»ºçš„æ—¶å€™ç›´æ¥ä»ç¼“å­˜é‡Œå¼•ç”¨Aå¯¹è±¡,<br>
(æ­¤æ—¶çš„Aå¯¹è±¡åªå®Œæˆäº†å®ä¾‹åŒ–,å¹¶æ²¡æœ‰ç»è¡Œè®¾ç½®å±æ€§çš„æ“ä½œ,å› æ­¤ä¸æ˜¯å®Œæˆçš„Aå¯¹è±¡,æˆ‘ä»¬ç§°ä¹‹ä¸ºåŠæˆå“Aå¯¹è±¡),å½“Bå¯¹è±¡åˆ©ç”¨è¿™ä¸ªåŠæˆå“çš„Aå¯¹è±¡å®Œæˆå®ä¾‹åˆ›å»ºä»¥å(ä¸‰ä¸ªæ­¥éª¤éƒ½å®Œæˆ),åœ¨è¢«Aå¯¹è±¡å¼•ç”¨è¿›å»,åˆ™Aå¯¹è±¡ä¹Ÿå®Œæˆäº†åˆ›å»º.</p>
<p>ä¸Šæ–‡æåˆ°çš„ç¼“å­˜åœ¨è¿™é‡Œåšä¸ªè§£é‡Š,æˆ‘ä»¬å°†å…¶åˆ†ä¸ºä¸‰çº§,æ¯çº§ç¼“å­˜éƒ½èµ·åˆ°ä¸åŒçš„ä½œç”¨,å¦‚ä¸‹è¡¨æ ¼æ‰€ç¤º</p>
<table>
<thead>
<tr>
<th>æºç </th>
<th>çº§åˆ«</th>
<th>æè¿°</th>
</tr>
</thead>
<tbody>
<tr>
<td>singletonObjects</td>
<td>ä¸€çº§ç¼“å­˜</td>
<td>ç”¨äºå­˜æ”¾å®Œå…¨åˆå§‹åŒ–å¥½çš„bean,ä»è¯¥ç¼“å­˜ä¸­è¯»å–çš„beanå¯ä»¥ç›´æ¥ä½¿ç”¨</td>
</tr>
<tr>
<td>earlySingletonObjects</td>
<td>äºŒçº§ç¼“å­˜</td>
<td>å­˜æ”¾åŸå§‹çš„beanå¯¹è±¡(å°šæœªå¡«å……å±æ€§),ç”¨äºè§£å†³å¾ªç¯ä¾èµ–</td>
</tr>
<tr>
<td>singletonFactories</td>
<td>ä¸‰çº§ç¼“å­˜</td>
<td>å­˜æ”¾beançš„å·¥å‚å¯¹è±¡,ç”¨äºè§£å†³å¾ªç¯ä¾èµ–</td>
</tr>
</tbody>
</table>
<p>è§£å†³å¾ªç¯ä¾èµ–çš„æ•´ä¸ªè¿‡ç¨‹æ˜¯:</p>
<p>å…ˆä»ä¸€çº§ç¼“å­˜é‡Œå–å‡ºbeanå®ä¾‹,å¦‚æœæ²¡æœ‰å¯¹åº”çš„beanå®ä¾‹,äºŒçº§ç¼“å­˜é‡Œå–,å¦‚æœäºŒçº§ç¼“å­˜é‡Œä¹Ÿæ²¡æœ‰beanå®ä¾‹,singletonFactories<br>
ä¸‰çº§ç¼“å­˜é‡Œè·å–.ç”±äºä¸‰çº§ç¼“å­˜å­˜æ”¾ç€äº§ç”Ÿbeanå®ä¾‹çš„å·¥å‚ç±»,å› æ­¤ä¹Ÿå¯ä»¥é€šè¿‡è¯¥å·¥å‚ç±»äº§ç”Ÿbeanå®ä¾‹.</p>
<p>è¿™é‡Œå¯ä»¥è°ƒç”¨å·¥å‚ç±»è°ƒç”¨çš„getObjectsæ–¹æ³•è¿”å›æ—©æœŸæš´éœ²å¯¹è±¡å¼•ç”¨,ä¹Ÿå°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„åŠæˆå“bean,ä¹Ÿå¯ä»¥æˆä¸ºearlySingletonObjects.<br>
å¹¶ä¸”å°†è¿™ä¸ªåŠæˆå“çš„beanæ”¾åˆ°äºŒçº§ç¼“å­˜é‡Œ,åœ¨ä¸‰çº§ç¼“å­˜é‡Œåˆ é™¤è¯¥bean.ä»€ä¹ˆæ—¶å€™è¿™ä¸ªåŠæˆå“å¡«å……äº†å±æ€§ä¹‹å,å°±è¢«ç§»åŠ¨åˆ°ä¸€çº§ç¼“å­˜ä¸­.<br>
ä¹Ÿå°±æ˜¯è¢«ç§°ä¸ºå¯ä»¥ä½¿ç”¨å®Œæˆåˆå§‹åŒ–å®ä¾‹beanäº†,å¤„ç†å¾ªç¯ä¾èµ–çš„è¿‡ç¨‹å®£å‘Šå®Œæ¯•,ä¸‹é¢é€šè¿‡ä¸€ä¸ªä¾‹å­è®©å¤§å®¶æ›´å¥½çš„ç†è§£è¿™ä¸ªæ€è·¯.</p>
<h4 id="å¤„ç†å¾ªç¯ä¾èµ–ä¸¾ä¾‹">å¤„ç†å¾ªç¯ä¾èµ–ä¸¾ä¾‹</h4>
<p>æ ¹æ®ä¸Šé¢çš„æ€è·¯,è¿™é‡Œå‡è®¾Aå’ŒBäº’ç›¸ä¾èµ–,å¦‚å›¾æ‰€ç¤º,åœ¨Aåˆ›å»ºå®ä¾‹çš„æ—¶å€™ä½¿ç”¨getBeanæ–¹æ³•,é€šè¿‡createBeanInstanceæ–¹æ³•å¯¹Aè¿›è¡Œå®ä¾‹åŒ–.æ­¤æ—¶çš„Aåªæ˜¯è¢«å®ä¾‹åŒ–å‡ºæ¥äº†,<br>
ä¹ŸæŠŠåˆ›å»ºBå®ä¾‹çš„å·¥å‚ç±»é€šè¿‡addSingletonFactoryæ–¹æ³•æ·»åŠ åˆ°ä¸‰çº§ç¼“å­˜ä¸­.ä¸Šé¢çš„æ€è·¯ä¸­æåˆ°äº†è¿™ä¸ªæ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­çš„å·¥å‚ç±»ä½¿ç”¨ç”¨æ¥ç”Ÿæˆbeanå®ä¾‹ç”¨çš„.</p>
<p>æ¥ç€å¾€ä¸‹,å½“é€šè¿‡populateBeanå¡«å……å®ä¾‹Açš„å±æ€§çš„æ—¶å€™å‘ç°,Aä¾èµ–B.æ­¤æ—¶å¼€å§‹é€šè¿‡getBeanæ–¹æ³•åˆ›å»ºBçš„å®ä¾‹,ä¾æ—§é€šè¿‡createBeanInstanceæ–¹æ³•å¯¹beanè¿›è¡Œå®ä¾‹åŒ–,<br>
ä¹Ÿå°±æ˜¯æŠŠåˆ›å»ºBå®ä¾‹çš„å·¥å‚ç±»é€šè¿‡addSingletonFactoryæ–¹æ³•æ·»åŠ åˆ°ä¸‰çº§ç¼“å­˜.åœ¨ä½¿ç”¨populateBeanæ–¹æ³•å¡«å……Bçš„å±æ€§æ—¶,å‘ç°Bä¾èµ–A,æ­¤æ—¶é€šè¿‡getBeanæ–¹æ³•å¯¹Aè¿›è¡Œå®ä¾‹åŒ–.</p>
<p>è¿™ä¸ªæ—¶å€™å°±å‡ºç°äº†å¾ªç¯ä¾èµ–çš„æƒ…å†µäº†,getBeanæ–¹æ³•å…ˆä»ä¸€çº§ç¼“å­˜ä¸­è·å–Aå®ä¾‹,å‘ç°æ²¡æœ‰,å†å»äºŒçº§ç¼“å­˜ä¸­æ‰¾,è¿˜æ˜¯æ‰¾ä¸åˆ°,æ²¡åŠæ³•,åªèƒ½åˆ°ä¸‰çº§ç¼“å­˜ä¸­Aå®ä¾‹åˆ›å»ºå·¥å‚å–åˆ›å»ºAå®ä¾‹.å‰é¢<br>
ä¸‰ä¸ªæ­¥éª¤ä¸­Aå·²ç»å°†å·¥å‚ç±»é€šè¿‡addSingletonFactoryæ–¹æ³•å­˜æ”¾åˆ°ä¸‰çº§ç¼“å­˜ä¸­,äºæ˜¯è°ƒç”¨Açš„å·¥å‚ç±»åˆ›å»ºAçš„å®ä¾‹,å¹¶ä¸”å°†å…¶æ”¾åˆ°äºŒçº§ç¼“å­˜ä¸­è¿”å›ç»™Bç”¨æ¥å¡«å……Bçš„å±æ€§,å½“Bå®Œæˆå±æ€§å¡«å……<br>
ä»¥åäº§ç”Ÿäº†Bçš„å®ä¾‹,è¿”å›ç»™populateBean(A)ä½¿ç”¨,æ­¤æ—¶Aè·å–äº†Bå®ä¾‹(å®Œæˆå±æ€§å¡«å……çš„Bçš„å®ä¾‹).</p>
<p>æ‰€ä»¥,Aä¹Ÿå¯ä»¥å®Œæˆå±æ€§å¡«å……ä»è€Œäº§ç”ŸAçš„åˆå§‹åŒ–ä»¥åçš„å®ä¾‹å¹¶ä¸”å°†å…¶æ”¾å…¥åˆ°ä¸€çº§ç¼“å­˜ä¸­.ç”±äºBä¹‹å‰ä½¿ç”¨çš„æ—¶Açš„å®ä¾‹æ˜¯æ²¡æœ‰åšå±æ€§å¡«å……çš„,ä¹Ÿå°±æ˜¯åŠæˆå“Açš„å®ä¾‹,<br>
å› æ­¤æ­¤æ—¶å……ä¸€çº§ç¼“å­˜ä¸­è·å–æˆå“Aå®ä¾‹å®ŒæˆBå¯¹è±¡çš„åˆå§‹åŒ–.</p>
<h3 id="jdkåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†">JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†</h3>
<h4 id="aopçš„åŸºæœ¬æ¦‚å¿µ">AOPçš„åŸºæœ¬æ¦‚å¿µ</h4>
<p>AOP(Aspect Orient Programming),ç›´è¯‘è¿‡æ¥å°±æ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹.AOPæ˜¯ä¸€ç§ç¼–ç¨‹æ€æƒ³,æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹(OOP)çš„ä¸€ç§è¡¥å…….é¢å‘å¯¹è±¡ç¼–ç¨‹å°†ç¨‹åºæŠ½è±¡æˆå„ä¸ªå±‚æ¬¡çš„å¯¹è±¡,<br>
è€Œé¢å‘åˆ‡é¢ç¼–ç¨‹æ˜¯å°†ç¨‹åºæŠ½è±¡æ™¨å…‰å„ä¸ªåˆ‡é¢.</p>
<p>å¦‚å›¾ä¸€æ‰€ç¤º,åˆ‡é¢å®ç°äº†æ¨ªåˆ‡å…³æ³¨ç‚¹,ä¹Ÿå°±æ˜¯è·¨å¤šä¸ªåº”ç”¨å¯¹è±¡çš„é€»è¾‘,å‡è®¾ä¸šåŠ¡æœåŠ¡1,2,3å„è‡ªå®ç°ä¸šåŠ¡ä¸ä»…ç›¸åŒ,ä½†æ˜¯æœ‰äº›ç³»ç»Ÿçº§åˆ«çš„åº”ç”¨æ˜¯å¯ä»¥æŠ½è±¡çš„,ä¾‹å¦‚è“è‰²ç®­å¤´ä¸­æ ‡æ³¨çš„<br>
æ—¥å¿—,å®‰å…¨,äº‹åŠ¡.</p>
<p>æ‰€è°“åˆ‡é¢,ç›¸å½“äºåº”ç”¨å¯¹è±¡çš„æ¨ªåˆ‡ç‚¹,å¯ä»¥é»„å…¶æŠ½è±¡ä¸ºå•ç‹¬çš„æ¨¡å—.å…¶1ä¸­çš„åˆ‡é¢å°±æ˜¯æ—¥å¿—,å®‰å…¨,äº‹åŠ¡,æ¢å¥è¯è¯´å¯ä»¥å°†æ—¥å¿—,å®‰å…¨,äº‹åŠ¡æŠ½è±¡æˆç‹¬ç«‹çš„æ¨¡å—.</p>
<h4 id="ä¸ºä»€ä¹ˆè¦ä½¿ç”¨aop">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨AOP</h4>
<p>åœ¨å®é™…å¼€å‘è¿‡ç¨‹ä¸­,ä¸šåŠ¡ä»£ç ä¸­ä¼šä¸æ–­é‡å¤çš„ä»£ç ,ä¾‹å¦‚:è®°å½•æ—¥å¿—,åˆ¤æ–­æƒé™ç­‰.é‡åˆ°è¿™ç§åœºæ™¯å°±å¯ä»¥å°†è¿™äº›ä¸šåŠ¡æ— å…³çš„ä»£ç è¿›è¡ŒæŠ½è±¡æˆä¸€ä¸ªæ–¹æ³•.è¿™ç§é—®é¢˜å°±å¯ä»¥åˆ©ç”¨AOPæ¥è§£å†³.</p>
<p>AOPå¯ä»¥ä¿è¯å¼€å‘è€…ä¸ä¿®æ”¹æºä»£ç çš„å‰æä¸‹,ä¸ºä¸šåŠ¡ç»„ä»¶æ·»åŠ é€šç”¨åŠŸèƒ½.å…¶æœ¬è´¨æ˜¯é€šè¿‡AOPæ¡†æ¶å°†é€šç”¨ä»£ç æ¤å…¥åˆ°ä¸šåŠ¡ç»„ä»¶æ–¹æ³•ä¸­.</p>
<p>æŒ‰ç…§AOPæ¡†æ¶ä¿®æ”¹æºä»£ç çš„æ—¶æœº,å¯ä»¥å°†å…¶åˆ†ä¸ºä¸¤ç±»:</p>
<p>é™æ€AOPå®ç°,AOPæ¡†æ¶åœ¨ç¼–è¯‘é˜¶æ®µå¯¹ç¨‹åºæºä»£ç è¿›è¡Œä¿®æ”¹,ç”Ÿæˆé™æ€AOPä»£ç†ç±»(ç”Ÿæˆçš„*.classæ–‡ä»¶å·²ç»è¢«æ”¹æ‰äº†,éœ€è¦ä½¿ç”¨ç‰¹å®šçš„ç¼–è¯‘å™¨),æ¯”å¦‚AspectJ.</p>
<p>åŠ¨æ€AOPå®ç°,AOPæ¡†æ¶åœ¨è¿è¡Œé˜¶æ®µå¯¹åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡(åœ¨å†…å­˜ä¸­ä»¥JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†ç”ŸæˆAOPä»£ç†ç±»),æ¯”å¦‚Spring AOP.</p>
<p>å¦‚å›¾æ‰€ç¤º,è¿™é‡Œåˆ—å‡ºäº†AOPçš„å‡ å¤§ç±»åˆ«,å…¶ä¸­å›½ä»¥åŠ¨æ€AOPçš„ä¸¤ä¸ªç±»åˆ«ä½¿ç”¨æœ€ä¸ºå¹¿æ³›,ä»–ä»¬å°±æ˜¯JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†.æ¥ä¸‹æ¥å°±è®©æˆ‘ä»¬ä¸€èµ·æ¥çœ‹çœ‹ä»–ä»¬æ˜¯å¦‚ä½•å®ç°AOPçš„å§.</p>
<table>
<thead>
<tr>
<th>ç±»åˆ«</th>
<th>æœºåˆ¶</th>
<th>åŸç†</th>
<th>ä¼˜ç‚¹</th>
<th>ç¼ºç‚¹</th>
</tr>
</thead>
<tbody>
<tr>
<td>é™æ€AOP</td>
<td>é™æ€ç»‡å…¥</td>
<td>åœ¨ç¼–è¯‘èµ·ï¼Œåˆ‡é¢ç›´æ¥ä»¥å­—èŠ‚ç çš„å½¢å¼ç¼–è¯‘åˆ°ç›®æ ‡å­—èŠ‚ç æ–‡ä»¶ä¸­</td>
<td>å¯¹ç³»ç»Ÿæ— æ€§èƒ½å½±å“</td>
<td>çµæ´»åº¦ä¸å¤Ÿ</td>
</tr>
<tr>
<td>åŠ¨æ€AOP</td>
<td>JDKåŠ¨æ€ä»£ç†</td>
<td>åœ¨è¿è¡ŒæœŸï¼Œç›®æ ‡ç±»åŠ è½½åï¼Œä¸ºæ¥å£åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼Œå°†åˆ‡é¢ç»‡å…¥åˆ°ä»£ç†ç±»ä¸­</td>
<td>ç›¸å¯¹äºé™æ€AOPæ›´åŠ çµæ´»</td>
<td>åˆ‡å…¥çš„å…³æ³¨ç‚¹éœ€è¦å®ç°æ¥å£ï¼Œå¯¹ç³»ç»Ÿæœ‰ä¸€ç‚¹æ€§èƒ½å½±å“</td>
</tr>
<tr>
<td>åŠ¨æ€å­—èŠ‚ç ç”Ÿæˆ</td>
<td>CGLIB</td>
<td>åœ¨è¿è¡ŒæœŸç›®æ ‡ç±»åŠ è½½åï¼ŒåŠ¨æ€ç”Ÿæˆç›®æ ‡ç±»çš„å­ç±»ï¼Œå°†åˆ‡é¢é€»è¾‘åŠ å…¥åˆ°å­ç±»ä¸­</td>
<td>æ²¡æœ‰æ¥å£ä¹Ÿå¯ä»¥ç»‡å…¥</td>
<td>æ‰©å±•ç±»çš„å®ä¾‹ç”¨finalä¿®é¥°æ—¶ï¼Œåˆ™æ— æ³•è¿›è¡Œç»‡å…¥</td>
</tr>
<tr>
<td>è‡ªå®šä¹‰ç±»åŠ è½½å™¨</td>
<td></td>
<td>åœ¨è¿è¡ŒæœŸç›®æ ‡ç±»åŠ è½½å‰ï¼Œå°†åˆ‡é¢é€»è¾‘é©¾åˆ°ç›®æ ‡å­—èŠ‚ç é‡Œ</td>
<td>å¯ä»¥å¯¹ç»å¤§éƒ¨åˆ†ç±»è¿›è¡Œç»‡å…¥</td>
<td>ä»£ç ä¸­å¦‚æœä½¿ç”¨å…¶å®ƒç±»åŠ è½½å™¨ï¼Œåˆ™è¿™äº›ç±»å°†ä¸ä¼šè¢«ç»‡å…¥</td>
</tr>
<tr>
<td>å­—èŠ‚ç è½¬æ¢</td>
<td></td>
<td>åœ¨è¿è¡ŒæœŸï¼Œæ‰€æœ‰ç±»åŠ è½½å™¨åŠ è½½å­—èŠ‚ç å‰è¿›è¡Œæ‹¦æˆª</td>
<td>å¯ä»¥å¯¹æ‰€æœ‰ç±»è¿›è¡Œç»‡å…¥</td>
<td></td>
</tr>
</tbody>
</table>
<h4 id="jdkåŠ¨æ€ä»£ç†">JDKåŠ¨æ€ä»£ç†</h4>
<p>AOPæ¡†æ¶æœ‰å¾ˆå¤šï¼ŒSpringä¸­çš„AOPæ˜¯é€šè¿‡åŠ¨æ€ä»£ç†æ¥å®ç°çš„ã€‚è¿™é‡Œå°±ä»‹ç»JDKåŠ¨æ€ä»£ç†çš„å®ç°åŸç†ã€‚JDKåŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡ŒæœŸï¼Œç›®æ ‡ç±»åŠ è½½åï¼Œä¸ºæ¥å£åŠ¨æ€ç”Ÿæˆä»£ç†ç±»ï¼Œå°†åˆ‡é¢ç»‡å…¥ä»£ç†ç±»ç±»ä¸­ã€‚</p>
<p>è¿™é‡Œé€šè¿‡ä¸€ä¸ªä¾‹å­ç±»è®²è§£JDKåŠ¨æ€ä»£ç†çš„å®ç°åŸç†ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œå®šä¹‰Serviceæ¥å£ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªhelpæ–¹æ³•ã€‚ç”¨ServiceImplå»å®ç°Serviceæ¥å£ï¼Œ<br>
åœ¨helpæ–¹æ³•ä¸­å®ç°æ‰“å°ä¹°ä¹¦çš„è¾“å‡ºã€‚è¿™ä¸ªServiceImplå°±æ˜¯æˆ‘ä»¬è¦ä»£ç†çš„ç›®æ ‡ç±»ã€‚</p>
<pre><code class="language-java">public interface Service {

    public void help();
}


public class ServiceImpl implements Service {
    @Override
    public void help() {
        System.out.println(&quot;ä¹°ä¹¦&quot;)
    }
}
</code></pre>
<p>æ¥ä¸‹æ¥å®ç°ä»£ç†ç±»ï¼Œå¦‚å›¾æ‰€ç¤ºï¼ŒdynamicProxyä½œä¸ºåŠ¨æ€ä»£ç†ç±»å®ç°äº†invocationHandleræ¥å£ï¼Œå…¶ä¸­å®šä¹‰äº†Serviceçš„æ¥å£ä½œä¸º<br>
ä»£ç†ç±»dynamicProxyæ„é€ æ–¹æ³•çš„è¾“å…¥å‚æ•°ï¼Œåœ¨Overrideçš„invokeæ–¹æ³•ä¸­é€šè¿‡å‚æ•°Methodæ¥ä»£ç†è¦æ‰§è¡Œçš„ä»£ç†ç±»ä¸­çš„æ–¹æ³•ï¼Œ<br>
method.invokeçš„è¾“å…¥å‚æ•°ä¸ºç›®æ ‡ç±»Serviceã€‚</p>
<p>method.invokeæ˜¯ç”¨æ¥æ‰§è¡Œä»£ç†ç±»ä¸­çš„helpæ–¹æ³•ï¼Œå¦‚æœè¿™ä¸ªå‡è®¾æˆç«‹çš„è¯ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå‰é¢æ‰§è¡Œçš„<br>
System.out.println(&quot;ä¹°ä¹¦ä¹‹å‰&quot;)ï¼Œä¼šåœ¨ä¹°ä¹¦æ–¹æ³•ä¹‹å‰æ‰§è¡Œï¼ŒåŒç†System.out.println(&quot;ä¹°ä¹¦ä¹‹å&quot;)ä¼šåœ¨ä¹°ä¹¦æ–¹æ³•ä¹‹åæ‰§è¡Œ</p>
<pre><code class="language-java">public class DynamicProxy implements InvocationHandler{
    //ä»£ç†çš„çœŸå®å¯¹è±¡
    private Object service;
    
    //æ„é€ æ–¹æ³•ï¼Œç»™ä»£ç†çš„çœŸæ˜¯å¯¹è±¡èµ‹å€¼
    public DynamicProxy(Object service){
        this.service = service;
    }
    
    public Object invoke(Object object, Method method ,Object[] args) throws  Throwable{
        
        //çœŸæ˜¯æ–¹æ³•æ‰§è¡Œä¹‹å‰
        System.out.println(&quot;ä¹°ä¹¦ä¹‹å‰&quot;);
        //è°ƒç”¨çœŸæ˜¯æ–¹æ³•
        method.invoke(service, args);
        //çœŸæ˜¯æ–¹æ³•æ‰§è¡Œä¹‹å
        System.out.println(&quot;ä¹°ä¹¦ä¹‹å&quot;);
        return  null;
    }
    
    
}

</code></pre>
<p>å›è¿‡å¤´æˆ‘ä»¬æµ‹è¯•ä¸€äº›å®‰JDKçš„ä»£ç†ç±»æ˜¯å¦å·¥ä½œï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨mainå‡½æ•°ä¸­é€šè¿‡proxyçš„newProxyInstanceæ–¹æ³•ä¼ å…¥ClassLoaderçš„ç±»åŠ è½½å™¨ï¼ŒåŒæ—¶ä¼ å…¥Serviceçš„æ¥å£ï¼Œ<br>
ä»¥åŠä»£ç†ç±»DynamicProxy(ä»¥InvocationHandlerçš„å½¢å¼)ã€‚ç„¶åæ‰§è¡Œä»£ç†ç±»çš„helpæ–¹æ³•ã€‚</p>
<pre><code class="language-java">
public class {
    
    public static void main(String[] args) {
        //è¦ä»£ç†çš„å¯¹è±¡
        Service service = new ServiceImpl();
        //è¦ä»£ç†å“ªä¸ªçœŸå®å¯¹è±¡ï¼Œå°±å°†è¯¥å¯¹è±¡ä¼ è¿›å»ï¼Œæœ€åæ˜¯é€šè¿‡è¯¥çœŸå®å¯¹è±¡æ¥è°ƒç”¨å…¶æ–¹æ³•
        InventoryHandler handler = new DynamicProxy(service);
        // æ·»åŠ ä¸€ä¸‹çš„å‡ æ®µä»£ç ï¼Œå°±å¯ä»¥å°†ä»£ç†ç”Ÿæˆçš„å­—èŠ‚ç ä¿å­˜èµ·æ¥
        try {
            Service serviceProxy = Proxy.newProxyInstance(service.getClass().getClassLoader(),service.getClass().getInterface(),handler);
            service.help();
        }catch (NoSuchFieldException e){
            e.printStackTrace();
        }catch(IllegalAccessException e){
            e.printStackTrace();
        }
    }    
    
}

</code></pre>
<h4 id="cglibåŠ¨æ€ä»£ç†">CGLIBåŠ¨æ€ä»£ç†</h4>
<p>CGLIB(Code Generation Library)æ˜¯ä¸€ä¸ªå¼€æºé¡¹ç›®ï¼Œé«˜æ€§èƒ½é«˜è´¨é‡çš„Codeç”Ÿæˆç±»åº“ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡ŒæœŸæ‰©å±•javaç±»ä¸å®ç°Javaæ¥å£ã€‚å…¶åŸç†æ˜¯åœ¨è¿è¡ŒæœŸé—´ï¼Œé€šè¿‡å­—èŠ‚ç çš„æ–¹å¼<br>
åœ¨ç›®è¡¨ç±»çš„å­ç±»ä¸­ç»‡å…¥å¯¹åº”çš„ä»£ç å®Œæˆä»£ç†ã€‚</p>
<p>è¿˜æ˜¯é€šè¿‡ä¸€ä¸ªä¾‹å­æ¥çœ‹ï¼Œä¾æ—§å®šä¹‰ä¸€ä¸ªBizçš„ç›®æ ‡ç±»ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªhelpæ–¹æ³•æ‰“å°ä¹°ä¹¦ï¼Œæˆ‘ä»¬è¦å¯¹è¿™ä¸ªæ–¹æ³•è¿›è¡Œç»‡å…¥ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•çš„å‰åæ‰“å°ä¹°ä¹¦ä¹‹å‰å’Œä¹°ä¹¦ä¹‹åçš„æ‰“å°è¯­å¥ã€‚<br>
å®šä¹‰ä¸€ä¸ªBizTntercepterä½œä¸ºä»£ç†ç±»ï¼Œå®ç°MethodIntercepterçš„æ¥å£ï¼Œå¹¶ä¸”Override interceptæ–¹æ³•ã€‚</p>
<p>ä»‹ç»ä¸€ä¸‹æ–¹æ³•çš„å‚æ•°ï¼ŒObjectæ˜¯ç”Ÿæˆçš„å­ç±»å¯¹è±¡ï¼ŒMethodæ˜¯è¦ä»£ç†çš„ç›®æ ‡ç±»çš„æ–¹æ³•ï¼Œobject[]æ˜¯å‚æ•°ï¼ŒMethodProxyå­ç±»ç”Ÿæˆä»£ç†æ–¹æ³•ã€‚é€šè¿‡methodProxy.invokeSuperæ–¹æ³•æ‰§è¡Œç”Ÿæˆå­ç±»çš„ä»£ç†æ–¹æ³•ï¼Œ<br>
ç¬¬ä¸€ä¸ªè¾“å‡ºçš„æ˜¯ç›®æ ‡ç±»ç”Ÿæˆçš„å­ç±»ï¼Œç¬¬äºŒä¸ªè¾“å‡ºçš„æ˜¯å‚æ•°ï¼Œè¯¥æ–¹æ³•å°±æ˜¯è°ƒç”¨ç›®æ ‡ç±»bizä¸­çš„helpæ–¹æ³•ã€‚</p>
<p>æœ€åå°±æ˜¯æ‰§è¡Œæµ‹è¯•ç±»çš„æ–¹æ³•ï¼Œåœ¨mainå‡½æ•°ä¸­newä¸€ä¸ªenhandcerï¼ŒsetSuperclassæ‰§è¡Œç›®æ ‡ç±»ï¼Œé€šè¿‡setCallBackæ–¹æ³•æŒ‡å®šä»£ç†ç±»ï¼Œæœ€åé€šè¿‡ä½¿ç”¨createæ–¹æ³•ç”ŸæˆBizçš„å®ä¾‹ï¼Œå¹¶ä¸”æ‰§è¡Œå¯¹åº”çš„helpæ–¹æ³•ã€‚</p>
<pre><code class="language-java">
public class Biz{
    /**
     *  ç›®æ ‡ç±»
     * @author zxy
     * @date 2021/9/15 10:22
     */
    public void help(){
        System.out.println(&quot;ä¹°ä¹¦&quot;);
    }
}


/**
 * ä»£ç†ç±»
 * @author zxy
 * @date 2021/9/15 10:24
 */
public class BizInterceptor implements MethodInterceptor{
    //Object æ˜¯ç”Ÿæˆç±»çš„å­ç±»å¯¹è±¡ï¼ŒMethodæ˜¯è¦ä»£ç†ç›®æ ‡ç±»çš„æ–¹æ³•ï¼ŒObject[]æ˜¯å‚æ•°ï¼ŒMethodProxyå­ç±»ç”Ÿæˆçš„ä»£ç†æ–¹æ³•
    @Override
    public Object intercept(Object o ,Method method ,Object[] object ,MethodProxy methodProxy) throws Throwable {
        System.out.println(&quot;ä¹°ä¹¦ä¹‹å‰&quot;);
        methodProxy.invokeSuper(o,object);
        System.out.println(&quot;ä¹°ä¹¦ä¹‹å&quot;);
        return null;
    }
    
    
}


public BizCglibClient{
    
    public static void main(String[] args){
        EnHancer enHancer = new EnHancer();
        enHancer.setSuperClass(Biz.class);
        enHancer.setCallback(new BizInterceptor());
        Biz biz = enHancer.create();
        biz.help();
    }
}

</code></pre>
<h4 id="jdkåŠ¨æ€ä»£ç†å’ŒcglibåŠ¨æ€ä»£ç†åŒºåˆ«">JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†åŒºåˆ«</h4>
<p>1.ä»‹ç»å®Œä¸¤ç§ä»£ç†æ¨¡å¼ï¼Œè¿™é‡Œç¨å¾®æ€»ç»“ä¸€ä¸‹ä¸¤è€…çš„åŒºåˆ«ã€‚</p>
<ul>
<li>JDKåŠ¨æ€ä»£ç†åªèƒ½å¯¹å®ç°äº†æ¥å£çš„ç±»ç”Ÿæˆä»£ç†ï¼Œè€Œä¸èƒ½é’ˆå¯¹ç±»</li>
<li>CGLIBåŠ¨æ€ä»£ç†æ˜¯é’ˆå¯¹ç±»å®ç°ä»£ç†ï¼Œä¸»è¦æ˜¯å¯¹æŒ‡å®šçš„ç±»ç”Ÿæˆçš„å­ç±»ï¼Œè¦†ç›–å…¶ä¸­çš„æ–¹æ³•ï¼ˆç»§æ‰¿ï¼‰</li>
</ul>
<p>2.Spring AOPé€‰æ‹©JDKè¿˜æ˜¯CGLIBçš„ä¾æ®</p>
<ul>
<li>å½“Beanå®ç°æ¥å£æ—¶ï¼ŒSpringå°±ä¼šç”¨JDKçš„åŠ¨æ€ä»£ç†</li>
<li>å½“Beanæ²¡æœ‰å®ç°æ¥å£æ—¶ï¼ŒSpringä½¿ç”¨Cglibæ¥å®ç°</li>
<li>é»˜è®¤æ˜¯JDKä»£ç†ï¼Œå¯ä»¥å¼ºåˆ¶ä½¿ç”¨CGLIB(åœ¨Springé…ç½®ä¸­åŠ å…¥&lt;aop:aspectj-autoproxy proxy-target-class=&quot;true&quot; /&gt;)</li>
</ul>
<p>3.JDKåŠ¨æ€ä»£ç†å’ŒCGLIBæ€§èƒ½å¯¹æ¯”</p>
<p>ä½¿ç”¨CGLIBå®ç°åŠ¨æ€ä»£ç†ï¼ŒCGLIBåº•å±‚é‡‡ç”¨ASMå­—èŠ‚ç ç”Ÿæˆæ¡†æ¶ï¼Œä½¿ç”¨å­—èŠ‚ç æŠ€æœ¯ç”Ÿæˆä»£ç†ç±»ï¼Œåœ¨JDK1.6ä¹‹å‰ä½¿ç”¨Javaåå°„æ•ˆç‡è¦é«˜ï¼Œ<br>
å”¯ä¸€éœ€è¦æ³¨æ„çš„æ˜¯ï¼ŒCGLIBä¸èƒ½å¯¹å£°æ˜finalæ–¹æ³•è¿›è¡Œä»£ç†ï¼Œå› ä¸ºCGLIBåŸç†æ˜¯åŠ¨æ€ç”Ÿæˆä»£ç†ç±»çš„å­ç±»ã€‚</p>
<h3 id="aspect-join-points-pointcutså’Œadviceè¯­æ³•">Aspectã€Join Pointsã€Pointcutså’ŒAdviceè¯­æ³•</h3>
<h4 id="spring-aopæ ¸å¿ƒæ¦‚å¿µç»¼è¿°">Spring AOPæ ¸å¿ƒæ¦‚å¿µç»¼è¿°</h4>
<p>Aspectã€JoinPointsã€Pointcutsã€ä»¥åŠAdviceè¿™äº›éƒ½å±äºAOPçš„æ ¸å¿ƒæ¦‚å¿µï¼ŒSpringAOPæ˜¯é€šè¿‡è¿™äº›æ¦‚å¿µçš„ç»„åˆå®Œæˆä»£ç æ¤å…¥å·¥ä½œçš„ã€‚</p>
<p>å¦‚å›¾ä¸€æ‰€ç¤ºï¼Œè¿™å¼ å›¾å°†SpringAOPçš„æ¦‚å¿µè¿›è¡Œäº†æ€»ä½“æè¿°ï¼Œå…ˆä»å³çš„ç®­å¤´è¯´èµ·ï¼Œè¿™ä¸ªç®­å¤´åŒ…å«äº†ä¸€äº›å°æ–¹å—ï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºJoinPointsï¼Œå®ƒæ˜¯å¯ä»¥ç”¨æ¥è¿›è¡Œå¢å¼ºçš„æ–¹æ³•ç‚¹ï¼Œ<br>
ä¾‹å¦‚ä¸ŠèŠ‚è¯¾ä¸­Serviceç±»ä¸­çš„helpæ–¹æ³•ï¼Œè¯´ç™½äº†å°±æ˜¯å¯¹ä»€ä¹ˆæ–¹æ³•è¿›è¡Œå¢å¼ºã€‚</p>
<p>çœ‹å®Œäº†JoinPointsä¹‹åï¼Œå†å¾€ä¸Šçœ‹ï¼Œæœ‰ä¸€ä¸ªå‘ä¸‹çš„ç®­å¤´ï¼Œä¸Šé¢æ ‡æ³¨ç€Pointcut,æˆ‘ä»¬ç§°ä¹‹ä¸ºåˆ‡å…¥ç‚¹ã€‚åˆ‡å…¥ç‚¹æ˜¯å‘Šè¯‰æˆ‘ä»¬åœ¨æ–¹æ³•çš„ä»€ä¹ˆä½ç½®è¿›è¡Œå¢å¼ºï¼Œ<br>
æ¯”å¦‚åœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰å¢å¼ºï¼Œè¿˜æ˜¯æ‰§è¡Œä¹‹åå¢å¼ºï¼Œæˆ–è€…ä¸¤è€…çš†æœ‰ã€‚Adviceæ˜¯æœ€ä¸Šé¢çš„æ–¹å—ï¼Œå®ƒè¡¨ç¤ºéœ€è¦å¢å¼ºçš„åŠŸèƒ½ï¼Œä¸ŠèŠ‚è¯¾çš„ä¾‹å­ä¸­åœ¨â€œä¹°ä¹¦ä¹‹å‰â€æˆ–è€…â€œä¹°ä¹¦ä¹‹åâ€çš„æ‰“å°è¯­å¥ã€‚</p>
<p>è¿™é‡Œçš„â€œä¹°ä¹¦ä¹‹å‰â€å’Œâ€œä¹°ä¹¦ä¹‹åâ€å°±æ˜¯å¢å¼ºåŠŸèƒ½ï¼Œå†ä¾‹å¦‚æˆ‘ä»¬å¦‚æœç¼–å†™æ—¥å¿—ä¹Ÿå¯ä»¥æ”¾åœ¨ä¹Ÿæ”¾åœ¨å¢å¼ºæ–¹æ³•é‡Œé¢å®Œæˆã€‚æœ€åAdviceå’ŒPointcutçš„ç»„åˆå°±æ˜¯åˆ‡é¢Aspectã€‚</p>
<figure data-type="image" tabindex="9"><img src="../framework/images/spring-aop.png" alt="SpringAOP" loading="lazy"></figure>
<h3 id="_æºç åˆ†æspring-aop-jdkåŠ¨æ€ä»£ç†å®ç°åŸç†">_æºç åˆ†æï¼šSpring AOP JDKåŠ¨æ€ä»£ç†å®ç°åŸç†</h3>
<h4 id="invokeå®ç°aopä¸­å…·ä½“çš„é€»è¾‘">invokeï¼šå®ç°AOPä¸­å…·ä½“çš„é€»è¾‘</h4>
<p>ä»å‰é¢çš„è¯¾ç¨‹æˆ‘ä»¬çŸ¥é“ï¼ŒJDKä¸­AOPçš„å®ç°æ˜¯åŸºäºjava.lang.reflectåŒ…ä¸­çš„Proxyå’ŒInvocationHandlerä¸¤ä¸ªæ¥å£æ¥å®ç°çš„ã€‚<br>
å¯¹äºInvocationHandlerçš„åˆ›å»ºï¼Œæˆ‘ä»¬éœ€è¦é‡å†™ä¸‰ä¸ªæ–¹æ³•ï¼š</p>
<ul>
<li>æ„é€ å‡½æ•°ï¼šå°†ç›®æ ‡ä»£ç†å¯¹è±¡ä¼ å…¥ã€‚</li>
<li>invokeï¼šå®ç°AOPä¸­å…·ä½“çš„é€»è¾‘ã€‚</li>
<li>getProxyï¼šè·å–äº§ç”Ÿçš„ä»£ç†ç±»ã€‚</li>
</ul>
<p>è€Œåœ¨Springæ¡†æ¶ä¸­ï¼ŒJDKæ–¹å¼ä¹Ÿå®ç°äº†ä¸Šè¯‰è¿‡ç¨‹ï¼Œåœ¨æºç åˆ†æä¸Šé¢æˆ‘ä»¬ä¹Ÿå°†å…¶åˆ†ä¸ºinvokeå’ŒgetProxyä¸¤å¤§éƒ¨åˆ†ç»™å¤§å®¶ä»‹ç»ã€‚</p>
<p>JDKåŠ¨æ€ä»£ç†ä¸­æ˜¯é€šè¿‡proxyFactory.getProxy()è·å–ä»£ç†çš„ï¼Œå¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼Œé€šè¿‡createAopProxy()ç”Ÿæˆå¯¹åº”çš„proxyFactory<br>
ç„¶ååœ¨è°ƒç”¨å…¶ä¸­çš„getProxyæ–¹æ³•ã€‚</p>
<pre><code class="language-java">
public Object getProxy(ClassLoader classLoader){
    return createAopProxy().getProxy(classLoader);
}
</code></pre>
<p>createAopProxy()ä¸­å†³å®šçš„å®ç°ç±»ä¸ºJdkDynamicAopProxyã€‚å¦‚ä¸‹é¢çš„ä»£ç æ‰€ç¤ºï¼Œå®ƒå®ç°äº†AopProxyå’ŒInvocationHandlerã€‚<br>
ç”±äºæˆ‘ä»¬ä¼šå®ç°InvocationHandlerï¼Œå¹¶ä¸”Overrideå…¶ä¸­çš„invokeæ–¹æ³•ï¼Œç„¶åé€šè¿‡InvocationHandlerçš„getProxyæ–¹æ³•<br>
è·å–ä»£ç†ç±»ï¼Œé€šè¿‡å¯¹ä»£ç†ç±»è°ƒç”¨processæ–¹æ³•æ‰§è¡ŒAOPçš„ç›¸å…³æ“ä½œã€‚</p>
<p>é‚£ä¹ˆé¦–å…ˆæ¥çœ‹çœ‹Overrideçš„invokeæ–¹æ³•çš„æºç ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œåœ¨invokeæ–¹æ³•ä¸­æˆ‘ä»¬éœ€è¦å…³æ³¨çº¢æ¡†æ ‡æ³¨çš„éƒ¨åˆ†</p>
<ul>
<li>åœ¨è·å–ç›®æ ‡ç±»ä»¥åï¼Œé€šè¿‡ç›®æ ‡ç±»è·å–è¦æ‰§è¡Œæ–¹æ³•çš„æ‹¦æˆªå™¨é“¾ï¼Œè¿™é‡Œçš„å˜é‡ä¸ºchainã€‚</li>
<li>å¦‚æœchainä¸ºç©ºè¯´æ˜æ²¡æœ‰åœ¨æ–¹æ³•ä¸Šæ‹¦æˆªï¼Œé‚£ä¹ˆç›´æ¥è°ƒç”¨åˆ‡ç‚¹æ–¹æ³•å°±è¡Œäº†ã€‚</li>
<li>å¦‚æœchainä¸ä¸ºç©ºè¯´æ˜æ–¹æ³•ä¸Šæœ‰æ‹¦æˆªï¼Œäºæ˜¯å°†æ‹¦æˆªå™¨å°è£…åœ¨ReflectiveMethodInvocationï¼Œå¹¶æ‰§è¡Œï¼Œè¿™éƒ¨åˆ†ä¹Ÿæ˜¯AOPéœ€è¦å…³æ³¨ç‚¹ã€‚</li>
</ul>
<h3 id="ç²¾é€‰é¢è¯•é¢˜spring-aopå’Œaspectj-aopå­˜åœ¨å“ªäº›åŒºåˆ«">ç²¾é€‰é¢è¯•é¢˜ï¼šSpring AOPå’ŒAspectJ AOPå­˜åœ¨å“ªäº›åŒºåˆ«ï¼Ÿ</h3>
<h4 id="aopçš„åŸºæœ¬æ¦‚å¿µ-2">AOPçš„åŸºæœ¬æ¦‚å¿µ</h4>
<p>AOPï¼Œå®ƒæ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹çš„ä¸€ç§è¡¥å……ï¼Œä¸»è¦åº”ç”¨äºå¤„ç†ä¸€äº›å…·æœ‰æ¨ªåˆ‡æ€§è´¨çš„ç³»ç»Ÿçº§æœåŠ¡ï¼Œå¦‚æ—¥å¿—æ”¶é›†ï¼Œäº‹åŠ¡ç®¡ç†å®‰å…¨æ£€æŸ¥ç¼“å­˜ï¼Œå¯¹è±¡æ± ç®¡ç†ç­‰ç­‰ã€‚</p>
<p>AOPå®ç°çš„å…³é”®åœ¨äºAOPæ¡†æ¶è‡ªåŠ¨åˆ›å»ºAOPä»£ç†ï¼ŒAOPä»£ç†åˆ™å¯åˆ†ä¸ºé™æ€ä»£ç†å’Œä¸œå²±ä»£ç†ä¸¤å¤§ç±»ï¼Œå…¶ä¸­é™æ€ä»£ç†æ˜¯æŒ‡ç”¨AOPæ¡†æ¶æä¾›çš„å‘½ä»¤æŒ‡ä»¤è¿›è¡Œç¼–è¯‘ï¼Œ<br>
ä»è€Œåœ¨ç¼–è¯‘é˜¶æ®µå°±å¯ç”ŸæˆAOPä»£ç†ç±»ï¼Œå› æ­¤ä¹Ÿç§°ä¸ºç¼–è¯‘æ—¶å¢å¼ºï¼›è€ŒåŠ¨æ€ä»£ç†åˆ™åœ¨è¿è¡Œæ—¶å€ŸåŠ©JDKåŠ¨æ€ä»£ç†ï¼ŒCGLIBç­‰å†å†…å­˜ä¸­ä¸´æ—¶ç”ŸæˆAOPåŠ¨æ€ä»£ç†ç±»ï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä¸ºè¿è¡Œæ—¶å¢å¼ºã€‚</p>
<p>é¢å‘åˆ‡é¢ç¼–ç¨‹æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œæ—¨åœ¨é€šè¿‡å…è®¸æ¨ªåˆ‡å…³æ³¨ç‚¹çš„åˆ†ç¦»ï¼Œæé«˜æ¨¡å—åŒ–ã€‚AOPæä¾›åˆ‡é¢æ¥è®²è·¨åŸŸå¯¹è±¡å…³æ³¨ç‚¹æ¨¡å—åŒ–ã€‚</p>
<p>AOPè¦å®ç°çš„æ˜¯åœ¨æˆ‘ä»¬å†™ä»£ç çš„åŸºç¡€ä¸Šè¿›è¡Œä¸€å®šçš„åŒ…è£…ï¼Œå¦‚åœ¨æ–¹æ³•æ‰§è¡Œå‰æˆ–è€…æ–¹æ³•æ‰§è¡Œåæˆ–è€…åœ¨æ‰§è¡Œå‡ºç°å¼‚å¸¸åè¿™äº›åœ°æ–¹è¿›è¡Œæ‹¦æˆªå¤„ç†æˆ–å«åšå¢å¼ºå¤„ç†ã€‚</p>
<p>AOPçš„å‡ ä¸ªè¦ç´ ï¼š</p>
<ul>
<li>Pointcutï¼šæ˜¯ä¸€ä¸ªä¸€ä¸ªåŸºäºæ­£åˆ™è¡¨è¾¾å¼ï¼Œæœ‰ç‚¹ç»•ï¼Œå°±æ˜¯è¯´ä»–æœ¬èº«æ˜¯ä¸€ä¸ªè¡¨è¾¾å¼ï¼Œä½†æ˜¯å®ƒæ˜¯åŸºäºæ­£åˆ™è¡¨è¾¾å¼è¯­æ³•çš„ã€‚é€šå¸¸ä¸€ä¸ªPointcutï¼Œä¼šé€‰å–ç¨‹åºä¸­çš„æŸäº›æˆ‘ä»¬æ„Ÿå…´è¶£çš„æ‰§è¡Œç‚¹ï¼Œæˆ–è€…è°ç¨‹åºæ‰§è¡Œç‚¹çš„é›†åˆã€‚</li>
<li>JoinPointsï¼šé€šè¿‡Pointcuté€‰å–å‡ºæ¥çš„é›†åˆä¸­çš„å…·ä½“çš„ä¸€ä¸ªæ‰§è¡Œç‚¹ï¼Œæˆ‘ä»¬å°±å«JoinPointsã€‚</li>
<li>Adviceï¼šåœ¨é€‰å–å‡ºæ¥çš„JoinPointsä¸Šè¦æ‰§è¡Œçš„æ“ä½œã€é€»è¾‘</li>
<li>Aspectï¼šå°±æ˜¯æˆ‘ä»¬å…³æ³¨çš„æ¨¡å—åŒ–ï¼Œè¿™ä¸ªå…³æ³¨ç‚¹å¯èƒ½ä¼šæ¨ªåˆ‡å¤šä¸ªå¯¹è±¡å’Œæ¨¡å—ï¼Œäº‹åŠ¡ç®¡ç†æ˜¯æ¨ªåˆ‡å…³æ³¨ç‚¹çš„å¾ˆå¥½çš„ä¾‹å­ã€‚å®ƒæ˜¯ä¸€ä¸ªæŠ½è±¡çš„æ¦‚å¿µã€‚ä»è½¯ä»¶çš„è§’åº¦æ¥è¯´æ˜¯æŒ‡åº”ç”¨ç¨‹åºåœ¨ä¸åŒæ¨¡å—çš„æŸä¸€ä¸ªé¢†åŸŸæˆ–æ–¹é¢ã€‚ç”±Pointcutå’ŒAdviceç»„æˆã€‚</li>
<li>Weavingï¼šæŠŠåˆ‡é¢åº”ç”¨åˆ°ç›®æ ‡å¯¹è±¡æ¥åˆ›å»ºæ–°çš„Advisedå¯¹è±¡çš„è¿‡ç¨‹ã€‚</li>
</ul>
<h4 id="springaopå’Œaspectjçš„åŒºåˆ«">SpringAOPå’ŒAspectJçš„åŒºåˆ«</h4>
<p>ç›¸ä¿¡ä½œä¸ºJavaå¼€å‘è€…æˆ‘ä»¬éƒ½ç†Ÿæ‚‰Springè¿™ä¸ªæ¡†æ¶ï¼Œåœ¨springæ¡†æ¶ä¸­æœ‰ä¸€ä¸ªä¸»è¦çš„åŠŸèƒ½å°±æ˜¯AOPï¼Œæåˆ°AOPå°±å¾€å¾€ä¼šæƒ³åˆ°AspectJï¼Œä¸‹é¢å¯¹AOPå’ŒAspectJåšä¸€ä¸ªç®€å•çš„æ¯”è¾ƒï¼š</p>
<p>(1)SpringAOP</p>
<ul>
<li>åŸºäºåŠ¨æ€ä»£ç†æ¥å®ç°ï¼Œé»˜è®¤å¦‚æœä½¿ç”¨äº†æ¥å£ï¼Œç”¨JDKæä¾›çš„åŠ¨æ€ä»£ç†å®ç°ï¼Œå¦‚æœæ˜¯æ–¹æ³•åˆ™ä½¿ç”¨CGLIBå®ç°</li>
<li>SpringAOPéœ€è¦ä¾èµ–IOCå®¹å™¨æ¥ç®¡ç†ï¼Œå¹¶ä¸”åªèƒ½ä½œç”¨äºSpringå®¹å™¨ï¼Œä½¿ç”¨çº¯Javaä»£ç å®ç°</li>
<li>åœ¨æ€§èƒ½ä¸Šï¼Œç”±äºSpringAOPæ˜¯åŸºäºåŠ¨æ€æ¥å®ç°çš„ï¼Œåœ¨å®¹å™¨å¯åŠ¨æ—¶éœ€è¦ç”Ÿæˆä»£ç†å®ä¾‹ï¼Œåœ¨æ–¹æ³•è°ƒç”¨ä¸Šä¹Ÿä¼šå¢åŠ æ ˆçš„æ·±åº¦ï¼Œä½¿å¾—SpringAOPçš„æ€§èƒ½æ²¡æœ‰AspectJå¥½ã€‚</li>
</ul>
<p>(2)AspectJ<br>
AspectJæ¥è‡ªEclipseåŸºé‡‘ä¼šï¼Œå…¶å®ç°æœºåˆ¶å±äºé™æ€ç»‡å…¥ï¼Œé€šè¿‡ä¿®æ”¹ä»£ç æ¥å®ç°ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªç»‡å…¥çš„æ—¶æœºï¼š</p>
<ul>
<li>ç¼–è¯‘æœŸç»‡å…¥ï¼šå¦‚ç±»Aä½¿ç”¨äº†AspectJæ·»åŠ äº†ä¸€ä¸ªå±æ€§ï¼Œç±»Bå¼•ç”¨äº†å®ƒï¼Œè¿™ä¸ªåœºæ™¯å°±éœ€è¦ç¼–è¯‘æœŸçš„æ—¶å€™å°±è¿›è¡Œç»‡å…¥ï¼Œå¦åˆ™å°±æ²¡åŠæ³•ç¼–è¯‘ç±»Bã€‚</li>
<li>ç¼–è¯‘åç»‡å…¥ï¼šä¹Ÿå°±æ˜¯å·²ç»ç”Ÿæˆäº†.classæ–‡ä»¶æˆ–è€…å·²ç»æ‰“åŒ…æˆjaråŒ…äº†ï¼Œè¿™ä¸ªæ—¶å€™æˆ‘ä»¬éœ€è¦å¢å¼ºå¤„ç†çš„è¯ï¼Œå°±è¦ç”¨ç¼–è¯‘åç»‡å…¥ã€‚</li>
<li>ç±»åŠ è½½åç»‡å…¥ï¼šæŒ‡çš„æ˜¯åœ¨åŠ è½½ç±»çš„æ—¶å€™è¿›è¡Œç»‡å…¥ï¼Œè¦å®ç°è¿™ä¸ªæ—¶æœŸçš„ç»‡å…¥ï¼Œæœ‰å‡ ç§æ–¹æ³•ï¼š<br>
1.è‡ªå®šä¹‰ç±»åŠ è½½å™¨å¹²è¿™ä¸ªï¼Œè¿™ä¸ªåº”è¯¥æ˜¯æœ€å®¹æ˜“æƒ³åˆ°çš„åŠæ³•ï¼Œåœ¨è¢«ç»‡å…¥ç±»åŠ è½½åˆ°JVMä¹‹å‰å¯¹å®ƒè¿›è¡ŒåŠ è½½ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨åŠ è½½çš„æ—¶å€™å®šä¹‰è¡Œä¸ºäº†ã€‚<br>
2.åœ¨JVMå¯åŠ¨çš„æ—¶å€™æŒ‡å®šAspectJæä¾›çš„agent-javaagent:.....jarã€‚</li>
</ul>
<p>AspectJå¯ä»¥åšSpringAOPåšä¸äº†çš„äº‹æƒ…ï¼Œå®ƒæ˜¯AOPç¼–ç¨‹çš„å®Œå…¨è§£å†³æ–¹æ¡ˆï¼ŒSpringAOPåˆ™è‡´åŠ›äºè§£å†³ä¼ä¸šçº§å¼€å‘ä¸­æœ€æ™®éçš„AOP(æ–¹æ³•ç»‡å…¥)ï¼Œè€Œä¸æ˜¯æˆä¸ºåƒAspectJä¸€æ ·çš„AOPæ–¹æ¡ˆã€‚<br>
å› ä¸ºAspectJåœ¨è¿è¡Œä¹‹å‰å°±å®Œæˆäº†ç»‡å…¥ï¼Œæ‰€ä»¥è¯´å®ƒç”Ÿæˆçš„ç±»æ²¡æœ‰é¢å¤–è¿è¡Œæ—¶å¼€é”€çš„</p>
<h4 id="springaopå’Œaspectjå¯¹ç…§è¡¨">SpringAOPå’ŒAspectJå¯¹ç…§è¡¨</h4>
<table>
<thead>
<tr>
<th>SpringAop</th>
<th>AspectJ</th>
</tr>
</thead>
<tbody>
<tr>
<td>åœ¨çº¯Javaä¸­å®ç°</td>
<td>ä½¿ç”¨Javaç¼–ç¨‹è¯­è¨€çš„æ‰©å±•å®ç°</td>
</tr>
<tr>
<td>ä¸éœ€è¦å•ç‹¬çš„ç¼–è¯‘è¿‡ç¨‹</td>
<td>é™¤éè®¾ç½®LTWï¼Œå¦åˆ™éœ€è¦AspectJç¼–è¯‘å™¨ï¼ˆajcï¼‰</td>
</tr>
<tr>
<td>åªèƒ½ä½¿ç”¨è¿è¡Œæ—¶ç»‡å…¥</td>
<td>è¿è¡Œæ—¶ç»‡å…¥ä¸å¯ç”¨ï¼Œæ”¯æŒç¼–è¯‘æ—¶ã€ç¼–è¯‘åå’ŒåŠ è½½æ—¶ç»‡å…¥</td>
</tr>
<tr>
<td>åŠŸèƒ½ä¸å¼ºï¼Œè¿›æ”¯æŒæ–¹æ³•çº§ç»‡å…¥</td>
<td>æ›´å¼ºå¤§ï¼Œå¯ä»¥ç¼–ç»‡å­—æ®µæ–¹æ³•æ„é€ å‡½æ•°ï¼Œé™æ€åˆå§‹å€¼ï¼Œè®¾å®šå€¼ï¼Œæœ€ç»ˆç±»æ–¹æ³•ç­‰</td>
</tr>
<tr>
<td>åªèƒ½å†ç”±Springå®¹å™¨ç®¡ç†çš„beanä¸Šå®ç°</td>
<td>å¯ä»¥åœ¨æ‰€æœ‰åŸŸå¯¹è±¡ä¸Šå®ç°</td>
</tr>
<tr>
<td>ä»…æ”¯æŒæ–¹æ³•æ‰§è¡Œåˆ‡å…¥ç‚¹</td>
<td>æ”¯æŒæ‰€æœ‰åˆ‡å…¥ç‚¹</td>
</tr>
<tr>
<td>ä»£ç†æ˜¯ç”±ç›®æ ‡å¯¹è±¡åˆ›å»ºçš„ï¼Œåˆ‡é¢åˆ‡é¢åº”ç”¨åœ¨è¿™äº›ä»£ç†ä¸Š</td>
<td>åœ¨æ‰§è¡Œåº”ç”¨ç¨‹åºä¹‹å‰ï¼Œå„æ–¹é¢ç›´æ¥åœ¨ä»£ç ä¸­ç»‡å…¥</td>
</tr>
<tr>
<td>æ¯”AspectJæ…¢å¤šäº†</td>
<td>æ›´å¥½çš„æ€§èƒ½</td>
</tr>
<tr>
<td>æ˜“äºå­¦ä¹ å®¹æ˜“</td>
<td>æ¯”SpringAOPæ¥è¯´æ›´å¤æ‚</td>
</tr>
</tbody>
</table>
<h3 id="å¼•å…¥logbackæ¡†æ¶è¿›è¡Œæ—¥å¿—æ‰“å°">å¼•å…¥logbackæ¡†æ¶è¿›è¡Œæ—¥å¿—æ‰“å°</h3>
<h4 id="logbackä»‹ç»">logbackä»‹ç»</h4>
<p>logbackæ˜¯ä¸€ä¸ªJavaé¢†åŸŸçš„æ—¥å¿—æ¡†æ¶ã€‚å®ƒè¢«è®¤ä¸ºæ˜¯Log4Jçš„ç»§æ‰¿äººï¼Œlogbackå’Œlog4Jå±äºåŒä¸€ä¸ªä½œè€…ï¼Œçœ‹ä¸Šå»logbackæ˜¯log4Jçš„å‡çº§ç‰ˆã€‚<br>
logbackåˆ†ä¸ºä¸‰ä¸ªæ¨¡å—ï¼Œlogback-coreï¼Œlogback-classicå’Œlogback-accessï¼Œå…¶ä¸­logback-coreæ˜¯æ ¸å¿ƒå…¶ä»–ä¸¤ä¸ªæ¨¡å—ä¾èµ–coreï¼Œè¿™ä¸ª<br>
logback-classicæ˜¯log4Jçš„æ”¹å–„ç‰ˆæœ¬ï¼Œå¹¶ä¸”åŸç”Ÿå®ç°äº†SELF4Jé—¨é¢ã€‚æ¨¡å—logback-accesså¯ä»¥é›†æˆäºServletå®¹å™¨ã€‚æ¯”å¦‚tomcatå’ŒJettyã€‚<br>
ä½ å¯ä»¥åŸºäºlogback-coreè‡ªå·±åˆ›å»ºå…¶ä»–æ¨¡å—ã€‚</p>
<p>å¦‚å›¾ä¸€æ‰€ç¤ºï¼Œåœ¨é¡¹ç›®çš„åŒ…å¼•ç”¨ä¸­ï¼Œéœ€è¦ä¸‰ä¸ªjaråŒ…åˆ†åˆ«æ˜¯self4j-apiï¼Œlogback-coreï¼Œlogback-classicã€‚</p>
<h4 id="logbackçš„é…ç½®ä»‹ç»">logbackçš„é…ç½®ä»‹ç»</h4>
<p>ç”±äºlogbacké’ˆå¯¹æ•´ä¸ªç³»ç»Ÿçš„æ—¥å¿—è¿›è¡Œå®šä¹‰ï¼Œå› æ­¤éœ€è¦æœ‰ä¸€ä¸ªæ–‡ä»¶è¿™äº›å®šä¹‰è¿›è¡Œé…ç½®ï¼Œè¿™å°±æ˜¯logbackçš„é…ç½®æ–‡ä»¶ï¼Œè¿™é‡Œæˆ‘ä»¬ä»¥logback.xmlæ–‡ä»¶ä¸ºä¾‹ç»™å¤§å®¶ä»‹ç»ã€‚</p>
<p>(1)æ ¹èŠ‚ç‚¹<configuration><br>
<configuration>å…ƒç´ åŒ…å«ä¸‹é¢ä¸‰ä¸ªå±æ€§ï¼š<br>
scanï¼šæ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œé…ç½®æ–‡ä»¶å‘ç”Ÿæ”¹å˜ï¼Œå°†ä¼šè¢«é‡æ–°åŠ è½½<br>
scanPeriodï¼šé…ç½®æ–‡ä»¶ä¿®æ”¹é—´éš”ï¼Œå½“scanä¸ºtrueæ—¶æ­¤å±æ€§ç”Ÿæ•ˆï¼Œ â€œ60 secondsâ€è¡¨ç¤ºé…ç½®æ–‡ä»¶æ¯ä¸ª60sæ£€æŸ¥ä¸€æ¬¡æ˜¯å¦è¢«ä¿®æ”¹ã€‚<br>
debug:å½“æ­¤å±æ€§è®¾ç½®ä¸ºtrueæ—¶ï¼Œå°†æ‰“å°å‡ºlogbackå†…éƒ¨æ—¥å¿—ä¿¡æ¯ã€‚å®æ—¶æŸ¥çœ‹logbackè¿è¡ŒçŠ¶æ€ã€‚é»˜è®¤å€¼ä¸ºfalseã€‚<br>
(2)å­èŠ‚ç‚¹<property><br>
è¯¥èŠ‚ç‚¹æ˜¯configurationçš„å­èŠ‚ç‚¹ï¼Œç”¨æ¥å®šä¹‰å˜é‡å€¼ï¼Œå®ƒæœ‰ä¸¤ä¸ªå±æ€§nameå’Œvalueé€šè¿‡<property>å®šä¹‰çš„å€¼ä¼šè¢«æ’å…¥åˆ°loggerä¸Šä¸‹æ–‡ä¸­ï¼Œå¯ä»¥<br>
ä½¿ç”¨â€œ${}â€æ¥ä½¿ç”¨å˜é‡ã€‚</p>
<p>nameï¼šå˜é‡çš„åç§°<br>
valueï¼šå˜é‡å®šä¹‰çš„å€¼</p>
<p>(3)å­èŠ‚ç‚¹<appender><br>
åŒæ ·appenderèŠ‚ç‚¹ä¹Ÿæ˜¯configurationçš„å­èŠ‚ç‚¹ï¼Œlogbackå°†å†™å…¥æ—¥å¿—äº‹ä»¶çš„ä»»åŠ¡å§”æ‰˜ç»™ä¸€ä¸ªåä¸ºappenderçš„ç»„ä»¶ã€‚<br>
å®ƒæœ‰ä¸¤ä¸ªå±æ€§nameå’Œclassã€‚nameæŒ‡å®šappenderåç§°ï¼ŒclassæŒ‡å®šç±»çš„å…¨é™å®šåç”¨äºå®ä¾‹åŒ–ã€‚<br>
<appender>å…ƒç´ å¯ä»¥ä¿å‡½é›¶ä¸ªæŒ¥ç€ä¸€ä¸ª<layout>å…ƒç´ ï¼Œé›¶ä¸ªæˆ–è€…å¤šä¸ª<encoder>å…ƒç´ ï¼Œé›¶ä¸ªæˆ–è€…å¤šä¸ª<filter><br>
é™¤äº†è¿™äº›å…¬å…±å…ƒç´ ä¹‹å¤–ï¼Œ<appender>å…ƒç´ å¯ä»¥åŒ…å«ä»»æ„ä¸appenderç±»çš„JavaBeanå±æ€§ç›¸ä¸€è‡´çš„å…ƒç´ ï¼Œå¸¸è§ç»“æ„å¦‚ä¸‹</p>
<pre><code class="language-java">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;
&lt;configuration debug=&quot;false&quot;&gt;
&lt;!--å®šä¹‰æ—¥å¿—æ–‡ä»¶çš„å­˜å‚¨åœ°å€ å‹¿åœ¨ LogBack çš„é…ç½®ä¸­ä½¿ç”¨ç›¸å¯¹è·¯å¾„--&gt;
&lt;property name=&quot;LOG_HOME&quot; value=&quot;/data/logs&quot;/&gt;
&lt;!-- æ§åˆ¶å°è¾“å‡º --&gt;
&lt;appender name=&quot;STDOUT&quot; class=&quot;ch.qos.logback.core.ConsoleAppender&quot;&gt;
&lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;
&lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦%msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt;
&lt;pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg %n&lt;/pattern&gt;
&lt;/encoder&gt;
&lt;/appender&gt;

&lt;!-- æŒ‰ç…§æ¯å¤©ç”Ÿæˆæ—¥å¿—æ–‡ä»¶ --&gt;
&lt;appender name=&quot;FILE&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
&lt;file&gt;${LOG_HOME}/mrb-store.log&lt;/file&gt;
&lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;
&lt;fileNamePattern&gt;${LOG_HOME}/mrb-store.log.%d{yyyy-MM-dd}.log&lt;/fileNamePattern&gt;
&lt;maxHistory&gt;15&lt;/maxHistory&gt;
&lt;/rollingPolicy&gt;
&lt;encoder class=&quot;ch.qos.logback.classic.encoder.PatternLayoutEncoder&quot;&gt;
&lt;!--æ ¼å¼åŒ–è¾“å‡ºï¼š%dè¡¨ç¤ºæ—¥æœŸï¼Œ%threadè¡¨ç¤ºçº¿ç¨‹åï¼Œ%-5levelï¼šçº§åˆ«ä»å·¦æ˜¾ç¤º5ä¸ªå­—ç¬¦å®½åº¦%msgï¼šæ—¥å¿—æ¶ˆæ¯ï¼Œ%næ˜¯æ¢è¡Œç¬¦--&gt;
&lt;pattern&gt;%d{yyyy-MM-dd HH:mm:ss.SSS} [%thread] %-5level %logger{50} - %msg%n&lt;/pattern&gt;
&lt;/encoder&gt;
&lt;/appender&gt;

&lt;!-- åº”ç”¨çš„æ—¥å¿—(é”™è¯¯çº§åˆ«)æ–‡ä»¶ --&gt;
&lt;appender name=&quot;ERROR&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
&lt;file&gt;${LOG_HOME}/mrb-store-error.log&lt;/file&gt;
&lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;
&lt;fileNamePattern&gt;${LOG_HOME}/mrb-store-error-%d{yyyy-MM-dd}.log&lt;/fileNamePattern&gt;
&lt;maxHistory&gt;15&lt;/maxHistory&gt;
&lt;/rollingPolicy&gt;
&lt;encoder&gt;
&lt;pattern&gt;%date %level [%thread] %logger{40}[%file-%M %line] %msg%n
&lt;/pattern&gt;
&lt;/encoder&gt;

&lt;filter class=&quot;ch.qos.logback.classic.filter.LevelFilter&quot;&gt;
&lt;level&gt;ERROR&lt;/level&gt;
&lt;onMatch&gt;ACCEPT&lt;/onMatch&gt;&lt;!-- åªæ¥æ”¶é”™è¯¯çº§åˆ«çš„æ—¥å¿— --&gt;
&lt;onMismatch&gt;DENY&lt;/onMismatch&gt;
&lt;/filter&gt;
&lt;/appender&gt;

&lt;!-- æ•°æ®åº“ç›¸å…³æ“ä½œæ—¥å¿— --&gt;
&lt;appender name=&quot;MYSQL_LOG&quot; class=&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;&gt;
&lt;file&gt;${LOG_HOME}/mrb-store-sql.log&lt;/file&gt;
&lt;encoder&gt;
&lt;pattern&gt;%date %level [%thread] %logger{40}[%file-%M %line] %msg%n&lt;/pattern&gt;
&lt;/encoder&gt;
&lt;rollingPolicy class=&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;&gt;
&lt;fileNamePattern&gt;${LOG_HOME}/mrb-store-sql-%d{yyyy-MM-dd}.log&lt;/fileNamePattern&gt;
&lt;maxHistory&gt;15&lt;/maxHistory&gt;
&lt;/rollingPolicy&gt;
&lt;/appender&gt;

&lt;logger name=&quot;com.mrb.store.mapper&quot; level=&quot;debug&quot; additivity=&quot;false&quot;&gt;
&lt;appender-ref ref=&quot;MYSQL_LOG&quot;/&gt;
&lt;/logger&gt;

&lt;!-- å±è”½swaggeræ‰“å°çš„debug infoæ—¥å¿— --&gt;
&lt;logger name=&quot;springfox.documentation.spring.web&quot; level=&quot;WARN&quot;/&gt;

&lt;springProfile name=&quot;dev&quot;&gt;
&lt;root level=&quot;INFO&quot;&gt;
&lt;appender-ref ref=&quot;STDOUT&quot;/&gt;
&lt;appender-ref ref=&quot;FILE&quot;/&gt;
&lt;appender-ref ref=&quot;ERROR&quot;/&gt;
&lt;/root&gt;
&lt;/springProfile&gt;

&lt;springProfile name=&quot;test,audit,prod&quot;&gt;
&lt;root level=&quot;INFO&quot;&gt;
&lt;appender-ref ref=&quot;FILE&quot;/&gt;
&lt;appender-ref ref=&quot;ERROR&quot;/&gt;
&lt;/root&gt;
&lt;/springProfile&gt;

&lt;/configuration&gt;
</code></pre>
<p>(4)RollingFileAppender(è½®è½¬æ—¥å¿—)<br>
RollingFileAppenderæ˜¯ä¸€ç±»appenderå…¶åŠŸèƒ½æ¯”è¾ƒå¼ºå¤§ï¼Œå› æ­¤è¢«å¹¿æ³›åº”ç”¨ã€‚å®ƒå°†æ—¥å¿—è¾“å‡ºåˆ°log.txtï¼Œåœ¨æ»¡è¶³äº†ç‰¹å®šçš„æ¡ä»¶ä¹‹åï¼Œå°†æ—¥å¿—è¾“å‡ºåˆ°å¦ä¸€ä¸ªæ–‡ä»¶ã€‚</p>
<p>ä¸RollingFileAppenderè¿›è¡Œäº¤äº’çš„æœ‰ä¸¤ä¸ªé‡è¦çš„å­ç»„ä»¶ï¼Œç¬¬ä¸€ä¸ªæ˜¯RollingPolicy,å®ƒè´Ÿè´£æ—¥å¿—è½®è½¬çš„è®°å½•ç­–ç•¥ã€‚å¦ä¸€ä¸ªæ˜¯TriggeringPolicy.<br>
å®ƒè´Ÿè´£æ—¥å¿—è½®è½¬çš„è®°å½•æ—¶æœºï¼Œå¦‚å›¾4æ‰€ç¤ºã€‚</p>
<p><file>:è¢«å†™å…¥çš„æ–‡ä»¶åï¼Œå¯ä»¥æ˜¯ç›¸å¯¹ç›®å½•ï¼Œä¹Ÿå¯ä»¥æ˜¯ç»å¯¹ç›®å½•ï¼Œå¦‚æœä¸Šçº§ä¸å­˜åœ¨ä¼šè‡ªåŠ¨åˆ›å»ºï¼Œæ²¡æœ‰é»˜è®¤å€¼ã€‚<br>
<append>:å¦‚æœæ˜¯trueï¼Œæ—¥å¿—è¢«è¿½åŠ åˆ°æ–‡ä»¶ç»“å°¾ï¼Œå¦‚æœæ˜¯falseï¼Œæƒ…å†µç°å­˜æ–‡ä»¶ï¼Œé»˜è®¤æ˜¯trueã€‚<br>
<encoder>:è®°å½•äº‹ä»¶è¿›è¡Œæ ¼å¼åŒ–ã€‚åŒ…å«ä¸¤ä¸ªåŠŸèƒ½ï¼Œä¸€æ˜¯æŠŠæ—¥å¿—ä¿¡æ¯è½¬æ¢æˆå­—èŠ‚æ•°ç»„ï¼ŒäºŒæ˜¯æŠŠå­—èŠ‚æ•°ç»„å†™å…¥åˆ°è¾“å…¥æµã€‚<br>
PatternLayoutEncoderæ˜¯å”¯ä¸€æœ‰ç”¨ä¸”é»˜è®¤çš„encoderï¼Œæœ‰ä¸€ä¸ª<pattern>èŠ‚ç‚¹ï¼Œç”¨æ¥è®¾ç½®æ—¥å¿—çš„è¾“å…¥æ ¼å¼ã€‚ä½¿ç”¨â€œ%â€åŠ è½¬æ¢ç¬¦çš„æ–¹å¼<br>
ï¼Œå¦‚æœè¦è¾“å‡º%ï¼Œåˆ™å¿…é¡»å¯¹â€œ\â€å¯¹â€œ%â€è¿›è¡Œå®šä¹‰ã€‚<br>
<prudent>:å½“ä¸ºtrueæ—¶ï¼Œä¸æ”¯æŒFilxedWindowRollingPolicyã€‚æ”¯æŒTimeBasedRollingPolicyï¼Œä½†æ˜¯æœ‰ä¸¤ä¸ªé™åˆ¶ï¼Œ1.ä¸æ”¯æŒæ–‡ä»¶å‹ç¼©ï¼Œ2.ä¸èƒ½è®¾ç½®ä¸ºfileå±æ€§ï¼Œå¿…é¡»ç•™ç©ºã€‚<br>
<rollingPolicy>ï¼šå½“å‘ç”Ÿæ»šåŠ¨æ—¶ï¼Œå†³å®šRollingFileAppenderçš„è¡Œä¸ºæ¶‰åŠæ–‡ä»¶çš„ç§»åŠ¨å’Œé‡å‘½åï¼Œå±æ€§classå®šä¹‰å…·ä½“çš„æ»šåŠ¨ç­–ç•¥ç±»ã€‚<br>
(5).æ—¥å¿—è¿‡æ»¤å™¨<br>
Filterä½œä¸ºappenderçš„å­èŠ‚ç‚¹ï¼Œå¦‚å›¾æ‰€ç¤ºï¼Œ<br>
<filter>å°†æ—¥å¿—ä¿¡æ¯è¿‡æ»¤ï¼Œå¸¸ç”¨levelFilter-ç­‰çº§è¿‡æ»¤å™¨æ¥è¿‡æ»¤æ—¥å¿—ä¿¡æ¯ï¼Œæœ‰ä¸‰ä¸ªå…ƒç´ <br>
<level>INFO</level> :æŒ‡å®šç‰¹å®šç­‰çº§<br>
<onMatch>ACCEPT</onMatch>ï¼šå¦‚æœåŒ¹é…åˆ™æ¥å—è¾“å‡º<br>
<onMismatch>DENY&lt;/onMismatch:å¦‚æœä¸åŒ¹é…åˆ™è¿‡æ»¤æ‰</p>
<p>(6)loggerå­èŠ‚ç‚¹<br>
å…¶ç”¨æ¥è®¾ç½®æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„æŸä¸€ä¸ªç±»çš„æ—¥å¿—æ‰“å°çº§åˆ«ï¼Œä»¥åŠæŒ‡å®š<appender>.<br>
<logger>ä»…æœ‰ä¸€ä¸ªnameå±æ€§ï¼Œä¸€ä¸ªå¯é€‰çš„levelå’Œä¸€ä¸ªå¯é€‰çš„addtivityå±æ€§ã€‚<br>
å¯ä»¥åŒ…æ‹¬é›¶ä¸ªæˆ–è€…å¤šä¸ª<appender-ref>å…ƒç´ ï¼Œæ ‡è¯†è¿™ä¸ªappenderå°†ä¼šæ·»åŠ åˆ°è¿™ä¸ªlogger<br>
name:ç”¨æ¥æŒ‡å®šå—æ­¤loggerçº¦æŸçš„æŸä¸€ä¸ªåŒ…æˆ–è€…å…·ä½“çš„ç±»ï¼Œ<br>
level:ç”¨æ¥æ‰“å°æ—¥å¿—çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼ŒTRACKï¼ŒDEBUGï¼ŒINFOï¼ŒWARNï¼ŒERRORï¼ŒALLï¼ŒOFFè¿˜æœ‰ä¸€ä¸ªç‰¹æ®Šçš„å€¼InHERITENæˆ–è€…åŒä¹‰è¯NULLã€‚<br>
addtivityï¼šæ˜¯å¦å‘ä¸Šçº§loggerä¼ é€’æ‰“å°ä¿¡æ¯ã€‚é»˜è®¤æ˜¯trueã€‚</p>
<p>loggerèŠ‚ç‚¹å¯ä»¥åŒ…å«é›¶ä¸ªæˆ–è€…å¤šä¸ª<appender-ref>å…ƒç´ ï¼Œæ ‡è¯†è¿™ä¸ªappenderå°†ä¼šæ·»åŠ åˆ°è¿™ä¸ªloggerã€‚</p>
<p>(7)RootèŠ‚ç‚¹<br>
å®ƒä¹Ÿæ˜¯ä¸€ä¸ªloggerèŠ‚ç‚¹å…ƒç´ ï¼Œä¸è¿‡å®ƒæ˜¯ä¸€ä¸ªæ ¹loggerï¼Œä¹Ÿå°±æ˜¯æ‰€æœ‰loggerçš„ä¸Šçº§èŠ‚ç‚¹ï¼Œåªæœ‰ä¸€ä¸ªlevelå±æ€§ï¼Œå› ä¸ºnameå·²ç»è¢«å‘½åä¸ºâ€œrootâ€ï¼Œä¸”å·²ç»æ˜¯æœ€ä¸Šçº§äº†ã€‚</p>
<p>levelï¼šç”¨æ¥è®¾ç½®æ‰“å°çº§åˆ«ï¼Œå¤§å°å†™æ— å…³ï¼šTRACEï¼ŒDEBUGï¼ŒINFOï¼ŒWARNï¼ŒERRORï¼ŒALLï¼ŒOFFã€‚ä¸èƒ½è®¾ç½®ä¸ºINHERITEDæˆ–è€…åŒä¹‰è¯NULLï¼Œé»˜è®¤æ˜¯DEBUGã€‚</p>
<figure data-type="image" tabindex="10"><img src="../framework/images/logback.png" alt="SpringAOP" loading="lazy"></figure>
<h3 id="aspectæ³¨è§£æ˜¯æ€ä¹ˆè¿ä½œèµ·æ¥çš„">@Aspectæ³¨è§£æ˜¯æ€ä¹ˆè¿ä½œèµ·æ¥çš„</h3>
<h4 id="aspectæ‰§è¡Œè¿‡ç¨‹">@Aspectæ‰§è¡Œè¿‡ç¨‹</h4>
<p>@Aspectåˆ‡é¢ç±»æ³¨è§£å±äºSpring2.0ä»¥åå®šä¹‰çš„æ ‡ç­¾æ³¨è§£ï¼Œåœ¨é…ç½®æ–‡ä»¶ApplicationContext.xmlä¸­ä»¥<br>
aop:aspect-autoproxyçš„æ–¹å¼å¼€å¯ã€‚å…¶åŸç†æ˜¯é€šè¿‡ä»£ç è¿½è¸ªï¼Œåœ¨AopNamespaceHandlerä¸­æ‰¾åˆ°äº†å¯¹è¿™ä¸ªæ ‡ç­¾çš„è§£æå™¨<br>
AspectJAutoProxyBeanDefinitionParserç±»ã€‚<br>
å…ˆçœ‹çœ‹AspectJAutoProxyBeanDefinitionParserä¸­çš„parseæ–¹æ³•å¦‚ä½•å¯¹@AspectJæ ‡ç­¾è¿›è¡Œè§£æå·¥ä½œçš„ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼Œ<br>
parseæ–¹æ³•é‡Œé¢å¯¹è°ƒç”¨registerAspectJAnnotationAutoProxyCreatorIfNecessary</p>
<p>æ–¹æ³•å¯¹è§£æä¸Šä¸‹æ–‡ä»¥åŠæ­ä¸Šæ³¨é‡Šçš„å…ƒç´ è¿›è¡Œæ³¨å†Œã€‚é¡ºåŠ¿çœ‹æ³¨å†Œæ–¹æ³•ç´«çº¢è°ƒç”¨AopConfigUtils.registerAspectJAnnotationAutoProxyCreatorIfNecessary<br>
æ–¹æ³•åˆ›å»ºBeanDefinitionï¼Œå¹¶ä¸”æŠŠBeanDefinitionæ³¨å†Œç»„ä»¶é‡Œã€‚</p>
<pre><code class="language-java">public  BeanDefinition parse(Element element ,ParserContext parserContext){
        
    AopNamespace.registerAspectJAnnotationAutoProxyCreatorIfNecessary(parserContext,element)
        
}

public static registerAspectJAnnotationAutoProxyCreatorIfNecessary(ParserContext parserContext , Element element){
        BeanDefinition BeanDefinition = AopConfigUtils.registerAspectJAnnotationAutoProxyCreatorIfNecessary(parserContext,element);
        useClassProxyIfNecessary(parserContext.getRegistry() , sourceElemet) ;
        registerComponentIfNecessary(beanDefinition ,parserContext);
}



</code></pre>
<p>ä»å‰é¢çš„è¯¾ç¨‹çŸ¥é“BeanDefinitionæ˜¯Springå®¹å™¨å¯¹Beanè¿›è¡Œå­˜å‚¨å’Œç®¡ç†çš„æ¨¡å¼ï¼Œæ¥ç€çœ‹registerAspectJAnnotationAutoProxyCreatorIfNecessary<br>
æ˜¯ç¬¦åˆç”ŸæˆBeanDefinitionçš„ã€‚å¦‚å›¾æ‰€ç¤ºï¼ŒregisterAspectJAnnotationAutoProxyCreatorIfNecessaryæ–¹æ³•ç›´æ¥è°ƒç”¨getResource<br>
registerOrEscalateApcAsRequiredæ–¹æ³•äº§ç”ŸBeanDefinitionã€‚å…¶ä¸»è¦æ“ä½œå°±æ˜¯å»ºç«‹RootBeanDefinitionçš„æ ¹ï¼Œ<br>
ç„¶åè®¾ç½®å…¶æºï¼Œè§’è‰²ä»¥åŠå¯¹BeanDefinitionçš„æ³¨å†Œã€‚</p>
<pre><code class="language-java">
public static BeanDefinition registerAspectJAnnotationAutoProxyCreatorIfNecessary(BeanDefinitionRegistry registry ,Object source){
    return registerOrEscalateApcAsRequired(AnnotationAwareAspectJAutoProxyCreator.class ,registry.source);
}

private static registerOrEscalateApcAsRequired(Class&lt;?&gt; cls ,BeanDefinitionRegistry registry,Object source){
    Assert.nonNull(register ,&quot;BeanDefinitionRegistry must not be null&quot;);
    if(registry.containsBeanDefinition(AUTO_PROXY_CREATOR_BEAN_NAME)){
       BeanDefinition apcDefinition = registry.getBeanDefinition(AUTO_PROXY_CREATOR_BEAN);
       if(cls.getName().equals(apcDefinition.getBeanClassName())){
         int currentPriority =  findPriorityForClass(apsDefinition.getBeanClassName())
         int requiredPriority = findPriorityForClass(cls)
        if(currentPriority &lt; requiredPriority){
            apcDefinition.setBeanClassName(cls.getName())
         }
        }
       return null;
    }
    //å°è£…ä¸€ä¸ªä»£ç†
    RootBeanDefinition beanDefinition = new RootBeanDefinition(cls);
    beanDefinition.setSource(source);
    beanDefinition.getPropertyValues().add(&quot;order&quot;,ORDER.HIGHEST_PRECEDENCE);
    beanDefinition.serRole(BeanDefinition.ROLE_INFRASTEUCTURE);
    registry.register(AUTO_PROXY_CREATOR_BEAN_NAME ,beanDefinition);
    return beanDefinition;
}

</code></pre>
<p>ç»è¿‡ä»¥ä¸Šå¤„ç†AnnotationAwareAspectJAutoProxyCreatorç±»å°±è¢«åˆ›å»ºå¤„ç†äº†ï¼Œè€Œè¿™ä¸ªç±»çš„åŠŸèƒ½å°±æ˜¯å®ŒæˆAOPå¢å¼ºçš„ï¼Œå®ƒé›†æˆäº†çˆ¶ç±»AbstractAutoProxyCreatorï¼ŒåŒæ—¶å…¶çˆ¶ç±»å®ç°äº†BeanPostProcessoræ¥å£ï¼Œå®ƒåœ¨å®ç°æ”¹æ¥å£åï¼Œ<br>
SpringåŠ è½½Beanæ—¶ä¼šåœ¨å…¶å®ä¾‹è¯å‰è°ƒç”¨å…¶postProcessBeforeInstantiationæ–¹æ³•ï¼Œæ¥ä¸‹æ¥çœ‹è¿™ä¸ªæ–¹æ³•ï¼Œå¦‚å›¾ä¸‰æ‰€ç¤ºï¼ŒpostProcessBeforeInstantiationæ–¹æ³•ä¸­ï¼Œå…ˆæ·»åŠ ç›®æ ‡Beanï¼Œç„¶åè·å–æœ‰@Aspectæ³¨è§£ç±»ä¸­çš„å¢å¼ºæ–¹æ³•ï¼Œ<br>
æœ€åæ‹¦æˆªå™¨specificInterceptorså¯¹æºç›®æ ‡ç±»åˆ›å»ºä»£ç†å¢å¼ºã€‚</p>
<pre><code class="language-java">public Object postProcessBeforeInstantiation(Class&lt;?&gt; beanClass ,String beanName) throws Exception {
   Object cacheKey = getCacheKey(beanClass , beanName);
   if(beanName == null || !this.targetSourceBeans.constains(beanName)){
       if(this.adviseBeans.constains(cacheKey)){
           return null;
        }
       if(isInfrastructrue(beanClass) || shouldSkip(beanClass,beanName)){
           this.adviseBeans.put(cacheKey, Boolean.FALSE);
        }
    }
   if(beanName != null){
      TargetSource targetSource =   getCustomTargetSource(beanClass, beanName);
      if(targetSource != null){
          //è·å–å­˜åœ¨ä¸aspectæ³¨è§£ç±»ä¸­çš„å¢å¼ºæ–¹æ³•ï¼›
        Object[] specificInterceptords = getadvicesAndAdvisorsForBean(beanClass, beanName, targetSource);
        // æ ¹æ®å¢å¼ºå™¨åˆ›å»ºä»£ç†
        Object proxy =  createProxy(beanClass ,beanName ,specificInterceptors,targetSource);
        this.proxy.put(createKey,proxy.getCLass());
        return proxy;
        }
    }
        return null;
}


</code></pre>
<p>æŒ‰ç…§ä¸Šé¢çš„ä»£ç æè¿°æ˜¯ç”±getadvicesAndAdvisorsForBeanæ¥ç”Ÿæˆæ‹¦æˆªå™¨çš„ï¼Œå®ƒåŒ…æ‹¬å¦‚ä¸‹å·¥ä½œï¼š<br>
è·å–beanFactoryä¸­æ‰€æœ‰çš„@Aspectæ³¨è§£çš„ç±»</p>
<p>å¯¹æ ‡è®°ç±»è¿›è¡Œå¢å¼ºæå–ï¼Œæå–ä¹‹å‰éœ€æ±‚å¯¹åˆ‡å…¥ä¿¡æ¯ï¼ˆbeforeï¼Œafterï¼Œaroundç­‰ï¼‰è¿›è¡Œå¢å¼ºï¼Œå…¶ä¸­<br>
beforeå¢å¼ºè¢«ä¸ºAspectJmethodBeforeAdvice<br>
afrerå¢å¼ºä¸ºAspectJAfterAdvice<br>
aroundå¢å¼ºä¸ºAspectJAfterThrowingAdviceå¢å¼ºå™¨<br>
å¢å¼ºå™¨å°è£…åï¼Œè¢«ä»£ç†æ¥å£è°ƒç”¨æ—¶ï¼Œä¼šè§¦å‘å¢å¼ºå™¨ä¸­çš„æ–¹æ³•ã€‚</p>
<p>æ¥ä¸‹æ¥çœ‹çœ‹postProcessBeforeInstantiationä¸­å‡ºç°çš„createProxyæ–¹æ³•ï¼Œå®ƒæ˜¯ç”¨æ¥åˆ›å»ºæ‹¦æˆªå™¨ä»£ç†çš„ã€‚å¦‚å›¾æ‰€ç¤ºï¼Œ<br>
åœ¨createProxyæ–¹æ³•ä¸­ä¼šè¢«æ¥å—æ‹¦æˆªå™¨specificInterceptorså’Œç›®æ ‡æºã€‚æ–¹æ³•ä½“ä¸­åˆ›å»ºä»£ç†å·¥å‚ï¼Œæ¥ä¸‹æ¥å°±æ˜¯é€šè¿‡buildAdvicetorsæ–¹æ³•ç”Ÿæˆ<br>
advisorsä¹Ÿå°±æ˜¯å¢å¼ºçš„æ–¹æ³•ï¼Œå¯¹å…¶è¿›è¡Œéå†ï¼Œå¹¶ä¸”åŠ å…¥åˆ°ä»£ç†å·¥å‚ä¸­ã€‚ç„¶åè¦è®¾ç½®è¦ä»£ç†çš„ç±»ï¼Œé€šè¿‡proxyFactoryä¸­getProxyæ–¹æ³•è·å–ä»£ç†ç±»ä¿¡æ¯</p>
<pre><code class="language-java">
public Object createProxy(Class&lt;?&gt; beanClass ,String beanName ,Object[] specificInterceptors ,TargetSource targetSource){
        //åˆ›å»ºé“ç†å·¥å‚
        ProxyFactory proxyFactory=new ProxyFactory();
        proxyFactory.copyFrom(this);
        //å†³å®šå¯¹åº”ç»™å®šçš„beanæ˜¯å¦åº”è¯¥ä½¿ç”¨targetClassè€Œä¸æ˜¯ä»–çš„æ¥å£ä»£ç†ï¼Œä¸»è¦çœ‹xmlä¸­çš„é…ç½®ï¼š
        //æ£€æŸ¥proxyTargetClassè®¾ç½®ä»¥åŠpreserverTargetClasså±æ€§
        if(!proxyFactory.isProxyTargetClass()){
        if(!shouldProxyTargetClass(beanClass,beanName)){
        //ç±»CGLIBä»£ç†
        proxyFactory.setProxyTargetClass(true);
        }else{
        //æ·»åŠ ä»£ç†æ¥å£ï¼ŒåŠ¨æ€ä»£ç†
        evaluateProxyInterfaces(beanClass,proxyFactory);
        }
        }
        Adisor[]adisors=buildAdvisors(beanName,specificInterceptors);
        for(Advisor advisor:adisors){
        //åŠ å…¥å¢å¼ºå™¨ï¼ŒAspectJmethodBeforeAdviceç­‰
        proxyFactory.addAdvisor(advisor);

        }
        //è®¾ç½®è¦ä»£ç†çš„ç±»
        proxyFactory.setProxyTargetClass(targetSource);
        customeieProxyFactory(proxyFactory);
        proxyFactory.setFrozen(this.freezeProxy);
        if(advisorsPreFiltered){
        proxyFactory.setPreFiltered(true);
        }
        return proxyFactory.getProxy(getProxyClassLoader())


        }

</code></pre>
<p>åœ¨createProxyæ–¹æ³•æœ€åä¼šè°ƒç”¨getProxyæ–¹æ³•ï¼ŒcreateAopProxy().getProxy(classLoader);åœ¨è¢«è°ƒç”¨çš„getProxyæ–¹æ³•å®ç°JDKåŠ¨æ€ä»£ç†ï¼Œè¿™ä¸ªåœ¨ä¸Šå‘¨JDKä»£ç†çš„æºç ä¸­æåˆ°è¿‡ï¼Œè¯¥æ–¹æ³•å¯¹ä»£ç†ç±»è¿›è¡Œå®ä¾‹åŒ–å¹¶ä¸”è¿”å›ã€‚</p>
<pre><code class="language-java">public Object getProxy(ClassLoader classLoader){
    return createProxy().getProxy(classLoader);
        }
        
public getProxy(ClassLoader classLoader){
    if(logger.isDebugEnabled()){
        logger.debug(&quot;&quot;)
        }
   CLass&lt;?&gt;[] proxiedInterfaces =  AopProxyUtils.comoleteProxiedInterfaces(this.advised);
    findDefinitionEqualsAndHashCodeMethods(proxiedInterfaces);
    return Proxy
}

</code></pre>
<p>å½“è¿”å›ä»£ç†ç±»ä¹‹åä¼šæ‰§è¡Œè¯¥ä»£ç†ç±»å½“invokeæ–¹æ³•ï¼Œæœ€åæ¥çœ‹çœ‹invokeæ–¹æ³•çš„æºç ï¼Œè¿™ä¸ªæ–¹æ³•åœ¨ä¸Šå‘¨JDKåŠ¨æ€ä»£ç†è¯¾ä¸­è®²è¿‡ï¼Œä¸»è¦æ˜¯å¯¹æ‹¦æˆªè¿è¿›è¡Œå¾ªç¯å¢å¼ºï¼Œä¹Ÿå°±æ˜¯å°†æ‹¦æˆªå™¨ä¸€ä¸ªä¸ªä¸²è¡Œæ‰§è¡Œï¼Œä»è€Œè¾¾åˆ°å¯¹ç›®æ ‡æ–¹æ³•çš„å¢å¼ºã€‚</p>
<pre><code class="language-java">public Object invoke(Object proxy ,Method method ,Object[] args) throws Exception{
    MethodInvocation invocation =;
    
    Object oldProxy = null;
    
    boolean setProxyContext = false;
    TargetSource targetSource =  this.advised.targetSource;
    Class&lt;?&gt; targetClass = null;
    try {
        if(!this.equalsDefined &amp;&amp; AopUtils.isEquealMethod(method)){
            ---
        }
        if(!this.hashCodeDefined &amp;&amp; AOpUtils.isEquealMethod(method)){
            ---
        }
        if(this.advised.opaque &amp;&amp; method.getDeclaryingClass().isInterface() &amp;&amp;){
            
        }
        Object retVal ;
        target =  targetSource.getTarget();
        //è·å–æ–¹æ³•æ‹¦æˆªå™¨é“¾ï¼Œå…¶å®å°±æ˜¯æŠŠå¢å¼ºå™¨å°è£…æˆæ‹¦æˆªå™¨çš„å½¢å¼ä¸²è¡Œè°ƒç”¨çš„ï¼›
        List&lt;Object&gt; chain = this.advised.getInterceptorsAndDynamicInterceptionAdvice(method ,targetClass);
        }
        if(chain.isEmpty()){
            retVal = AOpUtils.invokeJoinPointUseingRefletion(target ,method,args);
        }else{
        invocation =  new ReflectiveMethodInvocation(proxy ,target ,method,args,targetClass,chain);
        retVal = invocation.processd();
        }
        CLass&lt;?&gt; retureType = method.getReturnType();
        if(retVal != null &amp;&amp; retVal == target &amp;&amp; returnType.isInstance(proxy) &amp;&amp; !RawTargetAccess.class.isAssignableFrom(method.getDeclaryingClass())){
            retVal = proxy ;
        }
        else if(retval == null &amp;&amp; returnType != Void.Type &amp;&amp; returnType.isPrimitive() &amp;&amp; returnType.){
            throws new AopInvocationException(&quot;&quot;);
        }
        
        return retVal;
}



</code></pre>
<h3 id="_ä»£ç å®æˆ˜åŸºäºspring-aopæœºåˆ¶å®ç°å…¨å±€å¼‚å¸¸å¤„ç†">_ä»£ç å®æˆ˜ï¼šåŸºäºSpring AOPæœºåˆ¶ï¼Œå®ç°å…¨å±€å¼‚å¸¸å¤„ç†</h3>
<h4 id="controlleradviceä¸exceptionhandleræ³¨è§£">ControllerAdviceä¸ExceptionHandleræ³¨è§£</h4>
<p>å¦‚æœè¯´éœ€è¦å¯¹ç³»ç»Ÿå†…éƒ¨å¼‚å¸¸é‡‡å–ç»Ÿä¸€çš„å¤„ç†ï¼Œå…¶æ€è·¯è¿˜æ˜¯é€šè¿‡Spring AOP å»æˆªè·å¼‚å¸¸ä¿¡æ¯ï¼Œè¿›è¡Œç»Ÿä¸€å¤„ç†ç„¶åå†è¿”å›ç»™å®¢æˆ·ç«¯ã€‚åœ¨ä½¿ç”¨Spring AOPç¼–å†™å¼‚å¸¸å¤„ç†ç±»ä¹‹å‰å…ˆä»‹ç»å‡ ä¸ªæ³¨é‡Šã€‚</p>
<p>ControllerAdviceï¼Œé¡¾åæ€ä¹‰æ˜¯ä¸€ä¸ªå¢å¼ºçš„ Controllerï¼Œå¢å¼ºçš„æ¦‚å¿µåœ¨SpringAOPä¸­å°±æ˜¯æˆ‘ä»¬éœ€è¦ç»‡å…¥æ–¹æ³•çš„å…·ä½“å†…å®¹ï¼Œå›åˆ°æœ¬èŠ‚å†…å®¹å°±æ˜¯éœ€è¦è¿›è¡Œå¼‚å¸¸å¤„ç†çš„åœ°æ–¹ã€‚</p>
<p>ä½¿ç”¨ControllerAdviceå¯ä»¥å®ç°ä¸‰ä¸ªæ–¹é¢çš„åŠŸèƒ½ï¼šå…¨å±€å¼‚å¸¸å¤„ç†ã€å…¨å±€æ•°æ®ç»‘å®šå’Œå…¨å±€æ•°æ®é¢„å¤„ç†ã€‚åœ¨æˆ‘ä»¬çš„é¡¹ç›®ä¸­ï¼Œä¸»è¦å…³æ³¨å…¨å±€å¼‚å¸¸å¤„ç†çš„åŠŸèƒ½ã€‚</p>
<p>å¦‚å›¾1æ‰€ç¤ºï¼Œåœ¨å»ºç«‹çš„MyGlobalExceptionHandlerç±»ä¸Šæ ‡è®°äº†ControllerAdviceæ³¨è§£ï¼Œè¡¨ç¤ºå¯¹Controllerçš„è¯·æ±‚è¿›è¡Œå¢å¼º<br>
ã€‚<br>
åœ¨ç±»ä¸­çš„customExceptionæ–¹æ³•ä¸Šé¢é€šè¿‡ä¸€ä¸ªExceptionHandleræ³¨è§£ï¼Œå‚æ•°ä½¿ç”¨Exception.classè¡¨ç¤ºå¯¹Exceptionç±»å‹çš„å¼‚å¸¸è¿›è¡Œå¤„ç†ã€‚</p>
<p>è¿™é‡Œå¯ä»¥æ ¹æ®éœ€è¦å®šä¹‰å…¶ä»–å¼‚å¸¸ï¼Œç”šè‡³æ˜¯è‡ªå®šä¹‰çš„å¼‚å¸¸ç±»ã€‚ç„¶åé€šè¿‡new ModelAndViewåˆå§‹åŒ–å‡ºModelAndViewï¼Œå¹¶ä¸”å¯¹å…¶è¿›è¡Œä¿®æ”¹é€šè¿‡addObjectæ–¹æ³•å’ŒsetViewNameåŠ å…¥ä¸€äº›é”™è¯¯ä¿¡æ¯ï¼Œä»è€Œé€šè¿‡return è¯­å¥å°†è¿™ä¸ªModelAndViewè¿”å›ç»™Controllerçš„è°ƒç”¨è€…</p>
<pre><code class="language-java">
/**
 * å…¨å±€å¼‚å¸¸å¤„ç†å™¨
 */
@Slf4j
@RestControllerAdvice
public class ExceptionHandlerAdvice {

    /**
     * åŸºç¡€å¼‚å¸¸
     */
    @ExceptionHandler(BaseException.class)
    public Response&lt;Void&gt; baseException(BaseException e) {
        return Response.fail(e.getMessage());
    }

    @ExceptionHandler(NoHandlerFoundException.class)
    public Response&lt;Void&gt; handlerNoFoundException(Exception e) {
        log.error(e.getMessage());
        return Response.fail(Code.System.NOT_FOUND);
    }

    @ExceptionHandler(AccessDeniedException.class)
    public Response&lt;Void&gt; handleAuthorizationException(AccessDeniedException e) {
        log.error(e.getMessage());
        return Response.fail(Code.System.FORBIDDEN);
    }

    @ExceptionHandler(AccountExpiredException.class)
    public Response&lt;Void&gt; handleAccountExpiredException(AccountExpiredException e) {
        log.error(e.getMessage(), e);
        return Response.fail(e.getMessage());
    }

    @ExceptionHandler(UsernameNotFoundException.class)
    public Response&lt;Void&gt; handleUsernameNotFoundException(UsernameNotFoundException e) {
        log.error(e.getMessage(), e);
        return Response.fail(e.getMessage());
    }

    @ExceptionHandler(Exception.class)
    public Response&lt;Void&gt; handleException(Exception e) {
        log.error(e.getMessage(), e);
        return Response.fail(Code.System.ERROR_SERVER);
    }

    /**
     * è‡ªå®šä¹‰éªŒè¯å¼‚å¸¸
     */
    @ExceptionHandler(BindException.class)
    public Response&lt;Void&gt; validatedBindException(BindException e) {
        log.error(e.getMessage(), e);
        String message = e.getAllErrors().get(0).getDefaultMessage();
        return Response.fail(message);
    }

    @ExceptionHandler(MrbException.class)
    public Response&lt;Void&gt; handleAllException(MrbException e, HttpServletRequest req) {
        log.error(&quot;tips:{} request method:{} uri:{}&quot;, e.getMessage(), req.getMethod(), req.getRequestURI());
        if (e.getErrorCode() != null &amp;&amp; e.getErrorCode() != Code.System.FAIL) {
            return Response.fail(e.getErrorCode(), null, e.getErrorCode().getLabel());
        }
        return Response.fail(Code.System.FAIL, null, e.getMessage());
    }

    @ExceptionHandler(HystrixBadRequestException.class)
    public Response&lt;Void&gt; handleAllException(HystrixBadRequestException e, HttpServletRequest req) {
        log.error(&quot;tips:{} request method:{} uri:{}&quot;, e.getMessage(), req.getMethod(), req.getRequestURI());
        MrbException exception = (MrbException) e.getCause();
        if (exception.getErrorCode() != null &amp;&amp; exception.getErrorCode() != Code.System.FAIL) {
            return Response.fail(exception.getErrorCode(), null, exception.getErrorCode().getLabel());
        }
        return Response.fail(Code.System.FAIL, null, e.getMessage());
    }

    @ExceptionHandler(HttpRequestMethodNotSupportedException.class)
    public Response&lt;Void&gt; handleFeignException(HttpRequestMethodNotSupportedException e, HttpServletRequest req) {
        log.error(&quot;request method:{} uri:{}&quot;, req.getMethod(), req.getRequestURI(), e);
        return Response.fail(Code.System.ERROR_METHOD, null, e.getMessage());
    }

    @ExceptionHandler(value = {MismatchedInputException.class, HttpMessageNotReadableException.class})
    public Response&lt;Void&gt; handleFeignException(Exception e, HttpServletRequest req) {
        log.error(&quot;request method:{} uri:{}&quot;, req.getMethod(), req.getRequestURI(), e);
        return Response.fail(Code.System.ERROR_PARAMS, null, Code.System.ERROR_PARAMS.getLabel());
    }

    @ExceptionHandler(value = {RetryableException.class})
    public Response&lt;Void&gt; handleRetryableException(RetryableException e, HttpServletRequest req) {
        log.error(&quot;request method:{} uri:{}&quot;, req.getMethod(), req.getRequestURI(), e);
        return Response.fail(Code.System.ERROR_PARAMS, null, &quot;è¯·æ±‚è¶…æ—¶&quot;);
    }

    /**
     * å‚æ•°æ ¡éªŒå¼‚å¸¸å¤„ç†
     *
     * @param e
     * @param req
     * @return Response&lt;java.util.Map &lt; java.lang.String, java.lang.String&gt;&gt;
     * @author zhangdecheng
     * @date 2020/9/18 17:40
     */
    @ExceptionHandler(value = MethodArgumentNotValidException.class)
    public Response&lt;Map&lt;String, String&gt;&gt; methodArgumentNotValidException(MethodArgumentNotValidException e, HttpServletRequest req) {
        String errMsg = e.getBindingResult().getFieldErrors()
                .stream()
                .map(FieldError::getDefaultMessage)
                .collect(Collectors.joining(&quot;, &quot;));

        log.error(&quot;request method:{} uri:{}&quot;, req.getMethod(), req.getRequestURI(), e);
        return Response.fail(Code.System.ERROR_PARAMS, null, errMsg);
    }

}


</code></pre>
<p>å¯ä»¥ä»å›¾2 ä¸­ä¸‹é¢ä¸€ä¸ªæ–¹æ³•handleBusinessExceptionå”¯ä¸€çš„ä¸åŒæ˜¯åœ¨ExceptionHandleræ³¨è§£çš„å‚æ•°ä¸Šã€‚è¿™é‡Œä½¿ç”¨çš„å‚æ•°ç±»å‹æ˜¯BusinessException.classï¼Œæ˜¯æˆ‘ä»¬è‡ªå·±å®šä¹‰çš„ä¸šåŠ¡å¼‚å¸¸ç±»ã€‚</p>
<p>å¦‚å›¾3æ‰€ç¤ºï¼Œspring/exceptionç›®å½•ä¸‹é¢å»ºç«‹BusinessExceptionç±»ï¼Œå…¶ç»§æ‰¿ä¸RuntimeExceptionç±»ã€‚</p>
<p>è¿™ä¸ªBusinessExceptionå¯ä»¥åœ¨å…¨å±€å¼‚å¸¸å¤„ç†ç±»ä¸­è¢«å¤„ç†ï¼Œå¦‚æœåœ¨ä¸šåŠ¡ä»£ç ä¸­ä¹Ÿæ¥æŠ›å‡ºè¿™ä¸ªå¼‚å¸¸ï¼Œä¹Ÿæ˜¯å¯ä»¥è¢«GlobalExceptionHandlerç±»ä¸­çš„handleBusinessExceptionæ–¹æ³•æ•è·åˆ°å¹¶å¤„ç†çš„ã€‚</p>
<pre><code class="language-java">

/**
 * @desc å…¬å…±è‡ªå®šä¹‰å¼‚å¸¸
 */
@Slf4j
public class MrbException extends RuntimeException {

    private static final long serialVersionUID = -3361373660274001948L;

    private StatusCode errorCode;

    public MrbException() {
        super();
    }

    public MrbException(String errorMsg) {
        super(errorMsg);
        this.errorCode = Code.System.FAIL;
    }

    public MrbException(StatusCode errorCode) {
        super(errorCode.getLabel());
        this.errorCode = errorCode;
    }

    public MrbException(StatusCode errorCode, String msg) {
        super(msg);
        this.errorCode = errorCode;
    }

    public static void throwException(StatusCode errorCode) {
        throw new MrbException(errorCode);
    }

    public static void throwException(String errorMsg) {
        throw new MrbException(errorMsg);
    }

    public static void throwException(boolean expression, String errorMsg) {
        if (expression) {
            throw new MrbException(errorMsg);
        }
    }


    public static MrbException convert(Integer code, String msg) {
        StatusCode statusCode = Code.enumValueOf(code);
        if (statusCode != null) {
            return new MrbException(statusCode, msg);
        }
        return null;
    }

    public static MrbException convert(Integer code) {
        StatusCode statusCode = Code.enumValueOf(code);
        if (statusCode != null) {
            return new MrbException(statusCode);
        }
        return null;
    }

    public StatusCode getErrorCode() {
        return errorCode;
    }

    public void setErrorCode(StatusCode errorCode) {
        this.errorCode = errorCode;
    }
}

</code></pre>
<p>4ã€æ€»ç»“<br>
æœ¬èŠ‚è¯¾åœ¨ä»‹ç»äº†åˆ©ç”¨Spring AOP å®ç°å…¨å±€å¼‚å¸¸å¤„ç†çš„æ€è·¯ï¼Œä»ControllerAdviceä¸ExceptionHandleræ³¨è§£å…¥æ‰‹ï¼Œ<br>
æˆ‘ä»¬åˆ›å»ºäº†è‡ªå·±çš„å…¨å±€å¼‚å¸¸å¤„ç†ç±»GlobalExceptionHandlerã€‚åˆ°Controllerä¸­æŠ›å‡ºå¼‚å¸¸çš„æ—¶å€™GlobalExceptionHandlerä¸­æœ‰å¯¹åº”çš„æ–¹æ³•å°±å¯ä»¥æ•è·åˆ°ã€‚<br>
é’ˆå¯¹ä¸åŒçš„å¼‚å¸¸ç±»ï¼Œå¯ä»¥ç¼–å†™ä¸åŒçš„å¼‚å¸¸å¤„ç†æ–¹æ³•ã€‚</p>
<h3 id="åŸºäºspring-aopæœºåˆ¶æ‹¦æˆªå¤„ç†ç™»é™†ä¿¡æ¯">åŸºäºSpring AOPæœºåˆ¶æ‹¦æˆªå¤„ç†ç™»é™†ä¿¡æ¯</h3>
<p>ä¸ŠèŠ‚è¯¾éªŒè¯äº†å¤„ç†å¼‚å¸¸çš„ä»£ç ï¼Œé€šè¿‡GlobalExceptionHandlerç±»å¤„ç†Controllerä¸­æŠ›å‡ºçš„å¼‚å¸¸ä¿¡æ¯ï¼Œä»è€Œè§£å†³é¡µé¢æŠ¥é”™çš„é—®é¢˜ã€‚æœ¬èŠ‚è¯¾é€šè¿‡ä½¿ç”¨Spring AOPçš„æ–¹å¼æ‹¦æˆªç™»é™†ä¿¡æ¯ï¼Œå¹¶ä¸”åˆ¤æ–­ä»Šå¤©çš„å†…å®¹ï¼š</p>
<p>æ·»åŠ LoginInterceptorç±»ç”¨æ¥æ‹¦æˆªç™»é™†ä¿¡æ¯</p>
<p>é…ç½®spring-web.xmlä¸­çš„æ‹¦æˆªå™¨</p>
<h4 id="æ·»åŠ logininterceptorç±»æ‹¦æˆªç™»é™†ä¿¡æ¯">æ·»åŠ LoginInterceptorç±»æ‹¦æˆªç™»é™†ä¿¡æ¯</h4>
<p>æ—¢ç„¶æ˜¯æ‹¦æˆªç™»é™†ä¿¡æ¯ï¼Œå°±éœ€è¦å…ˆå»ºç«‹ä¸€ä¸ªæ‹¦æˆªç±»ï¼Œç”¨æ¥å¤„ç†ç™»é™†è¯·æ±‚ä¹‹å‰çš„åˆ¤æ–­å·¥ä½œã€‚å¦‚å›¾1æ‰€ç¤ºï¼Œåœ¨/spring/interceptor ç›®å½•ä¸‹é¢å»ºç«‹LoginInterceptorç±»ï¼Œè¿™ä¸ªç±»æ˜¯ä¸“é—¨ç”¨æ¥æ‹¦æˆªç™»é™†è¯·æ±‚çš„ã€‚</p>
<p>è¯¥ç±»å®ç°äº†HandlerInterceptorï¼Œå¹¶ä¸”Overrideäº†preHandleæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯åœ¨å¤„ç†ç™»é™†è¯·æ±‚ä¹‹å‰ä¼šæ‰§è¡Œè¯¥æ–¹æ³•ã€‚ä¸‹é¢æ¥çœ‹ä¸‹æ–¹æ³•ä¸­æ‰§è¡Œçš„å†…å®¹ã€‚</p>
<pre><code class="language-java">

@Slf4j
public class RequestHeaderInterceptor extends HandlerInterceptorAdapter {


    final static Response&lt;Void&gt; ERROR_PARAMS = Response.fail(Code.System.ERROR_PARAMS);

    @Override
    public boolean preHandle(HttpServletRequest request, HttpServletResponse response, Object handler) {
        String appSystem = request.getHeader(&quot;appSystem&quot;);
        if (StringUtils.isBlank(appSystem)) {
            ERROR_PARAMS.setMsg(&quot;appSystem ä¸èƒ½ä¸ºç©º&quot;);
            responseJson(ERROR_PARAMS, response);
            return false;
        }
        String clientChannel = request.getHeader(&quot;clientChannel&quot;);
        if (StringUtils.isBlank(clientChannel)) {
            ERROR_PARAMS.setMsg(&quot;clientChannel ä¸èƒ½ä¸ºç©º&quot;);
            responseJson(ERROR_PARAMS, response);
            return false;
        }
        return true;
    }

    @Override
    public void postHandle(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView) {

    }

    @Override
    public void afterCompletion(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex) {

    }

    @Override
    public void afterConcurrentHandlingStarted(HttpServletRequest request, HttpServletResponse response, Object handler) {

    }

    private void responseJson(Object result, HttpServletResponse res) {
        try {
            if (result != null) {
                res.setHeader(&quot;Pragma&quot;, &quot;No-cache&quot;);
                res.setHeader(&quot;Cache-Control&quot;, &quot;no-cache&quot;);
                res.setDateHeader(&quot;Expires&quot;, 0);
                res.setContentType(&quot;text/json&quot;);
                res.setCharacterEncoding(&quot;UTF-8&quot;);
                PrintWriter out = res.getWriter();
                String json = &quot;&quot;;
                if (result instanceof String) {
                    json = (String) result;
                } else {
                    json = JsonUtils.obj2json(result);
                }
                out.write(json);
                out.flush();
            }
        } catch (Exception e) {
            log.error(&quot;&quot;, e);
        }
    }

}
</code></pre>
<p>å›¾1 çš„preHandleæ–¹æ³•ä¸­ä¼ å…¥äº†requestå‚æ•°ï¼Œå…¶ç±»å‹æ˜¯HttpServletRequestç±»å‹ï¼Œå¦å¤–è¿˜æœ‰responseå…¶ç±»å‹æ˜¯HttpServletResponseï¼Œæœ€åæ˜¯Objectç±»å‹çš„ handlerã€‚</p>
<p>é¦–å…ˆï¼Œä»requestä¸­ä¹Ÿå°±æ˜¯è¯·æ±‚ä¸­é€šè¿‡getParameterè·å–å‚æ•°ï¼Œè¿™é‡Œçš„å‚æ•°æ˜¯phoneNumberä¹Ÿå°±æ˜¯æ‰‹æœºå·ã€‚</p>
<p>ç„¶ååˆ¤æ–­æ‰‹æœºå·æ˜¯å¦ä¸ºç©ºï¼Œå†é€šè¿‡getHeaderæ–¹æ³•è·å–phoneNumberï¼Œçœ‹çœ‹åœ¨è¯·æ±‚å¤´ä¸­æ˜¯å¦å­˜åœ¨æ‰‹æœºå·ã€‚å¦‚æœä¹Ÿä¸å­˜åœ¨ï¼Œé‚£ä¹ˆæ‰“å°æ—¥å¿—è¯´æ˜è¯·æ±‚æ¥å£ä¸åŒ…å«æ‰‹æœºå·ã€‚</p>
<p>æ¥ä¸‹æ¥ï¼Œé€šè¿‡responseçš„getOutputStreamè·å–ç›¸åº”çš„response æµã€‚é€šè¿‡setHeaderæ–¹æ³•è®¾ç½®è¿”å›çš„ç±»å‹content-typeå’Œapplication/jsonã€‚å¦å¤–é€šè¿‡æŒ‡å®šJSONå­—ç¬¦ä¸²ä¸­çš„ç¼–ç æ ¼å¼UTF8ï¼Œå‘ŠçŸ¥ç›¸åº”çš„ç¼–ç æ¨¡å¼ã€‚</p>
<p>æœ€åé€šè¿‡ï¼ŒoutputStreamçš„writeæ–¹æ³•è¿”å›è¾“å‡ºçš„å­—èŠ‚æµï¼Œå¦‚æœåœ¨ç™»é™†çš„æ—¶å€™ä¸å­˜åœ¨æ‰‹æœºå·ä¿¡æ¯å°±ä¼šè¿”å›å¤±è´¥ï¼Œå¦åˆ™å¯ä»¥ç™»é™†ç»§ç»­åé¢çš„æ“ä½œã€‚</p>
<h4 id="é…ç½®spring-webxmlä¸­çš„æ‹¦æˆªå™¨">é…ç½®spring-web.xmlä¸­çš„æ‹¦æˆªå™¨</h4>
<p>çœ‹å®Œäº†ç™»é™†æ‹¦æˆªå™¨çš„ä»£ç éƒ¨åˆ†ï¼Œå†å›åˆ°spring-web.xmlé…ç½®æ–‡ä»¶ä¸­ï¼Œæ¥çœ‹çœ‹é…ç½®éƒ¨åˆ†ã€‚è¿™é‡Œä¼šåœ¨interceptorsåŠ å…¥ä¸€ä¸ªinterceptorsï¼ˆæ‹¦æˆªå™¨ï¼‰ã€‚å¦‚å›¾2æ‰€ç¤ºï¼Œè¿™ä¸ªæ‹¦æˆªå™¨åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p>
<p>Mappingï¼šè¿™é‡Œä¸»è¦æŒ‡å®šéœ€è¦æ‹¦æˆªçš„è·¯å¾„ï¼ŒåŒ…å«åœ¨è¯¥é…ç½®ä¸‹çš„è·¯å¾„ä¼šè¢«æ‹¦æˆªåˆ°ï¼Œå¦åˆ™æ‹¦æˆªå™¨æ˜¯ä¸ä¼šå¤„ç†çš„ã€‚è¿™é‡Œè®¾ç½®çš„æ˜¯â€œ/**â€ï¼Œæ„æ€æ˜¯å…¨éƒ¨è·¯å¾„éƒ½ä¼šæ‹¦æˆªã€‚</p>
<p>Exclude-mappingï¼šè¿™é‡Œé…ç½®é™¤äº†é‚£äº›è·¯å¾„æ˜¯ä¸åšæ‹¦æˆªçš„ã€‚ä¹Ÿæ˜¯ä¸Mappingé…ç½®ç›¸å‘¼åº”çš„ä¸€ä¸ªé…ç½®ï¼Œä¹Ÿå°±æ˜¯è¯´æ‹¦æˆªå™¨ä¹Ÿæœ‰ä¾‹å¤–ï¼Œåœ¨è¿™é‡Œé…ç½®çš„è·¯å¾„ä¸åšæ‹¦æˆªå¤„ç†ã€‚è¿™é‡Œé…ç½®äº†ä¸‰ä¸ªèŠ‚ç‚¹ï¼ŒåŒ…æ‹¬â€œ/consumer/loginâ€ã€â€/demo/**â€ã€â€/â€ã€‚</p>
<p>Beanï¼šè¿™é‡Œæ˜¯å¯¹æ‹¦æˆªå™¨è¿›è¡ŒæŒ‡å®šï¼Œä¹Ÿå°±æ˜¯è¯´ä¸Šé¢çš„è§„åˆ™é€šè¿‡å“ªä¸ªæ‹¦æˆªå™¨å®ç°ã€‚è¿™é‡Œæˆ‘ä»¬é…ç½®äº†â€œcom.ruyuan.little.project.spring.interceptor.LoginInterceptor&quot;ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬åˆšåˆšç¼–å†™çš„æ‹¦æˆªå™¨ã€‚</p>
<h3 id="ç²¾é€‰é¢è¯•é¢˜spring-aopçš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›">ç²¾é€‰é¢è¯•é¢˜ï¼šSpring AOPçš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ</h3>
<h4 id="ç­–ç•¥æ¨¡å¼åœ¨aopä¸­çš„ä½¿ç”¨">ç­–ç•¥æ¨¡å¼åœ¨AOPä¸­çš„ä½¿ç”¨</h4>
<p>ç­–ç•¥æ¨¡å¼ï¼Œå°†å„ç§ç®—æ³•å°è£…åˆ°å…·ä½“çš„ç±»ä¸­ï¼Œä½œä¸ºä¸€ä¸ªæŠ½è±¡ç­–ç•¥ç±»çš„å­ç±»ï¼Œä½¿å¾—ä»–ä»¬å¯ä»¥äº’æ¢ã€‚å®¢æˆ·ç«¯å¯ä»¥å†³å®šä½¿ç”¨é‚£ç§å“ªç§ç®—æ³•</p>
<p>ç­–ç•¥æ¨¡å¼è§’è‰²åˆ’åˆ†ä¸ºå¦‚ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š<br>
Strategyç­–ç•¥æ¥å£æˆ–è€…æŠ½è±¡ç­–ç•¥ç±»ï¼Œå®šä¹‰ç­–ç•¥æ‰§è¡Œæ¥å£<br>
ConcreteStrategy å…·ä½“ç­–ç•¥ç±»<br>
Context ä¸Šä¸‹æ–‡ç±»ï¼Œæ”¯æŒå…·æœ‰ç­–ç•¥ç±»çš„å®ä¾‹ï¼Œå¹¶ä¸”è´Ÿè´£è°ƒç”¨ç›¸å…³çš„ç®—æ³•</p>
<p>ç­–ç•¥æ¨¡å¼æä¾›äº†å¯¹&quot;&quot;å¼€é—­åŸåˆ™&quot;çš„å®Œç¾æ”¯æŒï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ç³»ç»Ÿçš„åŸºç¡€ä¸Šé€‰æ‹©ç®—æ³•ï¼ˆç­–ç•¥ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥çµæ´»çš„å¢åŠ æ–°çš„ç®—æ³•ï¼ˆç­–ç•¥ï¼‰</p>
<p>ç­–ç•¥æ¨¡å¼é€šè¿‡Contextç±»æä¾›äº†ç®¡ç†å…·ä½“ç­–ç•¥ç±»ï¼ˆç®—æ³•æ—ï¼‰çš„åŠæ³•ã€‚<br>
ç»“åˆç®€å•å·¥å‚æ¨¡å¼å’ŒAnnotationï¼Œç­–ç•¥æ¨¡å¼å¯ä»¥æ–¹ä¾¿çš„åœ¨ä¸ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç çš„å‰æä¸‹åˆ‡æ¢ç®—æ³•ï¼ˆç­–ç•¥ï¼‰ã€‚<br>
åœ¨SpringAopä¸­ç­–ç•¥æ¨¡å¼ä¹Ÿèµ·åˆ°äº†é‡è¦çš„ä½œç”¨ï¼Œè¿˜è®°å¾—SpringAOPçš„ä¸¤ç§åŠ¨æ€ä»£ç†çš„æœºåˆ¶å—ï¼ŸJDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†è¿™ä¸¤ç§ä»£ç†å°±æ˜¯ä¸¤ç§AOPçš„ä»£ç†çš„ç­–ç•¥ã€‚<br>
AOPä¸­å®šä¹‰äº†DefaultAOPProxyFactoryä»£ç†ç±»ï¼Œè¿™ä¸ªç±»åˆ†åˆ«å…³è”äº†ä¸¤ç§ä»£ç†ï¼šJdkDynamicAopProxyå’ŒCglibProxy<br>
Factoryã€‚</p>
<h4 id="ç­–ç•¥æ¨¡å¼åœ¨aopä¸­çš„ä½¿ç”¨-2">ç­–ç•¥æ¨¡å¼åœ¨AOPä¸­çš„ä½¿ç”¨</h4>
<p>ç­–ç•¥æ¨¡å¼ï¼ˆStrategy Patternï¼‰ï¼Œå°†å„ç§ç®—æ³•å°è£…åˆ°å…·ä½“çš„ç±»ä¸­ï¼Œä½œä¸ºä¸€ä¸ªæŠ½è±¡ç­–ç•¥ç±»çš„å­ç±»ï¼Œä½¿å¾—å®ƒä»¬å¯ä»¥äº’æ¢ã€‚å®¢æˆ·ç«¯å¯ä»¥è‡ªè¡Œå†³å®šä½¿ç”¨å“ªç§ç®—æ³•ã€‚</p>
<p>å¦‚å›¾1æ‰€ç¤ºï¼Œç­–ç•¥æ¨¡å¼è§’è‰²åˆ’åˆ†ä¸ºå¦‚ä¸‹ä¸‰ä¸ªéƒ¨åˆ†ï¼š</p>
<ul>
<li>
<p>Strategy ç­–ç•¥æ¥å£æˆ–è€…ï¼ˆæŠ½è±¡ç­–ç•¥ç±»ï¼‰ï¼Œå®šä¹‰ç­–ç•¥æ‰§è¡Œæ¥å£</p>
</li>
<li>
<p>ConcreteStrategy å…·ä½“ç­–ç•¥ç±»</p>
</li>
<li>
<p>Context ä¸Šä¸‹æ–‡ç±»ï¼ŒæŒæœ‰å…·ä½“ç­–ç•¥ç±»çš„å®ä¾‹ï¼Œå¹¶è´Ÿè´£è°ƒç”¨ç›¸å…³çš„ç®—æ³•</p>
</li>
</ul>
<p>ç­–ç•¥æ¨¡å¼æä¾›äº†å¯¹â€œå¼€é—­åŸåˆ™â€çš„å®Œç¾æ”¯æŒï¼Œç”¨æˆ·å¯ä»¥åœ¨ä¸ä¿®æ”¹åŸæœ‰ç³»ç»Ÿçš„åŸºç¡€ä¸Šé€‰æ‹©ç®—æ³•ï¼ˆç­–ç•¥ï¼‰ï¼Œå¹¶ä¸”å¯ä»¥çµæ´»åœ°å¢åŠ æ–°çš„ç®—æ³•ï¼ˆç­–ç•¥ï¼‰ã€‚</p>
<p>ç­–ç•¥æ¨¡å¼é€šè¿‡Contextç±»æä¾›äº†ç®¡ç†å…·ä½“ç­–ç•¥ç±»ï¼ˆç®—æ³•æ—ï¼‰çš„åŠæ³•ã€‚</p>
<p>ç»“åˆç®€å•å·¥å‚æ¨¡å¼å’ŒAnnotationï¼Œç­–ç•¥æ¨¡å¼å¯ä»¥æ–¹ä¾¿çš„åœ¨ä¸ä¿®æ”¹å®¢æˆ·ç«¯ä»£ç çš„å‰æä¸‹åˆ‡æ¢ç®—æ³•ï¼ˆç­–ç•¥ï¼‰ã€‚</p>
<p>åœ¨Spring AOP ä¸­ç­–ç•¥æ¨¡å¼ä¹Ÿèµ·åˆ°äº†é‡è¦çš„ä½œç”¨ï¼Œè¿˜æ¥çš„Spring AOP çš„ä¸¤ç§åŠ¨æ€ä»£ç†æœºåˆ¶å—ï¼ŸJDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†ï¼Œè¿™é‡Œä¸¤ç§ä»£ç†å°±æ˜¯ä¸¤ç§AOP ä»£ç†çš„ç­–ç•¥ã€‚</p>
<p>å¦‚å›¾2çäº‹ï¼ŒAOPä¸­å®šä¹‰äº†DefaultAopProxyFactoryçš„ä»£ç†ç±»ï¼Œè¿™ä¸ªç±»åˆ†åˆ«å…³è”äº†ä¸¤ç§ä»£ç†ï¼šJdkDynamicAopProxyï¼ˆJDKåŠ¨æ€ä»£ç†ï¼‰å’ŒCglibProxyFactoryï¼ˆCGLIBåŠ¨æ€ä»£ç†ï¼‰ã€‚</p>
<h4 id="æ¨¡æ¿æ¨¡å¼åœ¨aopä¸­çš„ä½¿ç”¨">æ¨¡æ¿æ¨¡å¼åœ¨AOPä¸­çš„ä½¿ç”¨</h4>
<p>æ¨¡æ¿æ¨¡å¼ï¼ˆTemplate Patternï¼‰ä¸­ï¼Œä¸€ä¸ªæŠ½è±¡ç±»å…¬å¼€å®šä¹‰äº†æ‰§è¡Œå®ƒçš„æ–¹æ³•çš„æ–¹å¼/æ¨¡æ¿ã€‚<br>
å®ƒçš„å­ç±»å¯ä»¥æŒ‰éœ€è¦é‡å†™æ–¹æ³•å®ç°ï¼Œä½†è°ƒç”¨å°†ä»¥æŠ½è±¡ç±»ä¸­å®šä¹‰çš„æ–¹å¼è¿›è¡Œã€‚è¿™ç§ç±»å‹çš„è®¾è®¡æ¨¡å¼å±äºè¡Œä¸ºå‹æ¨¡å¼ã€‚</p>
<p>å¦‚å›¾3æ‰€ç¤ºï¼Œæ¨¡ç‰ˆæ¨¡å¼åŒ…æ‹¬ä¸¤éƒ¨åˆ†å†…å®¹ï¼š</p>
<ul>
<li>
<p>æŠ½è±¡ç±»ï¼ˆAbstractClassï¼‰ï¼šå®ç°äº†æ¨¡æ¿æ–¹æ³•ï¼Œå®šä¹‰äº†ç®—æ³•çš„éª¨æ¶ã€‚</p>
</li>
<li>
<p>å…·ä½“ç±»ï¼ˆConcreteClass)ï¼šå®ç°æŠ½è±¡ç±»ä¸­çš„æŠ½è±¡æ–¹æ³•ï¼Œå·²å®Œæˆå®Œæ•´çš„ç®—æ³•ã€‚</p>
</li>
</ul>
<p>æ¨¡æ¿æ–¹æ³•æ¨¡æ¿é€šè¿‡æŠŠä¸å˜çš„è¡Œä¸ºæ¬ç§»åˆ°è¶…ç±»ï¼Œå»é™¤äº†å­ç±»ä¸­é‡å¤çš„ä»£ç ã€‚å­ç±»å®ç°ç®—æ³•çš„æŸäº›ç»†èŠ‚ï¼Œæœ‰åŠ©äºç®—æ³•çš„æ‰©å±•ã€‚é€šè¿‡<br>
ä¸€ä¸ªçˆ¶ç±»è°ƒç”¨å­ç±»å®ç°çš„æ“ä½œï¼Œé€šè¿‡å­ç±»æ‰©å±•å¢åŠ æ–°çš„åŸåˆ™ã€‚ç¬¦åˆâ€œå¼€æ”¾-å…³é—­åŸåˆ™â€ã€‚</p>
<p>å›åˆ°Spring AOPä¸­çš„ä»£ç†åˆ›å»ºçš„æ—¶å€™ç”¨åˆ°äº†AbstractAutoProxyCreatorï¼Œå¦‚å›¾4æ‰€ç¤ºï¼Œå®ƒä½äºå›¾çš„ä¸Šéƒ¨å®šä¹‰äº†ä¸€äº›é€šç”¨çš„è¡Œä¸ºï¼Œ<br>
ä¾‹å¦‚ï¼špostProcessBeforeInstantiationã€getAdvicesAndAdvisorsForBeanã€CreateProxyç­‰ï¼Œè¿™äº›è¡Œä¸ºæ˜¯æ‰€æœ‰ä»£ç†åˆ›å»ºè€…éƒ½éœ€è¦ä½¿ç”¨çš„ï¼Œå› æ­¤åœ¨çˆ¶ç±»ä¸­è¿›è¡Œç»Ÿä¸€å®šä¹‰ã€‚</p>
<p>AbstractAdvisorAutoProxyCreatorï¼Œæ˜¯æ ¹æ®å¢å¼ºå™¨è‡ªåŠ¨ä»£ç†çš„åˆ›å»ºè€…ï¼Œå®ƒåŠ å…¥é’ˆå¯¹å¢å¼ºå™¨ç‰¹æœ‰çš„æ–¹æ³•ã€‚<br>
å†å¾€ä¸‹æœ‰ä¸‰ä¸ªç±»éƒ½ç»§æ‰¿äº†AbstractAdvisorAutoProxyCreatorï¼Œåˆ†åˆ«æ˜¯DefaultAdvisorAutoProxyCreatorã€AspectJAwareAdvisorAutoProxyCreatorå’ŒInfrastructureAdvisorAutoProxyCreatorï¼Œå®ƒä»¬åˆæ ¹æ®è‡ªèº«å¤„ç†åœºæ™¯æ‰©å±•äº†çˆ¶ç±»çš„æ¨¡ç‰ˆæ–¹æ³•ã€‚</p>
<h4 id="é€‚é…å™¨æ¨¡å¼åœ¨aopä¸­çš„ä½¿ç”¨">é€‚é…å™¨æ¨¡å¼åœ¨AOPä¸­çš„ä½¿ç”¨</h4>
<p>é€‚é…å™¨æ¨¡å¼ï¼ˆAdapter Patternï¼‰ï¼Œå°†ä¸€ä¸ªç±»çš„æ¥å£è½¬æ¢æˆå®¢æˆ·å¸Œæœ›çš„å¦å¤–ä¸€ä¸ªæ¥å£ã€‚é€‚é…å™¨æ¨¡å¼ä½¿å¾—åŸæœ¬ç”±äºæ¥å£ä¸å…¼å®¹è€Œä¸èƒ½ä¸€èµ·å·¥ä½œçš„é‚£äº›ç±»å¯ä»¥ä¸€èµ·å·¥ä½œã€‚</p>
<p>å¦‚å›¾5æ‰€ç¤ºï¼Œé€‚é…å™¨æ¨¡å¼åŒ…æ‹¬å¦‚ä¸‹éƒ¨åˆ†ï¼š</p>
<ul>
<li>
<p>ç›®æ ‡æ¥å£ï¼Œ Target</p>
</li>
<li>
<p>å…·ä½“ç›®æ ‡å®ç°ï¼Œå¦‚ConcreteTarget</p>
</li>
<li>
<p>é€‚é…å™¨ï¼ŒAdapter</p>
</li>
<li>
<p>å¾…é€‚é…ç±»ï¼ŒAdaptee</p>
</li>
</ul>
<p>å›åˆ°Spring AOP å¦‚å›¾6çäº‹ï¼Œå…¶ä¸­Advisorä½¿ç”¨äº†AdvisorAdapteré€‚é…å™¨ï¼Œ<br>
è¯¥é€‚é…å™¨å…³è”å¦å¤–ä¸¤ä¸ªé€‚é…å™¨ï¼šThrowsAdviceAdapterå’ŒAfterReturningAdviceAdapterï¼Œè¿™ä¸¤ä¸ªé€‚é…ä¼šåˆ†åˆ«ä¾èµ–ThrowsAdviceInterceptorå’ŒAfterRuturningAdviceInterceptorã€‚<br>
ä¹Ÿå°±æ˜¯è¯´Advisorå¢å¼ºå™¨é€šè¿‡é€‚é…å™¨æ¨¡å¼ä½¿ç”¨äº†ä¸åŒæ¥å£çš„Interceptorä½¿ç”¨çš„æ‹¦æˆªå™¨ä¸­çš„åŠŸèƒ½ï¼Œé€šè¿‡é€‚é…å™¨æ¨¡å¼åšåˆ°äº†ä»£ç è§£è€¦å’Œå¤ç”¨ã€‚</p>
<h3 id="å…ˆæ¥çœ‹çœ‹åŸç”Ÿjdbcå¦‚ä½•è¿›è¡Œæ•°æ®åº“æ“ä½œ">å…ˆæ¥çœ‹çœ‹åŸç”ŸJDBCå¦‚ä½•è¿›è¡Œæ•°æ®åº“æ“ä½œ</h3>
<p>ä»‹ç»äº†æ—¥å¿—å’Œå¼‚å¸¸å¤„ç†çš„åŠŸèƒ½ï¼Œå®ƒä»¬éƒ½å±ç³»ç»Ÿçº§åˆ«çš„åŠŸèƒ½ã€‚æ•°æ®åº“è®¿é—®ä½œä¸ºå¦å¤–ä¸€ä¸ªç³»ç»Ÿçº§åˆ«çš„åŠŸèƒ½ä¼šåœ¨åé¢çš„å¼€å‘è¿‡ç¨‹ä¸­ç”¨åˆ°ï¼Œå› æ­¤è¿™å‘¨ä¼šç»™å¤§å®¶ä»‹ç»è¿™æ–¹é¢çš„å†…å®¹ã€‚æ•´ä½“è„‰ç»œä¼šæ ¹æ®JDBCã€è¿æ¥æ± ã€JDBCTemplateä»¥åŠMyBatiså‡ éƒ¨åˆ†å†…å®¹å±•å¼€ï¼Œæœ¬èŠ‚è¯¾ä¸»è¦ä»‹ç»JDBCè®¿é—®æ•°æ®åº“çš„åŠŸèƒ½ï¼Œä»Šå¤©çš„å†…å®¹ï¼š</p>
<ul>
<li>
<p>JDBC ç®€ä»‹</p>
</li>
<li>
<p>ä¸Šä¼ æœåŠ¡</p>
</li>
<li>
<p>å¯åŠ¨æœåŠ¡</p>
</li>
</ul>
<h4 id="jdbcç®€ä»‹">JDBCç®€ä»‹</h4>
<p>JDBCæ˜¯Java Database Connectivityçš„ç®€ç§°ï¼Œå¯ä»¥ç†è§£ä¸ºJavaæ•°æ®åº“è¿æ¥ï¼Œä¸ºJavaç¨‹åºå‘˜å¼€å‘è€…ä½¿ç”¨å’Œæ“ä½œæ•°æ®åº“æä¾›äº†ç»Ÿä¸€ç¼–ç¨‹æ¥å£APIï¼Œæœ‰ä¸€ç»„<br>
ä½¿ç”¨Javaè¯­è¨€ç¼–å†™çš„ç±»å’Œæ¥å£ç»„æˆã€‚</p>
<p>JDBCæ•´ä¸ªå·¥ä½œåŒ…æ‹¬å¦‚ä¸‹å…·ä½“æµç¨‹ï¼š</p>
<ul>
<li>
<p>åŠ è½½å’Œæ“ä½œæ•°æ®åº“é©±åŠ¨ç¨‹åºã€‚</p>
</li>
<li>
<p>è¿æ¥æ•°æ®åº“ï¼Œå»ºç«‹è¿æ¥</p>
</li>
<li>
<p>æ“ä½œæ•°æ®åº“ï¼šåˆ›å»ºæ•°æ®åº“å¯¹è±¡(ç”¨äºæ‰§è¡ŒSQLè¯­å¥)ã€‚è¿™é‡Œä¼šæ¶‰åŠåˆ°Statementå¯¹è±¡æˆ–è€…PrepareStatementå¯¹è±¡çš„åˆ›å»ºã€‚ä»¥åŠåŸºäºä¸¤è€…è¿›è¡Œçš„æ‰§è¡ŒSQLè¯­å¥å·¥ä½œï¼Œ<br>
ä»è€Œè·å¾—å¹¶å¤„ç†ç»“æ„ï¼Œè¿™ä¸ªç»“æœé€šå¸¸æ”¾åœ¨ResultSetå¯¹è±¡å¹¶ä¸”è¿”å›ã€‚</p>
</li>
<li>
<p>é‡Šæ”¾èµ„æºï¼šé‡Šæ”¾æ•°æ®åº“è¿æ¥èµ„æº</p>
</li>
</ul>
<h4 id="é…ç½®jdbcè®¿é—®æ•°æ®">é…ç½®JDBCè®¿é—®æ•°æ®</h4>
<p>å¯¹JDBCè¿›è¡Œç®€ä»‹ä»¥åï¼Œæ¥ä¸‹æ¥å°±å°è¯•å¦‚ä½•é…ç½®JDBCçš„ç»„ä»¶å’Œç¯å¢ƒã€‚<br>
ç”±äºJDBCçš„ç»„ä»¶åŒ…åŒ…å«åœ¨JDKä¸­å› æ­¤ä¸ç”¨é¢å¤–å¼•ç”¨ï¼Œé‚£ä¹ˆå…ˆæ¥çœ‹çœ‹å®ƒçš„é…ç½®æ–‡ä»¶ã€‚<br>
å¦‚å›¾1æ‰€ç¤ºï¼Œåœ¨jdbc.propertiesæ–‡ä»¶ä¸­é…ç½®JDBCçš„åŸºæœ¬ä¿¡æ¯ï¼Œè¿™é‡ŒåŒ…æ‹¬MySQLçš„é©±åŠ¨ã€æ•°æ®åº“è¿æ¥ä¸²ï¼ˆurlï¼‰ä»¥åŠè®¿é—®æ•°æ®åº“çš„ç”¨æˆ·åå’Œå¯†ç ã€‚</p>
<pre><code class="language-java">jdbc.driverClassName=com.mysql.cj.jdbc.Driver
jdbc.url =jdbc:mysql://
jdbc.username =root
jdbc.password =password
</code></pre>
<p>ç„¶ååˆ›å»ºä¸€ä¸ªJDBCçš„è®¿é—®ç±»ï¼Œå¦‚å›¾2æ‰€ç¤ºï¼Œåœ¨/spring/dao ç›®å½•ä¸‹é¢åˆ›å»ºJdbcBaseDaoçš„ç±»ï¼Œ<br>
è¯¥ç±»éœ€è¦å¯¹æ•°æ®åº“é©±åŠ¨ã€urlåœ°å€ã€ç”¨æˆ·åå’Œå¯†ç è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™ä¸ªåˆå§‹åŒ–çš„å·¥ä½œåç»­ä¼šé€šè¿‡Spring IOC å®Œæˆã€‚</p>
<p>åœ¨è¿™ä¸ªJdbcBaseDaoç±»æ–‡ä»¶ä¸­å®šä¹‰äº†queryListã€queryOneä»¥åŠupdateç­‰è®¿é—®æ•°æ®åº“çš„æ–¹æ³•ã€‚è¿™é‡Œæˆ‘ä»¬ä»¥queryListæ–¹æ³•ä¸ºä¾‹ç»™å¤§å®¶ä»‹ç»ã€‚</p>
<p>å¦‚å›¾3æ‰€ç¤ºï¼Œé¦–å…ˆé€šè¿‡DriverManagerä¸­çš„getConnectionæ–¹æ³•ä¼ å…¥urlã€ç”¨æˆ·åå’Œå¯†ç ç­‰ä¿¡æ¯åˆ›å»ºæ•°æ®åº“çš„è¿æ¥ã€‚ç„¶åè°ƒç”¨æ•°æ®åº“è¿æ¥çš„prepareStatementæ–¹æ³•ä¼ å…¥SQLè¯­å¥ç”¨æ¥å¤„ç†æŸ¥è¯¢æ“ä½œã€‚queryListæ–¹æ³•é€šè¿‡paramsæ¥å—äº†ä¸€ä¸ªå‚æ•°çš„æ•°ç»„ï¼Œåœ¨ä»£ç ä¸­ä¼šé€šè¿‡prepareStatementçš„setObjectæ–¹æ³•æ”¾å…¥å…¶ä¸­ã€‚</p>
<p>prepareStatementå°†SQLè¯­å¥ä»¥åŠå¯¹åº”çš„å‚æ•°åšäº†åˆ†ç¦»ï¼Œä»è€Œå®ç°åŠ¨æ€SQLæé«˜äº†è¿è¡Œæ•ˆç‡ã€‚æœ€åé€šè¿‡prepareStatementçš„executeQueryæ–¹æ³•ä»æ•°æ®åº“ä¸­è·å–æŸ¥è¯¢ç»“æœã€‚è¿™ä¸ªç»“æœè¿”å›ç»™äº†resultSetå˜é‡ï¼Œåé¢é€šè¿‡whileå¾ªç¯è¯»å‡ºresultSetå˜é‡ä¸­çš„ä¿¡æ¯ï¼Œæ”¾å…¥åˆ°List<T> resultä¸­å¹¶ä¸”è¿”å›ç»™è°ƒç”¨è€…ã€‚</p>
<p>ä¸Šé¢æè¿°äº†JDBCè®¿é—®æ•°æ®åº“çš„æ•´ä¸ªè¿‡ç¨‹ï¼Œè¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯PreparedStatementï¼Œå®ƒä¼šç»å¸¸åœ¨JDBCçš„ä»£ç ä¸­é‡åˆ°ï¼Œè¿™é‡Œæ€»ç»“ä¸€ä¸‹å®ƒçš„ä½œç”¨ï¼š</p>
<p>1ï¼‰PreparedStatement å®ä¾‹åŒ…å«å·²ç¼–è¯‘çš„ SQL è¯­å¥ã€‚è¿™å°±æ˜¯ä½¿è¯­å¥â€œå‡†å¤‡å¥½â€ã€‚åŒ…å«äº PreparedStatement å¯¹è±¡ä¸­çš„ SQL è¯­å¥å¯å…·æœ‰ä¸€ä¸ªæˆ–å¤šä¸ª IN å‚æ•°ã€‚INå‚æ•°çš„å€¼åœ¨ SQL è¯­å¥åˆ›å»ºæ—¶æœªè¢«æŒ‡å®šã€‚ç›¸åçš„ï¼Œè¯¥è¯­å¥ä¸ºæ¯ä¸ª IN å‚æ•°ä¿ç•™ä¸€ä¸ªé—®å·ï¼ˆâ€œï¼Ÿâ€ï¼‰ä½œä¸ºå ä½ç¬¦ã€‚æ¯ä¸ªé—®å·çš„å€¼å¿…é¡»åœ¨è¯¥è¯­å¥æ‰§è¡Œä¹‹å‰ï¼Œé€šè¿‡é€‚å½“çš„setXXX æ–¹æ³•æ¥æä¾›ã€‚</p>
<p>2ï¼‰ç”±äº PreparedStatement å¯¹è±¡å·²é¢„ç¼–è¯‘è¿‡ï¼Œæ‰€ä»¥å…¶æ‰§è¡Œé€Ÿåº¦è¦å¿«äº Statement å¯¹è±¡ã€‚å› æ­¤ï¼Œå¤šæ¬¡æ‰§è¡Œçš„ SQL è¯­å¥ç»å¸¸åˆ›å»ºä¸º PreparedStatement å¯¹è±¡ï¼Œä»¥æé«˜æ•ˆç‡ã€‚</p>
<p>æœ‰äº†JdbcBaseDaoä»¥åï¼Œå°±æœ‰äº†é€šè¿‡JDBCè®¿é—®æ•°æ®åº“çš„åŸºæœ¬ç±»ï¼Œä¸ºäº†æµ‹è¯•è®¿é—®æ•°æ®åº“çš„åŠŸèƒ½è¿˜éœ€è¦åˆ›å»ºä¸€ä¸ªControllerç±»ã€‚å¦‚å›¾4æ‰€ç¤ºï¼Œåœ¨/spring/controllerç›®å½•ä¸‹é¢åˆ›å»ºJdbcDemoControllerè¿›è¡Œæµ‹è¯•ï¼ŒåŠ å…¥GetAllæ–¹æ³•ç¼–å†™å¯¹åº”çš„SQLè¯­å¥ä»t_teacherè¡¨ä¸­è·å–æ•™å¸ˆçš„ä¿¡æ¯ï¼Œå¹¶ä¸”é€šè¿‡JdbcBaseDaoä¸­çš„queryListæ–¹æ³•è¿”å›ç»“æœã€‚</p>
<h4 id="jdbcçš„å¼Šç«¯">JDBCçš„å¼Šç«¯</h4>
<p>æ•°æ®åº“è¿æ¥ï¼Œä½¿ç”¨æ—¶å°±åˆ›å»ºï¼Œä¸ä½¿ç”¨ç«‹å³é‡Šæ”¾ï¼Œå¯¹æ•°æ®åº“è¿›è¡Œé¢‘ç¹è¿æ¥å¼€å¯å’Œå…³é—­ï¼Œé€ æˆæ•°æ®åº“èµ„æºæµªè´¹ï¼Œå½±å“æ•°æ®åº“æ€§èƒ½ã€‚<br>
å¦‚å›¾2æ‰€ç¤ºï¼Œå›åˆ°JdbcBaseDaoç±»ä¸­çš„queryListæ–¹æ³•ï¼Œåœ¨finallyä»£ç æ®µä¸­é¡»è¦å®šä¹‰å¯¹resultSetçš„å…³é—­åŠ¨ä½œï¼ŒåŒæ—¶è¿˜è¦å¯¹prepareStatementå’Œconnï¼ˆæ•°æ®åº“è¿æ¥ï¼‰è¿›è¡Œå…³é—­æ“ä½œï¼Œç¡®å®æ˜¯ä¸€ç³»åˆ—è´¹äº‹ä¸”å½±å“æ•°æ®åº“æ€§èƒ½çš„æ“ä½œã€‚<br>
åç»­æˆ‘ä»¬å¯ä»¥é€šè¿‡æ•°æ®åº“è¿æ¥æ± åŠŸèƒ½æå‡è¿™éƒ¨åˆ†çš„ä½¿ç”¨ä½“éªŒã€‚</p>
<p>é™¤äº†æ•°æ®åº“è¿æ¥çš„é—®é¢˜ï¼ŒJDBCä¸­éœ€è¦å°†SQLè¯­å¥ç¡¬ç¼–ç åˆ°javaä»£ç ä¸­ï¼Œå¦‚æœSQLè¯­å¥ä¿®æ”¹ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘javaä»£ç ã€‚åŒæ—¶å‘PreparedStatementä¸­è®¾ç½®å‚æ•°ï¼Œå¯¹å ä½ç¬¦å·ä½ç½®å’Œè®¾ç½®å‚æ•°å€¼ï¼Œç¡¬ç¼–ç åœ¨javaä»£ç ä¸­ï¼Œä¸åˆ©äºç³»ç»Ÿç»´æŠ¤ã€‚å¦‚æœèƒ½å¤Ÿå°†SQLè¯­å¥é…ç½®åœ¨xmlé…ç½®æ–‡ä»¶ä¸­ï¼Œå³ä½¿SQLå˜åŒ–ï¼Œä¸éœ€è¦å¯¹javaä»£ç è¿›è¡Œé‡æ–°ç¼–è¯‘ã€‚åé¢çš„Mybatisä¼˜åŒ–ä¼šæåˆ°è¿™ç‚¹ã€‚</p>
<p>å¦å¤–ï¼Œä»resultSetä¸­éå†ç»“æœé›†æ•°æ®æ—¶ï¼Œå°†è·å–è¡¨çš„å­—æ®µè¿›è¡Œç¡¬ç¼–ç ï¼Œä½¿ç”¨å¦‚æ­¤å†—ä½™çš„æ“ä½œå¢åŠ äº†ä»£ç ç»´æŠ¤çš„éš¾åº¦ã€‚ä¹Ÿå¯ä»¥é€šè¿‡JDBCTemplateå’ŒMybatisçš„ä¼˜åŒ–è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p>
<h4 id="åŸºäºdruidè¿æ¥æ± è¿›è¡Œæ•°æ®æ“ä½œæå‡ç³»ç»Ÿæ€§èƒ½">åŸºäºDruidè¿æ¥æ± è¿›è¡Œæ•°æ®æ“ä½œï¼Œæå‡ç³»ç»Ÿæ€§èƒ½</h4>
<p>åœ¨ä»‹ç»JDBCè®¿é—®æ•°æ®åº“æ—¶ï¼Œæåˆ°äº†éœ€è¦åœ¨è®¿é—®æ•°æ®åº“æ—¶å»ºç«‹ä¸æ•°æ®åº“çš„è¿æ¥ï¼Œåœ¨å½“ä½¿ç”¨å®Œæ•°æ®åº“è¿æ¥çš„æ—¶å€™éœ€è¦åšé‡Šæ”¾è¿æ¥çš„æ“ä½œã€‚<br>
ç”±äºï¼Œå»ºç«‹è¿æ¥å’Œé‡Šæ”¾è¿æ¥éœ€è¦è€—è´¹å¤§é‡çš„ç³»ç»Ÿèµ„æºï¼Œå¯¹äºè®¿é—®æ•°æ®åº“è¿™ä¸ªç»å¸¸ä½¿ç”¨çš„åŠŸèƒ½è€Œè¨€æ˜¯éœ€è¦è¿›è¡Œä¼˜åŒ–çš„ã€‚</p>
<p>å› æ­¤è¿™é‡Œéœ€è¦å¼•å…¥æ•°æ®åº“è¿æ¥æ± çš„æ¦‚å¿µï¼Œæ•°æ®åº“è¿æ¥æ± çš„åŸºæœ¬æ€æƒ³å°±æ˜¯ä¸ºæ•°æ®åº“å»ºç«‹ä¸€ä¸ªç¼“å†²æ± ï¼Œé¢„å…ˆåœ¨ç¼“å†²æ± ä¸­æ”¾å…¥ä¸€å®šæ•°é‡çš„è¿æ¥ï¼Œ<br>
å½“éœ€è¦å»ºç«‹æ•°æ®åº“è¿æ¥æ—¶ï¼Œåªéœ€è¦ä»ç¼“å†²æ± ä¸­å–å‡ºä¸€ä¸ªï¼Œä½¿ç”¨å®Œæ¯•ä¹‹ååœ¨æ”¾å›å»ã€‚æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾å®šè¿æ¥æ± è¿æ¥æ•°æ¥é˜²æ­¢ç³»ç»Ÿæ— å°½çš„ä¸æ•°æ®åº“è¿æ¥ã€‚<br>
æ›´ä¸ºé‡è¦çš„æ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡è¿æ¥æ± çš„ç®¡ç†æœºåˆ¶ç›‘è§†æ•°æ®åº“çš„è¿æ¥çš„æ•°é‡ï¹‘ä½¿ç”¨æƒ…å†µï¼Œä¸ºç³»ç»Ÿå¼€å‘ï¹‘æµ‹è¯•åŠæ€§èƒ½è°ƒæ•´æä¾›ä¾æ®ã€‚</p>
<p>Druidæ˜¯Javaè¯­è¨€ä¸­æœ€å¥½çš„æ•°æ®åº“è¿æ¥æ± ï¼Œåœ¨åŠŸèƒ½ã€æ€§èƒ½ã€æ‰©å±•æ€§æ–¹é¢ï¼Œéƒ½è¶…è¿‡å…¶ä»–æ•°æ®åº“è¿æ¥æ± ï¼ŒåŒ…æ‹¬DBCPã€C3P0ã€Proxoolã€JBoss DataSourceã€‚Druidå·²ç»åœ¨é˜¿é‡Œå·´å·´éƒ¨ç½²äº†è¶…è¿‡600ä¸ªåº”ç”¨ï¼Œç»è¿‡ç”Ÿäº§ç¯å¢ƒå¤§è§„æ¨¡éƒ¨ç½²çš„ä¸¥è‹›è€ƒéªŒã€‚</p>
<p>Druidè¿æ¥æ± ä¸ºç›‘æ§è€Œç”Ÿï¼Œå†…ç½®å¼ºå¤§çš„ç›‘æ§åŠŸèƒ½ï¼Œç›‘æ§ç‰¹æ€§ä¸å½±å“æ•´ä½“æ€§èƒ½ã€‚<br>
åŠŸèƒ½å¼ºå¤§ï¼Œèƒ½é˜²SQLæ³¨å…¥ï¼Œå†…ç½®Logingèƒ½è¯Šæ–­Hackåº”ç”¨è¡Œä¸ºã€‚åŒæ—¶Druidæ”¯æŒæ‰€æœ‰JDBCå…¼å®¹çš„æ•°æ®åº“ï¼ŒåŒ…æ‹¬Oracleã€MySqlã€Derbyã€Postgresqlã€SQL Serverã€H2ç­‰ç­‰ã€‚<br>
Druidé’ˆå¯¹Oracleå’ŒMySqlåšäº†ç‰¹åˆ«ä¼˜åŒ–ï¼Œæ¯”å¦‚Oracleçš„PS Cacheå†…å­˜å ç”¨ä¼˜åŒ–ï¼ŒMySqlçš„pingæ£€æµ‹ä¼˜åŒ–ã€‚</p>
<p>ä»‹ç»å®Œäº†Druidè¿æ¥æ± ï¼Œå›åˆ°é¡¹ç›®çš„ä»£ç ä¸­ï¼Œå¦‚å›¾1æ‰€ç¤ºè¦ä½¿ç”¨Druidé¦–å…ˆéœ€è¦åœ¨pom.xmlä¸­é…ç½®druidçš„ä¾èµ–ä¿¡æ¯ã€‚</p>
<pre><code class="language-java">
&lt;dependency&gt;
    &lt;groupId&gt;com.alibaba&lt;/groupId&gt;
    &lt;artifactId&gt;druid&lt;/artifactId&gt;
    &lt;version&gt;1.1.12&lt;/version&gt;
    &lt;type&gt;pom&lt;/type&gt;
&lt;/dependency&gt;

</code></pre>
<h4 id="druidè¿æ¥æ± è¿˜å­˜åœ¨å“ªäº›é—®é¢˜">Druidè¿æ¥æ± è¿˜å­˜åœ¨å“ªäº›é—®é¢˜</h4>
<p>Druidè¿æ¥æ± çš„ä»£ç ï¼Œé™¤äº†é€šè¿‡æ•°æ®åº“è¿æ¥æ± çš„æ–¹å¼è§£å†³è¿æ¥æ•°æ®åº“æ–­å¼€æ•°æ®çš„èµ„æºä½¿ç”¨é—®é¢˜ã€‚</p>
<p>é€šè¿‡æ•°æ®åº“è¿æ¥æ± çš„æ–¹å¼ï¼Œå°½é‡è®©æ•°æ®çš„è®¿é—®å…ˆä»è¿æ¥æ± ä¸­è·è¿æ¥ï¼Œå¦‚æœè¿æ¥æ± ä¸­æ²¡æœ‰è¿æ¥çš„æ—¶å€™ï¼Œå†åˆ›å»ºæ–°çš„è¿æ¥ã€‚</p>
<p>ä½†æ˜¯ï¼Œé’ˆå¯¹è¿æ¥æ•°æ®åº“ã€å…³é—­æ•°æ®åº“ã€ä½¿ç”¨PrepareStatementé¢„ç¼–è¯‘SQLè¯­å¥ï¼Œä»¥åŠResultSetæ‰¿è½½éœ€è¦è¿”å›çš„æ•°æ®åº“ä¿¡æ¯éƒ½æ²¡æœ‰è¿›è¡Œä¼˜åŒ–ã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œä½œä¸ºå¼€å‘è€…è¿˜æ˜¯éœ€è¦é‡å¤ä½¿ç”¨è¿™äº›ä»£ç å»è®¿é—®æ•°æ®åº“ã€‚</p>
<p>ä¸‹ä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦å‡å°‘ä¸Šè¿°è¿™äº›å†—ä½™ä»£ç çš„ç¼–å†™ï¼Œå°½é‡ç”¨æ›´åŠ ç®€åŒ–çš„æ–¹å¼è®¿é—®æ•°æ®åº“ï¼Œå‡å°‘æ•°æ®åº“æŸ¥è¯¢/ç¼–è¾‘ç¼“è§£çš„ä»£ç å¼•å…¥ï¼Œä»¥åŠæ•°æ®é›†è¿”å›æ—¶ä½¿ç”¨çš„é¢å¤–å¯¹è±¡ã€‚</p>
<p>ä¹Ÿå°±æ˜¯æˆ‘ä»¬ä¸‹èŠ‚è¯¾è¦ä»‹ç»çš„JDBCTemplateã€‚</p>
<h4 id="åŸºäºjdbctemplate-æ¨¡æ¿æ–¹å¼æ“ä½œæ•°æ®åº“è§£å†³ä»£ç é‡å¤é—®é¢˜">åŸºäºJDBCTemplate æ¨¡æ¿æ–¹å¼æ“ä½œæ•°æ®åº“ï¼Œè§£å†³ä»£ç é‡å¤é—®é¢˜</h4>
<p>JDBCTemplateç®€ä»‹<br>
JDBCTemplateæ˜¯Spring JDBCæŠ½è±¡æ¡†æ¶æä¾›çš„JDBCæ¨¡æ¿ç±»ï¼Œå…¶ä¸­JDBCTemplateæ˜¯coreåŒ…çš„æ ¸å¿ƒç±»ï¼Œå…¶ä»–æ¨¡æ¿ç±»éƒ½æ˜¯åŸºäºå®ƒå°è£…å®Œæˆçš„ã€‚</p>
<p>JDBCTemplateç±»é€šè¿‡æ¨¡æ¿è®¾è®¡æ¨¡å¼å¸®åŠ©æ¶ˆé™¤äº†å†—é•¿çš„ä»£ç ï¼Œ</p>
<p>åªåšéœ€è¦çš„äº‹ï¼šSQLè¯­å¥çš„ç¼–å†™ï¼Œå¹¶ä¸”å¸®æˆ‘ä»¬åšå›ºå®šçš„äº‹ï¼šæ•°æ®åº“è¿æ¥çš„åˆ›å»ºåŠå…³é—­</p>
<p>å¦‚å›¾æ‰€ç¤ºï¼Œåœ¨pom.xmlæ–‡ä»¶ä¸­åŠ å…¥ä¾èµ–å°±å¯ä»¥åœ¨é¡¹ç›®ä¸­ä½¿ç”¨JDBCTemplateäº†.</p>
<pre><code class="language-java">
&lt;dependency&gt;
    &lt;groupId&gt;.org.springframework&lt;/groupId&gt;
    &lt;artifactId&gt;spring-jdbc&lt;/artifactId&gt;
    &lt;version&gt;4.3.8.RELEASE&lt;/version&gt;
    &lt;type&gt;pom&lt;/type&gt;
&lt;/dependency

</code></pre>
<p>åœ¨å®é™…å·¥ä½œä¸­ï¼ŒJDBCTemplateä¸»è¦æä¾›ä»¥ä¸‹äº”ç±»æ–¹æ³•è®¿é—®æ•°æ®åº“ï¼š</p>
<ul>
<li>
<p>executeæ–¹æ³•ï¼šå¯ä»¥ç”¨äºæ‰§è¡Œä»»ä½•SQLè¯­å¥ï¼Œä¸€èˆ¬ç”¨äºæ‰§è¡ŒDDLè¯­å¥ï¼›</p>
</li>
<li>
<p>updateæ–¹æ³•ï¼šç”¨äºæ‰§è¡Œæ–°å¢ã€ä¿®æ”¹ã€åˆ é™¤ç­‰è¯­å¥ï¼›</p>
</li>
<li>
<p>batchUpdateï¼šæ–¹æ³•ç”¨äºæ‰§è¡Œæ‰¹å¤„ç†çš„updateè¯­å¥ï¼›</p>
</li>
<li>
<p>queryæ–¹æ³•ï¼šç”¨äºæ‰§è¡ŒæŸ¥è¯¢ç›¸å…³è¯­å¥ï¼›</p>
</li>
<li>
<p>callæ–¹æ³•ï¼šç”¨äºæ‰§è¡Œå­˜å‚¨è¿‡ç¨‹ã€å‡½æ•°ç›¸å…³è¯­å¥ã€‚</p>
</li>
</ul>
<p>springä¸‹é¢é€šè¿‡ä¿®æ”¹é¡¹ç›®ä»£ç å¼•å…¥JDBCTemplateï¼Œçœ‹çœ‹æˆ‘ä»¬æ˜¯å¦‚ä½•ä½¿ç”¨å®ƒçš„</p>
<h4 id="æ€è€ƒä¸€ä¸‹jdbctemplateæ“ä½œæ•°æ®åº“å­˜åœ¨çš„é—®é¢˜">æ€è€ƒä¸€ä¸‹JDBCTemplateæ“ä½œæ•°æ®åº“å­˜åœ¨çš„é—®é¢˜</h4>
<p>é€šè¿‡JDBCã€è¿æ¥æ± ã€JDBCTemplateå‡ ä¸ªé˜¶æ®µçš„æ”¹é€ ä»¥åï¼Œæˆ‘ä»¬é€æ¸è§£å†³äº†æ•°æ®åº“è¿æ¥æ•ˆç‡é—®é¢˜ï¼ˆè¿æ¥æ± ï¼‰ï¼Œæ‰‹åŠ¨æ‰“å¼€å…³é—­æ•°æ®åº“è¿æ¥ï¼ˆJDBCTemplateï¼‰ã€‚</p>
<p>ä½†æ˜¯ä½œä¸ºJDBCTemplateè¿˜æ˜¯éœ€è¦å°†SQLè¯­å¥ç¡¬ç¼–ç åˆ°javaä»£ç ä¸­ï¼Œå¦‚æœSQLè¯­å¥ä¿®æ”¹ï¼Œéœ€è¦é‡æ–°ç¼–è¯‘javaä»£ç ã€‚</p>
<p>è€Œä¸”ä¾æ—§éœ€è¦è¾“å…¥SQLè¯­å¥ä»¥åŠå¯¹åº”çš„Paramsä½œä¸ºå‚æ•°ã€‚</p>
<p>å¦‚æœèƒ½å¤Ÿå°†æ•°æ®åº“å¯¹åº”çš„å®ä½“ç±»ä¸æŸ¥è¯¢è¯­å¥å¯¹åº”ã€‚</p>
<p>åŒæ—¶é’ˆå¯¹ä½¿ç”¨æœ€é¢‘ç¹çš„æŸ¥è¯¢è¯­å¥è€Œè¨€ï¼Œå¦‚æœé’ˆå¯¹ä¸åŒçš„æ¡ä»¶åŒ¹é…ä¸åŒçš„å‚æ•°å°±æ›´å¥½äº†ã€‚</p>
<p>å› æ­¤æˆ‘ä»¬éœ€è¦ä¸€ä¸ªæ›´åŠ å¼ºå¤§çš„æ•°æ®åº“æŒä¹…å±‚ï¼ŒåŒæ—¶å…·å¤‡æ›´åŠ çµæ´»çš„SQLæŸ¥è¯¢æ–¹å¼ï¼Œä¸ä»…èƒ½å¤Ÿæ ¹æ®ä¸åŒçš„æ•°æ®åº“å¹³å°è°ƒæ•´SQLçš„è¯­æ³•ï¼Œä¹Ÿå¯ä»¥æ ¹æ®ä¸šåŠ¡çš„è°ƒæ•´æ‰‹åŠ¨è°ƒæ•´SQLå†…å®¹ï¼Œè€Œä¸ç”¨é‡æ–°ç¼–è¯‘ç¨‹åºã€‚</p>
<p>ä¸ºäº†é¿å…JDBCTemplateçš„è¿™äº›é—®é¢˜ï¼Œæˆ‘ä»¬å¼•å‡ºMybatisçš„æ•°æ®åº“è®¿é—®æ–¹å¼ã€‚</p>
<p>MyBatis æ˜¯æ”¯æŒ SQLæŸ¥è¯¢ï¼Œå­˜å‚¨è¿‡ç¨‹å’Œé«˜çº§æ˜ å°„çš„ä¼˜ç§€æŒä¹…å±‚æ¡†æ¶ã€‚</p>
<p>MyBatis æ¶ˆé™¤äº†å‡ ä¹æ‰€æœ‰çš„JDBCä»£ç å’Œå‚æ•°çš„æ‰‹å·¥è®¾ç½®ä»¥åŠç»“æœé›†çš„æ£€ç´¢ã€‚</p>
<p>MyBatis ä½¿ç”¨ç®€å•çš„ XMLæˆ–æ³¨è§£ç”¨äºé…ç½®å’ŒåŸå§‹æ˜ å°„ï¼Œå°†æ¥å£å’Œ Java çš„POJOsï¼ˆPlain Ordinary Java Objectsï¼Œæ™®é€šçš„ Javaå¯¹è±¡ï¼‰æ˜ å°„æˆæ•°æ®åº“ä¸­çš„è®°å½•ã€‚</p>
<h4 id="mybatisè¿è¡ŒåŸç†ä»‹ç»">Mybatisè¿è¡ŒåŸç†ä»‹ç»</h4>
<figure data-type="image" tabindex="11"><img src="images/mybaits%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86.png" alt="Mybatisè¿è¡ŒåŸç†ä»‹ç»" loading="lazy"></figure>
<h3 id="springeventäº‹ä»¶é€šçŸ¥æœºåˆ¶åº•å±‚åŸç†">SpringEventäº‹ä»¶é€šçŸ¥æœºåˆ¶åº•å±‚åŸç†</h3>
<h4 id="springeventç®€å•ä½¿ç”¨">SpringEventç®€å•ä½¿ç”¨</h4>
<p>å¦‚å›¾1 æ‰€ç¤ºï¼Œé¦–å…ˆæ³¨å…¥ApplicationEventPublisherå¯¹è±¡ï¼Œ<br>
sendEventæ–¹æ³•ä¸­å¯ä»¥é€šè¿‡ApplicationEventPublisherçš„publishEventæ–¹æ³•å°†åˆ›å»ºçš„EventDTOå‘é€å‡ºå»ï¼Œ<br>
é€šå¸¸è€Œè¨€åœ¨è¿™ä¹‹å‰å¯ä»¥ç¼–å†™ä¸€äº›ä¸šåŠ¡é€»è¾‘ï¼Œç„¶åæŠŠä¸šåŠ¡é€»è¾‘çš„ç›¸å…³ä¿¡æ¯å°è£…åˆ°EventDTOå‘é€å‡ºå»ï¼Œä»è€Œè¾¾åˆ°é€šçŸ¥å…¶ä»–ç»„ä»¶æˆ–è€…æ¨¡å—çš„ç›®çš„ã€‚<br>
æ¥ç€ï¼ŒEventListenerä¼šç›‘å¬å‘é€çš„æ¶ˆæ¯ï¼Œé€šè¿‡æ³¨å†ŒlistenEventæ–¹æ³•è·å–ä»¥åä¼šå¤„ç†æ¥æ”¶åˆ°çš„EventDTOå¯¹è±¡ï¼Œå¹¶ä¸”å¯¹å…¶è¿›è¡Œå¤„ç†ã€‚</p>
<pre><code class="language-java">
@Resource
ApplicationEventPublisher applicationEventPublisher;

//å‘é€äº‹ä»¶

public void sendEvent(){

    EventDto eventDto = new EventDto();
    
    applicationEventPublisher.pulishEvent(eventDto);
}



//ç›‘å¬äº‹ä»¶
@EventListener
public void listenEvent(EventDto eventDto){
    System.out.println();
}

</code></pre>
<h4 id="spring-event-æµç¨‹åˆ†æ">Spring Event æµç¨‹åˆ†æ</h4>
<p>çœ‹å®ŒSpring Eventç®€å•ä½¿ç”¨ä¹‹åï¼Œ<br>
å¯ä»¥å¾—çŸ¥Spring Event ç”±æ¶ˆæ¯å‘é€è€…ApplicationEventPublisherï¼Œ<br>
æ¶ˆæ¯å‘é€ä½“EventDTOä»¥åŠæ¶ˆæ¯æ¥æ”¶è€…EventListenerç»„æˆçš„.</p>
<p>å°†Spring Eventçš„æ‰§è¡Œæµç¨‹è¿›è¡Œåˆ†æï¼Œè¯¥å›¾ä»ä¸Šå¾€ä¸‹çœ‹ã€‚</p>
<ul>
<li>é¦–å…ˆæ˜¯ApplicationEventPublisherå‘å¸ƒeventã€‚</li>
<li>å‘å¸ƒæ¶ˆæ¯çš„åŠ¨ä½œä¼šè°ƒç”¨Multicasterä¸­çš„multicastEventæ–¹æ³•ã€‚</li>
<li>ç„¶åæ£€æŸ¥æ˜¯å¦æœ‰ç›‘å¬å™¨ç›‘å¬è¯¥æ¶ˆæ¯ï¼Œå¦‚æœæ²¡æœ‰ç›‘å¬æ•´ä¸ªæµç¨‹ç»“æŸï¼Œå¦åˆ™è¿›å…¥åˆ°ä¸‹ä¸€æ­¥ã€‚</li>
<li>æ¥ç€åˆ¤æ–­Multicasteræ˜¯å¦æœ‰çº¿ç¨‹æ± ï¼Œå¦‚æœæ²¡æœ‰ä¸»çº¿ç¨‹ç›´æ¥è°ƒç”¨ã€‚</li>
<li>å¦‚æœMulticasteræœ‰çº¿ç¨‹æ± ï¼Œé‚£ä¹ˆå¤šçº¿ç¨‹è°ƒç”¨ã€‚</li>
<li>æœ€åæ‰§è¡Œå¯¹åº”çš„æ–¹æ³•ï¼Œå®ŒæˆSpring Eventçš„è°ƒç”¨ã€‚</li>
</ul>
<figure data-type="image" tabindex="12"><img src="images/springevent%E6%B5%81%E7%A8%8B.png" alt="springeventæµç¨‹" loading="lazy"></figure>
<h4 id="springeventæºç åˆ†æ">SpringEventæºç åˆ†æ</h4>
<p>Multicasterå¹¿æ’­å™¨ä¸»è¦è´Ÿè´£å‘é€äº‹ä»¶åˆ°å„ä¸ªè®¢é˜…çš„Listeneræ–¹æ³•ä¸­ï¼Œæ•´ä¸ªæµç¨‹çš„æ ¸å¿ƒèŠ‚ç‚¹ã€‚<br>
åœ¨åˆ†ææ•´ä¸ªEventä¹‹å‰éœ€è¦å¯¹åœ¨Springå¯åŠ¨æ—¶ï¼Œå¦‚ä½•æ³¨å…¥å¹¿æ’­å™¨ç­‰ç­‰å·¥ä½œåšä¸€ä¸ªç®€å•åˆ†æã€‚<br>
Springçš„å¯åŠ¨æ³¨å…¥æµç¨‹å¦‚å›¾3 ä»£ç æ‰€ç¤ºå¦‚ä¸‹ï¼Œæˆ‘ä»¬å°†ç‰¹åˆ«æ³¨æ„çš„å‡½æ•°ç”¨çº¢è‰²æ¡†ä½“æ ‡æ³¨å¤„ç†ï¼Œåœ¨åé¢è¿›è¡Œè®²è§£ã€‚</p>
<pre><code class="language-java">	@Override
	public void refresh() throws BeansException, IllegalStateException {
		synchronized (this.startupShutdownMonitor) {
			// Prepare this context for refreshing.
			prepareRefresh();

			// Tell the subclass to refresh the internal bean factory.
			ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();

			// Prepare the bean factory for use in this context.
			prepareBeanFactory(beanFactory);

			try {
				// Allows post-processing of the bean factory in context subclasses.
				postProcessBeanFactory(beanFactory);

				// Invoke factory processors registered as beans in the context.
				invokeBeanFactoryPostProcessors(beanFactory);

				// Register bean processors that intercept bean creation.
				registerBeanPostProcessors(beanFactory);

				// Initialize message source for this context.
				initMessageSource();

				// Initialize event multicaster for this context.
				initApplicationEventMulticaster();

				// Initialize other special beans in specific context subclasses.
				onRefresh();

				// Check for listener beans and register them.
				registerListeners();

				// Instantiate all remaining (non-lazy-init) singletons.
				finishBeanFactoryInitialization(beanFactory);

				// Last step: publish corresponding event.
				finishRefresh();
			}

			catch (BeansException ex) {
				if (logger.isWarnEnabled()) {
					logger.warn(&quot;Exception encountered during context initialization - &quot; +
							&quot;cancelling refresh attempt: &quot; + ex);
				}

				// Destroy already created singletons to avoid dangling resources.
				destroyBeans();

				// Reset 'active' flag.
				cancelRefresh(ex);

				// Propagate exception to caller.
				throw ex;
			}

			finally {
				// Reset common introspection caches in Spring's core, since we
				// might not ever need metadata for singleton beans anymore...
				resetCommonCaches();
			}
		}
	}
</code></pre>
<ul>
<li>initApplicationEventMulticasteræ–¹æ³•ï¼šä¸»è¦å¯¹ä¸Šä¸‹æ–‡ä¸­çš„å¯¹æ³¨å†Œäº‹ä»¶çš„å¹¿æ’­å™¨è¿›è¡Œåˆå§‹åŒ–ã€‚</li>
<li>registerListeners()æ–¹æ³•ï¼šæ£€æŸ¥æ¶ˆæ¯ç›‘å¬å™¨å¹¶ä¸”æ³¨å†Œè¿™äº›ç›‘å¬å™¨ã€‚</li>
<li>finishBeanFactoryInitialization(beanFactory)ï¼šåˆå§‹åŒ–å«æœ‰@EventListeneræ³¨è§£çš„BeanåŒ…è£…åˆ°ApplicationListenerä¸­ï¼Œç„¶åå°†å®ƒä»¬æ³¨å…¥åˆ°Spring IOCå®¹å™¨ã€‚è¿™é‡Œåˆå§‹åŒ–çš„BeanæŒ‡çš„æ˜¯æ‰€æœ‰çš„éæ‡’åŠ è½½çš„Bean</li>
</ul>
<p>ä¸‹é¢å°±å¯¹è¿™ä¸‰ä¸ªæ–¹æ³•çš„æºä»£ç è¿›è¡Œè§£è¯»ã€‚</p>
<p>initApplicationEventMulticaster æ–¹æ³•ä¸­é‡è¦ä»£ç <br>
å¦‚å›¾4æ‰€ç¤ºï¼Œåˆ›å»ºä¸€ä¸ªç®€å•å¹¿æ’­å™¨ï¼Œä¼ å…¥beanFactoryä¸»è¦ç”¨äºåæœŸè·å–BeanFactoryä¸­çš„Listenerï¼Œç„¶åå°†å¹¿æ’­å™¨å•ä¾‹beanæ³¨å…¥åˆ°Spring IOCå®¹å™¨ä¸­</p>
<pre><code class="language-java">
//åˆ›å»ºä¸€ä¸ªç®€å•å¹¿æ’­,ä¼ å…¥beanFactoryä¸»è¦ç”¨äºåæœŸè·å–BeanFactoryä¸­çš„listener
	this.applicationEventMulticaster = new SimpleApplicationEventMulticaster(beanFactory);
			beanFactory.registerSingleton(APPLICATION_EVENT_MULTICASTER_BEAN_NAME, this.applicationEventMulticaster);
</code></pre>
<p>registerListeners æ˜¯ç”¨æ¥æ£€æŸ¥å’Œæ³¨å†Œç›‘å¬å™¨çš„ï¼Œ<br>
å¦‚å›¾5æ‰€ç¤ºï¼Œæ­¤æ–¹æ³•ä¸»è¦å°†å®¹å™¨ä¸­æ‰€æœ‰å£°æ˜çš„ApplicationListenerçš„Beanå¯¹è±¡åŠ è½½åˆ°å¹¿æ’­å™¨ä¸­ï¼Œå¹¶ä¸”å‘é€åœ¨å¹¿æ’­å™¨å’ŒBeanå‡†å¤‡æœŸé—´æ‰€éœ€è¦å‘é€çš„äº‹ä»¶</p>
<pre><code class="language-java">
protected void registerListeners() {
		// Register statically specified listeners first.
		for (ApplicationListener&lt;?&gt; listener : getApplicationListeners()) {
			getApplicationEventMulticaster().addApplicationListener(listener);
		}

		// Do not initialize FactoryBeans here: We need to leave all regular beans
		// uninitialized to let post-processors apply to them!
		String[] listenerBeanNames = getBeanNamesForType(ApplicationListener.class, true, false);
		for (String listenerBeanName : listenerBeanNames) {
			getApplicationEventMulticaster().addApplicationListenerBean(listenerBeanName);
		}

		// Publish early application events now that we finally have a multicaster...
		Set&lt;ApplicationEvent&gt; earlyEventsToProcess = this.earlyApplicationEvents;
		this.earlyApplicationEvents = null;
		if (earlyEventsToProcess != null) {
			for (ApplicationEvent earlyEvent : earlyEventsToProcess) {
				getApplicationEventMulticaster().multicastEvent(earlyEvent);
			}
		}
	}
</code></pre>
<p>å¦‚å›¾6æ‰€ç¤ºï¼Œå°†å®¹å™¨ä¸­åˆå§‹åŒ–å¥½çš„Spring Beanä¸­åŒ…å«@EventListeneræ³¨è§£çš„æ–¹æ³•å’ŒBeanåŒ…è£¹åˆ°ä¸€ä¸ªæ–°é€šç”¨çš„ApplicationListenerå­ç±»ï¼ˆå³ApplicationListenerMethodAdapterä¸­ï¼‰</p>
<p>ApplicationListenerMethodAdapterç±»ï¼Œå…¶ç»§æ‰¿è‡ªApplicationListenerå®ç°onApplicationEventæ–¹æ³•ï¼Œä¼ å…¥å‚æ•°ï¼šString beanName, Class&lt;?&gt; targetClass, Method methodï¼ˆ@EventListenerçš„ç›®æ ‡æ–¹æ³•ï¼‰ã€‚<br>
å¦‚å›¾7æ‰€ç¤ºï¼Œå®ƒä¼šå®ç°processEventæ–¹æ³•ï¼Œæ–¹æ³•ä½“ä¸­çš„handleResultä¼šå°†ç›®æ ‡æ–¹æ³•æ‰§è¡Œçš„ç»“æœç»§ç»­å½“åšEventå‘é€å‡ºå»ã€‚</p>
<pre><code class="language-java">public void processEvent(ApplicationEvent event){
    Pbject[] args = resolveArguments(event);
    if(shouldHandler(event,args)){
        Object result =  doInvoke(args);
        if(result != null){
            handleResult(result);
        }
        else{
            logger.trace(&quot;&quot;);
        }
    }
}
</code></pre>
<h4 id="springåŒæ­¥å’Œå¼‚æ­¥äº‹ä»¶çš„ä½¿ç”¨åœºæ™¯">SpringåŒæ­¥å’Œå¼‚æ­¥äº‹ä»¶çš„ä½¿ç”¨åœºæ™¯</h4>
<h4 id="springæ¶ˆæ¯å¤„ç†æœºåˆ¶">Springæ¶ˆæ¯å¤„ç†æœºåˆ¶</h4>
<p>Springäº‹ä»¶çš„ç›‘å¬æœºåˆ¶å¯ä»¥ç†è§£ä¸ºæ˜¯ä¸€ç§è§‚å¯Ÿè€…æ¨¡å¼ï¼Œæœ‰æ•°æ®å‘å¸ƒè€…ï¼ˆäº‹ä»¶æºï¼‰å’Œæ•°æ®æ¥å—è€…ï¼ˆç›‘å¬å™¨ï¼‰ï¼›</p>
<p>åœ¨Javaä¸­ï¼Œäº‹ä»¶å¯¹è±¡éƒ½æ˜¯ç»§æ‰¿java.util.EventObjectå¯¹è±¡ï¼Œäº‹ä»¶ç›‘å¬å™¨éƒ½æ˜¯java.util.EventListenerå®ä¾‹.</p>
<p>å…¶ä¸­ï¼Œjava.util.EventObjectæ˜¯äº‹ä»¶çŠ¶æ€å¯¹è±¡çš„åŸºç±»ï¼Œå®ƒå°è£…äº†äº‹ä»¶æºå¯¹è±¡ä»¥åŠå’Œäº‹ä»¶ç›¸å…³çš„ä¿¡æ¯ã€‚æ‰€æœ‰javaçš„äº‹ä»¶ç±»éƒ½éœ€è¦ç»§æ‰¿è¯¥ç±»ã€‚</p>
<p>è€Œjava.util.EventListeneræ˜¯ä¸€ä¸ªæ¥å£ï¼Œæ‰€æœ‰äº‹ä»¶ç›‘å¬å™¨éƒ½éœ€è¦å®ç°è¯¥æ¥å£ã€‚</p>
<p>äº‹ä»¶ç›‘å¬å™¨æ³¨å†Œåœ¨äº‹ä»¶æºä¸Šï¼Œå½“äº‹ä»¶æºçš„å±æ€§æˆ–çŠ¶æ€æ”¹å˜çš„æ—¶å€™ï¼Œè°ƒç”¨ç›¸åº”ç›‘å¬å™¨å†…çš„å›è°ƒæ–¹æ³•ã€‚</p>
<p>Sourceä½œä¸ºäº‹ä»¶æºä¸éœ€è¦å®ç°æˆ–ç»§æ‰¿ä»»ä½•æ¥å£æˆ–ç±»ï¼Œå®ƒæ˜¯äº‹ä»¶æœ€åˆå‘ç”Ÿçš„åœ°æ–¹ã€‚å› ä¸ºäº‹ä»¶æºéœ€è¦æ³¨å†Œäº‹ä»¶ç›‘å¬å™¨ï¼Œæ‰€ä»¥äº‹ä»¶æºå†…éœ€è¦å­˜æ”¾äº‹ä»¶ç›‘å¬å™¨çš„å®¹å™¨ã€‚</p>
<h4 id="springæ¶ˆæ¯çš„åŒæ­¥å¤„ç†">Springæ¶ˆæ¯çš„åŒæ­¥å¤„ç†</h4>
<p>å‡è®¾ä¸Šé¢çš„ä¾‹å­ä¸­ä¸¤ä¸ªæ–¹æ³•insertUserså’ŒsendInsertUseréœ€è¦åŒæ­¥æ‰§è¡Œï¼Œä¹Ÿå°±æ˜¯insertUsersæ–¹æ³•ä¼šå…ˆæ‰§è¡Œï¼Œå®Œæˆæ•°æ®åº“çš„æäº¤ä»¥åå†æ‰§è¡ŒsendInsertUseræ–¹æ³•å‘é€æ¶ˆæ¯ã€‚å¦‚æœinsertUsersæ•°æ®åº“æäº¤ä¸€ç›´æ²¡æœ‰è¿”å›æˆåŠŸçš„ç»“æœï¼ŒsendInsertUserå°±éœ€è¦ä¸€ç›´ç­‰å¾…ã€‚ä¹Ÿå°±æ˜¯è¯´insertUsers ä¼šé˜»å¡sendInsertUseræ–¹æ³•ï¼Œè¿™å°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„åŒæ­¥æ‰§è¡Œã€‚ä¸ºäº†åšåˆ°åŒæ­¥æ‰§è¡Œå°±éœ€è¦å°†ç›‘å¬å™¨åŠ å…¥åˆ°ä¸»çº¿ç¨‹çš„äº‹åŠ¡ä¸­ï¼Œè®©è¿™ä¸¤ä¸ªæ–¹æ³•é¡ºåºæ‰§è¡Œã€‚</p>
<p>å¦‚å›¾5æ‰€ç¤ºï¼Œé¦–å…ˆåœ¨insertUsersæ–¹æ³•ä¸Šé¢æ‰“ä¸Š@Transcationalçš„æ³¨é‡Šï¼Œæ ‡æ³¨å®ƒæ˜¯ä¸€ä¸ªäº‹ç‰©æ“ä½œ</p>
<p>ç„¶åä¿®æ”¹insertUserListeneræ–¹æ³•ï¼Œåœ¨ä¸Šé¢åŠ ä¸Š@TranscationalEventListenerçš„æ³¨é‡Šï¼Œå¹¶ä¸”é€šè¿‡phaseå±æ€§æ ‡æ³¨TransactionPhase.AFTER_COMMITï¼Œæ„æ€æ˜¯åœ¨äº‹ç‰©æäº¤ä»¥ååœ¨æ‰§è¡Œæ–¹æ³•å†…å®¹ã€‚ä¹Ÿå°±æ˜¯åœ¨insert user æ•°æ®åº“äº‹ç‰©æäº¤ä»¥åï¼Œå†å¤„ç†ç›‘å¬åˆ°çš„UserEventæ¶ˆæ¯ï¼Œä»è€Œä¿è¯äº‹åŠ¡çš„ä¸€è‡´æ€§ã€‚</p>
<pre><code class="language-java">@Transaction(rollbackFor= Exceptions.class)
public void insertUser(){
    
}

@TransactionEventListener(phase = TransactionPhase.AFTER_COMMIT,fallbackException = true)
public void insertUserListener(){

}


</code></pre>
<h4 id="springæ¶ˆæ¯çš„å¼‚æ­¥å¤„ç†">Springæ¶ˆæ¯çš„å¼‚æ­¥å¤„ç†</h4>
<p>ä¸Šé¢èŠäº†åŒæ­¥å¤„ç†çš„ä¸šåŠ¡åœºæ™¯ï¼Œè¿˜æ˜¯è¿™ä¸ªä¾‹å­æˆ‘ä»¬æ¥ç€èŠã€‚å‡è®¾insertUserså’ŒsendInsertUserè¿™ä¸¤ä¸ªæ“ä½œçš„ä¸šåŠ¡å…³è”æ€§å¹¶ä¸å¤§ï¼Œé‚£ä¹ˆå¦‚ä½•å¤„ç†ã€‚ä¾‹å¦‚ï¼šinsertUsersä¹‹ååªæ˜¯å‘ä¸€ä¸ªé€šçŸ¥ç»™ç”¨æˆ·ï¼Œè¯´æ•°æ®å…¥åº“äº†ã€‚å°±ç®—æ˜¯å…¥åº“ä¸æˆåŠŸï¼Œæ¶ˆæ¯å‘é€ä¹Ÿä¸ç”¨æ’¤å›ï¼Œæ¯•ç«Ÿæ²¡æœ‰ç„¶åçš„ä¸šåŠ¡æŸå¤±ã€‚</p>
<p>è¿™ç§åœºæ™¯ä¸šåŠ¡å°±å¯ä»¥ç”¨å¼‚æ­¥å¤„ç†æ¥åšï¼Œä¹Ÿå°±æ˜¯è¯´sendInsertUserä¸ç”¨ç­‰å¾…insertUsersæ–¹æ³•æ•°æ®åº“æ¡ä»¶å®Œæˆå°±å¯ä»¥å¤„ç†å‘é€çš„æ¶ˆæ¯äº†ã€‚æ¢å¥è¯è¯´è¿™ä¸¤ä¸ªæ–¹æ³•ä¸æ˜¯ä¸²è¡Œæ‰§è¡Œçš„è€Œæ˜¯å¹¶è¡Œæ‰§è¡Œçš„ï¼Œä¸¤ä¸ªæ“ä½œçš„æ‰§è¡Œæ˜¯äº’ç›¸ä¸å¹²æ‰°çš„ã€‚</p>
<p>å¦‚å›¾7 æ‰€ç¤ºï¼Œå¼‚æ­¥å¤„ç†åªéœ€è¦åœ¨åŸæ–¹æ³•ä¸ŠåŠ ä¸Š@Asyncçš„æ³¨é‡Šï¼ŒåŒæ—¶éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œéœ€è¦ä½¿ç”¨@EnableAsyncå¼€å¯Spring å¼‚æ­¥æ¨¡å¼</p>
<pre><code class="language-java">@Transaction(rollbackFor= Exceptions.class)
public void insertUser(){
    
}

@Async
@TransactionEventListener(phase = TransactionPhase.AFTER_COMMIT,fallbackException = true)
public void insertUserListener(){

}


</code></pre>
<h3 id="ç©è½¬spring-cacheä¸­cacheableæ³¨è§£çš„åº•å±‚åŸç†">ç©è½¬Spring Cacheä¸­@Cacheableæ³¨è§£çš„åº•å±‚åŸç†</h3>
<h4 id="cacheableæ³¨è§£çš„ç±»ç»“æ„">@Cacheableæ³¨è§£çš„ç±»ç»“æ„</h4>
<p>ä¸ºäº†é€šè¿‡@Cacheableè¿›è¡Œç¼“å­˜éœ€è¦åœ¨å®¹å™¨ä¸­æ³¨å…¥3ä¸ªbeanï¼šCacheOperationSourceã€BeanFactoryCacheOperationSourceAdvisorã€CacheInterceptorã€‚</p>
<p>å¦‚å›¾1 æ‰€ç¤ºï¼Œå¸¦é¢œè‰²çš„éƒ¨åˆ†å°±æ˜¯æˆ‘ä»¬éœ€è¦å…³æ³¨çš„éƒ¨åˆ†ï¼Œå…¶ä¸­BeanFactoryCacheOperationSourceAdvisorä½œä¸ºbeanå·¥å‚æ˜¯ç”¨æ¥äº§ç”Ÿæ“ä½œç¼“å­˜æºï¼Œå¹¶ä¸”å¯¹ç¼“å­˜@Cacheableæ³¨è§£è¿›è¡Œå¢å¼ºçš„ï¼Œè¿™ä¸€ç‚¹ä»ç±»çš„åå­—ä¸Šå¯ä»¥çœ‹å‡ºæ¥ã€‚</p>
<p>CacheInterceptoræ˜¯ç¼“å­˜çš„æ‹¦æˆªå™¨ï¼Œæ˜¯æ•´ä¸ªè¿‡ç¨‹ä¸­å¤„ç†ç¼“å­˜ä¿¡æ¯çš„ç±»ï¼Œå…¶ä¸»è¦å®ç°çš„æ–¹æ³•æ˜¯executeï¼Œè¿™ä¸ªæ–¹æ³•æ˜¯ä»CacheAspectSupoortç±»ä¸­ç»§æ‰¿è¿‡æ¥çš„ã€‚</p>
<p>æœ€åå°±æ˜¯CacheOperationSourceï¼Œå®ƒæ˜¯å¤„ç†ç¼“å­˜æ“ä½œçš„æºå¤´ï¼ŒCacheInterceptorä¹Ÿå°±æ˜¯å›´ç»•è¿™ä¸ªç¼“å­˜æºå¤´å±•å¼€å·¥ä½œã€‚</p>
<p>CacheOperationSourceæœ‰ä¸€ä¸ªå­ç±»ä¸ºAnnotationCacheOperationSourceï¼Œè¿™ä¸ªç±»æ˜¯ä½œä¸ºç¼“å­˜æ“ä½œçš„æºå¤´ï¼Œå®ƒä¼šå…³è”CacheAnnotationParseræ¥å£ï¼Œä½¿ç”¨SpringCacheAnnotationParserå¯¹ç¼“å­˜ä¿¡æ¯è¿›è¡Œè§£æã€‚åœ¨å›¾çš„æœ€å·¦è¾¹æ˜¯ç¼“å­˜æ“ä½œçš„å‡ ä¸ªç±»ï¼Œæ‰€æœ‰çš„ç¼“å­˜æ“ä½œCacheOperationæ˜¯å®ç°äº†BasicOperationæ¥å£ï¼Œé’ˆå¯¹@Cacheableç¼“å­˜æ³¨é‡Šæ˜¯ç»§æ‰¿ä¸CacheOperationç±»çš„ã€‚</p>
<h4 id="cacheoperationsource-ä»‹ç»">CacheOperationSource ä»‹ç»</h4>
<p>ä»‹ç»å®Œäº†@Cacheableçš„ç±»/æ¥å£ç»“æ„å†æ¥å¯¹å…¶ä¸­æ¶‰åŠåˆ°çš„ç±»æ–‡ä»¶è¿›è¡Œè¡¨è¿°ã€‚<br>
å¦‚å›¾2 æ‰€ç¤ºï¼Œ@Cacheableä½œä¸ºæ¥å£å®šä¹‰ï¼Œå¯ä»¥è¢«ç”¨åœ¨æ–¹æ³•å’Œç±»å‹ä¸Šé¢ï¼Œåœ¨æ¥å£ä¸­è¿˜å¯¹å…¶å±æ€§è¿›è¡Œäº†æè¿°ã€‚</p>
<pre><code class="language-java">public @interface Cacheable{
    //ç¼“å­˜åç§°ï¼Œå¯ä»¥å†™å¤šä¸ª
    @AliasFor(&quot;cacheNames&quot;)
    String[] cacheNames() default{};
    @AliasFor(&quot;value&quot;)
    String[] values() default{};
    // æ”¯æŒSpelï¼Œåˆ‡å¯ä»¥ä½¿ç”¨#root
    String key() default &quot;&quot;;
    //Mutually exclusive ï¼šå®ƒå’Œkeyå±æ€§äº’ç›¸æ’æ–¥ï¼Œè¯·åªä½¿ç”¨ä¸€ä¸ª
    String keyGenerator() defaule &quot;&quot;;
    String cacheManager() defaule &quot;&quot;;
    String cacheResolver() defaule &quot;&quot;;
    
    // Spel ,åˆ‡å¯ä»¥ä½¿ç”¨#Root ï¼Œåªæœ‰trueæ—¶ï¼Œæ‰ä¼šä½œç”¨åœ¨è¿™ä¸ªæ–¹æ³•ä¸Š
    String condition() default &quot;&quot;;
    // Spel ,åˆ‡å¯ä»¥ä½¿ç”¨#Root ï¼Œå¹¶ä¸”å¯ä»¥ä½¿ç”¨#resultæ‹¿åˆ°æ–¹æ³•è¿”å›å€¼
    String unless() default &quot;&quot;;
    boolean sync() default false;
    
    
}


</code></pre>
<table>
<thead>
<tr>
<th>å±æ€§å</th>
<th>è§£é‡Š</th>
</tr>
</thead>
<tbody>
<tr>
<td>value</td>
<td>ç¼“å­˜çš„åç§°ï¼Œå¯ä»¥å®šä¹‰å¤šä¸ªï¼ˆè‡³å°‘éœ€è¦å®šä¹‰ä¸€ä¸ªï¼‰</td>
</tr>
<tr>
<td>cacheNames</td>
<td>åŒvalueå±æ€§</td>
</tr>
<tr>
<td>keyGenerator</td>
<td>keyç”Ÿæˆå™¨ï¼Œå­—ç¬¦ä¸²ä¸ºï¼šbeanName</td>
</tr>
<tr>
<td>key</td>
<td>ç¼“å­˜çš„keyï¼Œå¯ä½¿ç”¨SpELï¼Œä¼˜å…ˆçº§å¤§äºkeyGenerator</td>
</tr>
<tr>
<td>cacheManager</td>
<td>ç¼“å­˜ç®¡ç†å™¨å¡«å†™beanName</td>
</tr>
<tr>
<td>cacheResolver</td>
<td>ç¼“å­˜å¤„ç†å™¨å¡«å†™beanName</td>
</tr>
<tr>
<td>condition</td>
<td>ç¼“å­˜æ¡ä»¶ï¼Œè‹¥å¡«å†™äº†ï¼Œè¿”å›trueæ‰ä¼šæ‰§è¡Œæ­¤ç¼“å­˜ï¼Œå¯ä½¿ç”¨SpEL</td>
</tr>
<tr>
<td>unless</td>
<td>å¦å®šç¼“å­˜ï¼Œfalseä¸ºå¤±æ•ˆï¼Œå¯ä»¥å†™SpEL</td>
</tr>
<tr>
<td>sync</td>
<td>trueï¼šæ‰€æœ‰ç›¸åŒçš„keyçš„åŒçº¿ç¨‹é¡ºåºæ‰§è¡Œã€‚é»˜è®¤æ˜¯false</td>
</tr>
<tr>
<td>allEntries</td>
<td>æ˜¯å¦æ¸…ç©ºæ‰€æœ‰ç¼“å­˜å†…å®¹ï¼Œç¼ºçœä¸ºfalseï¼Œå¦‚æœæŒ‡å®šä¸ºtrueï¼Œåˆ™æ–¹æ³•è°ƒç”¨åç«‹å³æ¸…ç©ºæ‰€æœ‰ç¼“å­˜</td>
</tr>
<tr>
<td>beforeInvocation</td>
<td>æ˜¯å¦åœ¨æ–¹æ³•æ‰§è¡Œå‰å°±æ¸…ç©ºï¼Œç¼ºçœä¸ºfalse</td>
</tr>
</tbody>
</table>
<p>æ—¢ç„¶æœ‰äº†@Cacheableå¯ä»¥åœ¨ç±»å‹å’Œæ–¹æ³•ä¸Šé¢æ ‡æ³¨ç¼“å­˜ï¼Œå°±éœ€è¦æœ‰ä¸€ä¸ªå¯¹ç¼“å­˜è¿›è¡Œæ“ä½œçš„ç±»ã€‚</p>
<p>å¦‚å›¾4æ‰€ç¤ºï¼ŒCacheableOperationç»§æ‰¿ä¸CacheOperationç±»ï¼Œåœ¨CacheableOperationé€šè¿‡buildæ–¹æ³•å°†ç¼“å­˜æ“ä½œè¿›è¡Œç”Ÿæˆã€‚</p>
<p>æœ‰äº†CacheableOperationä¹‹åéœ€è¦æä¾›ä¸€ä¸ªæ¥å£ç»™æ‹¦æˆªå™¨ä½¿ç”¨ï¼Œä¹Ÿå°±æ˜¯è¯´æ‹¦æˆªå™¨é€šè¿‡æ³¨é‡Šè·å–è¦ç¼“å­˜çš„å¯¹è±¡ä»¥åéœ€è¦è°ƒç”¨ç¼“å­˜æ“ä½œï¼Œæ­¤æ—¶å°±æœ‰äº†æ¥å£CacheOperationSourceï¼Œæˆ‘ä»¬ç§°ä¹‹ä¸ºç¼“å­˜å±æ€§æºã€‚</p>
<p>å¦‚å›¾5 æ‰€ç¤ºï¼ŒCacheOperationSourceé€šè¿‡getCacheOperationsæ–¹æ³•è¿”å›æ‰€æœ‰ç¼“å­˜æ“ä½œçš„CacheOperationé›†åˆã€‚</p>
<p>é‚£ä¹ˆCacheOperationSource å¦‚ä½•ä¸CacheOperationäº§ç”Ÿå…³ç³»çš„å‘¢ï¼Ÿ</p>
<p>å¦‚å›¾6æ‰€ç¤ºï¼ŒAbstractFallbackCacheOperationSourceä¼šå®ç°CacheOperationSourceæ¥å£ï¼ŒåŒæ—¶AnnotationCacheOperationSourceç»§æ‰¿ä¸AbstractFallbackCacheOperationSourceï¼Œåœ¨AnnotationCacheOperationSourceä¸­ä¼šä¾èµ–CacheOperationï¼Œè°ƒç”¨å…¶ä¸­å¯¹ç¼“å­˜æ“ä½œçš„æ–¹æ³•ã€‚</p>
<h4 id="beanfactorycacheoperationsourceadvisor-ä»‹ç»">BeanFactoryCacheOperationSourceAdvisor ä»‹ç»</h4>
<p>è¯´å®Œäº†ç¼“å­˜æ“ä½œæºï¼Œåœ¨æ¥çœ‹çœ‹å®ƒæ˜¯å¦‚ä½•è¢«ä½¿ç”¨çš„ã€‚BeanFactoryCacheOperationSourceAdvisor å°±æ˜¯æ¥æ•´åˆç¼“å­˜å’Œå¢å¼ºå™¨çš„ï¼Œæ ¹æ®AOPçš„æ€æƒ³æœ‰äº†ç›®æ ‡ï¼Œå®šä¹‰åˆ‡é¢å’Œè¿æ¥ç‚¹ä»¥åå°±éœ€è¦é€šè¿‡å¢å¼ºå™¨å¯¹æ–¹æ³•è¿›è¡Œå¢å¼ºæ“ä½œã€‚</p>
<p>å¦‚å›¾7æ‰€ç¤ºï¼ŒcacheAdvisoræ–¹æ³•å°±æ˜¯å°†ç¼“å­˜æºå’Œæ‹¦æˆªå™¨ä½œä¸ºBeanFactoryCacheOperationSourceAdvisorçš„å±æ€§è¿›è¡Œç»‘å®šã€‚è€ŒCacheInterceptorä¹Ÿæ˜¯å¤„ç†ç¼“å­˜çš„ä¸»åŠ›å†›åé¢ä¼šç»™å¤§å®¶è®²åˆ°ã€‚</p>
<h4 id="cacheinterceptor-ä»‹ç»">CacheInterceptor ä»‹ç»</h4>
<p>è¯´å®Œç¼“å­˜æ“ä½œæ¥æºå’Œç”Ÿæˆç¼“å­˜æ¥æºã€å¢å¼ºå™¨çš„å·¥å‚ç±»ä»¥åï¼Œå†æ¥çœ‹çœ‹å¤„ç†ç¼“å­˜çš„CacheInterceptorï¼Œä»å­—é¢æ„æ€å¯ä»¥çœ‹å‡ºå®ƒä¸»è¦æ˜¯åšç¼“å­˜æ‹¦æˆªå™¨çš„ã€‚<br>
å¦‚å›¾9 æ‰€ç¤ºï¼Œå®ƒç»§æ‰¿ä¸CacheAspectSupportç±»ï¼Œå¹¶ä¸”å®ç°äº†invokeæ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•ä¸­æœ‰æ‰§è¡Œäº†executeæ–¹æ³•ï¼Œè¿™ä¸ªæ–¹æ³•æ¥è‡ªçˆ¶ç±»ã€‚</p>
<p>æ¥ç€çœ‹çˆ¶ç±»çš„excuteæ–¹æ³•ï¼Œå¦‚å›¾10 æ‰€ç¤ºï¼Œæˆ‘ä»¬å°†CacheAspectSupport ä¸­çš„executeæ–¹æ³•æˆªå–ç»™å¤§å®¶è®²è§£ã€‚</p>
<p>å…¶ä¸­çº¢æ¡†çš„éƒ¨åˆ†ï¼Œé¦–å…ˆè·å–CacheOperationSourceä¹Ÿå°±æ˜¯ç¼“å­˜æ“ä½œæºï¼Œç„¶åé€šè¿‡getCacheOperationsæ–¹æ³•è·å–è¿™ä¸ªæ“ä½œæºä¸­çš„æ‰€æœ‰å¯¹ç¼“å­˜çš„æ“ä½œã€‚ä¿å­˜åˆ°operationså˜é‡ä¸­ï¼Œæœ€ååˆè°ƒç”¨äº†ä¸€ä¸ªexecuteå‡½æ•°ä¼ å…¥äº†CacheOperationContextsè¿™ä¸ªæ˜¯ç¼“å­˜æ“ä½œçš„ä¸Šä¸‹æ–‡ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½ä¼šåŸºäºè¿™ä¸ªä¸Šä¸‹æ–‡è¿›è¡Œï¼Œè€Œä¸”æ˜¯å¤šä¸ªä¸Šä¸‹æ–‡ã€‚</p>
<h3 id="ç²¾é€‰é¢è¯•é¢˜ä»€ä¹ˆæƒ…å†µå¯¼è‡´springäº‹åŠ¡å¤±æ•ˆ">ç²¾é€‰é¢è¯•é¢˜ï¼šä»€ä¹ˆæƒ…å†µå¯¼è‡´Springäº‹åŠ¡å¤±æ•ˆï¼Ÿ</h3>
<ul>
<li>
<p>æ²¡æœ‰è¢«Springç®¡ç†</p>
<pre><code>  æ²¡æœ‰è¢«Springç®¡ç†çš„Beanï¼Œå¦‚æœå…¶ä¸­å‡ºç°äº†æ–¹æ³•éœ€è¦è¿›è¡Œäº‹åŠ¡å¤„ç†çš„æƒ…å†µï¼Œæ­¤æ—¶çš„äº‹åŠ¡ä¸ä¼šæ‰§è¡Œã€‚å¦‚å›¾1 æ‰€ç¤ºï¼Œåœ¨OrderServiceImplç±»ä¸­å¦‚æœå°†@Serviceæ³¨é‡Šæ‰ï¼Œé‚£ä¹ˆæ­¤ç±»å¯¹åº”çš„beanä¹Ÿå°±ä¸ä¼šè¢«Spring IoCå®¹å™¨ç®¡ç†ã€‚å³ä¾¿updateOrderä¸Šé¢æ³¨é‡Šäº†@Transactionalï¼Œè¿™ä¸ªæ–¹æ³•ä¹Ÿä¸ä¼šæ‰§è¡Œäº‹åŠ¡ã€‚
</code></pre>
</li>
<li>
<p>æ–¹æ³•ä¸æ˜¯public</p>
<p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ@Transactional åªèƒ½ç”¨äº public çš„æ–¹æ³•ä¸Šï¼Œå¦åˆ™äº‹åŠ¡ä¸ä¼šå¤±æ•ˆï¼Œå¦‚æœè¦ç”¨åœ¨é public æ–¹æ³•ä¸Šï¼Œå¯ä»¥å¼€å¯ AspectJ ä»£ç†æ¨¡å¼ã€‚å¦‚å›¾2 æ‰€ç¤ºï¼ŒsaveAllæ–¹æ³•ä¸Šé¢æ ‡æ³¨äº†@Transactionalçš„æ³¨é‡Šï¼Œç”±äºsaveAllæ–¹æ³•æ²¡æœ‰æ ‡æ³¨publicï¼Œå› æ­¤saveAllä¸­çš„å†…å®¹æ˜¯ä¸ä¼šæ‰§è¡Œäº‹åŠ¡çš„ã€‚</p>
</li>
<li>
<p>æ•°æ®æºæ²¡æœ‰é…ç½®äº‹åŠ¡ç®¡ç†å™¨</p>
<pre><code>  æ•°æ®æºè‹¥æ²¡æœ‰é…ç½®äº‹åŠ¡ç®¡ç†å™¨ï¼Œé‚£ä¹ˆä¸‹é¢çš„æ–¹æ³•transactionManageræ˜¯æ— æ³•å®ç°äº‹åŠ¡çš„ã€‚
</code></pre>
</li>
<li>
<p>äº‹åŠ¡ä¼ æ’­çº§åˆ«é€‰æ‹©</p>
<pre><code>  å¦‚æœåœ¨æ–¹æ³•åµŒå¥—è°ƒç”¨æ—¶å­˜åœ¨äº‹åŠ¡ä¼ æ’­çš„åœºæ™¯ï¼Œåœ¨å®šä¹‰äº‹åŠ¡çº§åˆ«çš„æ—¶å€™ä½¿ç”¨äº†NOT_SUPPORTED é‚£ä¹ˆå¯¹åº”çš„æ–¹æ³•å°±ä¸ä¼šæ‰§è¡Œäº‹åŠ¡ã€‚
</code></pre>
</li>
<li>
<p>äº‹åŠ¡ä¸­å‡ºç°å¼‚å¸¸</p>
<pre><code>  å¦‚æœåœ¨æ‰§è¡Œçš„æ–¹æ³•ä¸­æ‰§è¡Œçš„äº‹åŠ¡ï¼Œç”±äºå¼‚å¸¸é€€å‡ºçš„æƒ…å†µï¼Œé‚£ä¹ˆè¿™ä¸ªäº‹åŠ¡æ˜¯æ— æ³•å®Œæˆçš„ã€‚å¦‚å›¾7 æ‰€ç¤ºï¼Œåœ¨updateOrderæ–¹æ³•ä¸­ä½¿ç”¨äº†try catchï¼Œä¸€æ—¦åœ¨æ–¹æ³•ä½“ä¸­å‡ºç°å¼‚å¸¸ï¼Œæ­¤æ—¶äº‹åŠ¡ä¼šä¸­æ–­æ— æ³•æ‰§è¡Œ
</code></pre>
</li>
<li>
<p>é”™è¯¯å®šä¹‰å¼‚å¸¸ç±»å‹</p>
<pre><code>  åœ¨äº‹åŠ¡ä¸­å‡ºç°å¼‚å¸¸çš„æ—¶å€™ï¼Œéœ€è¦å¯¹å¼‚å¸¸è¿›è¡Œå®šä¹‰æ‰èƒ½æ­£ç¡®æ‰§è¡Œäº‹åŠ¡ã€‚å¦‚æœå‡ºç°é”™è¯¯çš„å®šä¹‰ï¼Œå½“å‡ºç°äº‹åŠ¡ä¸­çš„å¼‚å¸¸æ—¶ï¼Œè¿˜å¯ä»¥ç»§ç»­æ‰§è¡Œäº‹åŠ¡ã€‚å¦‚å›¾8æ‰€ç¤ºï¼Œåœ¨æ–¹æ³•updateOrderä¸­å¯¹Exceptionè¿›è¡Œäº†æ•æ‰ï¼Œä½†æ˜¯åœ¨æ–¹æ³•ä¸Šé¢çš„Transactionalæ³¨é‡Šä¸­rollbackForä¸­å®šä¹‰çš„æ˜¯SQLException.class ï¼Œæ­£ç¡®çš„å®šä¹‰åº”è¯¥æ˜¯Exception.classã€‚
</code></pre>
</li>
</ul>

              </div>
              <div class="toc-container">
                <ul class="markdownIt-TOC">
<li><a href="#spring">spring</a>
<ul>
<li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></li>
</ul>
</li>
<li><a href="#%E7%9B%AE%E5%BD%95-2">ç›®å½•</a>
<ul>
<li><a href="#%E7%B2%BE%E9%80%89%E9%9D%A2%E8%AF%95%E9%A2%98springioc%E5%AE%B9%E5%99%A8%E5%88%9D%E5%A7%8B%E5%8C%96%E8%BF%87%E7%A8%8B">ç²¾é€‰é¢è¯•é¢˜ï¼šSpringIOCå®¹å™¨åˆå§‹åŒ–è¿‡ç¨‹</a>
<ul>
<li><a href="#ioc%E6%98%AF%E5%A6%82%E4%BD%95%E5%B7%A5%E4%BD%9C%E7%9A%84">IOCæ˜¯å¦‚ä½•å·¥ä½œçš„</a>
<ul>
<li><a href="#resource%E5%AE%9A%E4%BD%8D">Resourceå®šä½</a></li>
<li><a href="#%E8%BD%BD%E5%85%A5beandefinition">è½½å…¥BeanDefinition</a></li>
<li><a href="#%E5%B0%86beandefinition%E6%B3%A8%E5%86%8C%E5%88%B0%E5%AE%B9%E5%99%A8">å°†BeanDefinitionæ³¨å†Œåˆ°å®¹å™¨</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#springioc%E4%BE%9D%E8%B5%96%E6%9F%A5%E6%89%BE">SpringIOCä¾èµ–æŸ¥æ‰¾</a>
<ul>
<li><a href="#%E6%A0%B9%E6%8D%AEbean%E5%90%8D%E7%A7%B0%E6%9F%A5%E6%89%BE">æ ¹æ®Beanåç§°æŸ¥æ‰¾</a></li>
<li><a href="#%E6%A0%B9%E6%8D%AEbean%E7%B1%BB%E5%9E%8B%E6%9F%A5%E6%89%BE">æ ¹æ®Beanç±»å‹æŸ¥æ‰¾</a></li>
<li><a href="#%E4%BE%9D%E8%B5%96%E6%9F%A5%E6%89%BE%E4%B8%AD%E7%9A%84%E7%BB%8F%E5%85%B8%E5%BC%82%E5%B8%B8bean%E6%89%BE%E4%B8%8D%E5%88%B0bean%E4%B8%8D%E6%98%AF%E5%94%AF%E4%B8%80%E7%9A%84">ä¾èµ–æŸ¥æ‰¾ä¸­çš„ç»å…¸å¼‚å¸¸ï¼šBeanæ‰¾ä¸åˆ°ï¼ŸBeanä¸æ˜¯å”¯ä¸€çš„ï¼Ÿ</a>
<ul>
<li><a href="#beansexception">BeansException</a></li>
</ul>
</li>
<li><a href="#%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90spring-ioc%E5%AE%B9%E5%99%A8bean%E5%88%9D%E5%A7%8B%E5%8C%96%E6%B5%81%E7%A8%8B">æºç å‰–æï¼šSpring IOCå®¹å™¨Beanåˆå§‹åŒ–æµç¨‹ï¼Ÿ</a></li>
<li><a href="#springioc%E4%BE%9D%E8%B5%96%E6%9F%A5%E6%B3%A8%E5%85%A5">SpringIOCä¾èµ–æŸ¥æ³¨å…¥</a></li>
<li><a href="#%E6%BA%90%E7%A0%81%E5%89%96%E6%9E%90autowire%E6%B3%A8%E8%A7%A3%E4%BE%9D%E8%B5%96%E6%B3%A8%E5%85%A5%E7%9A%84%E5%8E%9F%E7%90%86">æºç å‰–æï¼š@Autowireæ³¨è§£ä¾èµ–æ³¨å…¥çš„åŸç†</a>
<ul>
<li><a href="#autowire%E7%9A%84%E5%AE%9A%E4%B9%89">@Autowireçš„å®šä¹‰</a></li>
<li><a href="#autowire%E7%9A%84%E5%B7%A5%E4%BD%9C%E5%8E%9F%E7%90%86">@Autowireçš„å·¥ä½œåŸç†</a></li>
</ul>
</li>
<li><a href="#%E7%B2%BE%E9%80%89%E9%9D%A2%E8%AF%95%E9%A2%98autowire%E5%92%8Cresource%E5%8C%BA%E5%88%AB">ç²¾é€‰é¢è¯•é¢˜ï¼š@Autowireå’Œ@ResourceåŒºåˆ«</a>
<ul>
<li><a href="#resource%E7%9A%84%E6%B3%A8%E5%85%A5%E6%96%B9%E5%BC%8F">@Resourceçš„æ³¨å…¥æ–¹å¼</a></li>
</ul>
</li>
<li><a href="#spring-ioc%E4%BE%9D%E8%B5%96%E6%9D%A5%E6%BA%90%E6%9C%89%E5%93%AA%E4%BA%9B">Spring IOCä¾èµ–æ¥æºæœ‰å“ªäº›ï¼Ÿ</a></li>
<li><a href="#%E7%B2%BE%E9%80%89%E9%9D%A2%E8%AF%95%E9%A2%98value%E6%98%AF%E5%A6%82%E4%BD%95%E5%B0%86%E5%A4%96%E9%83%A8%E5%8C%96%E9%85%8D%E7%BD%AE%E6%B3%A8%E5%85%A5%E5%88%B0spring-bean%E4%B8%AD">ç²¾é€‰é¢è¯•é¢˜ï¼š@Valueæ˜¯å¦‚ä½•å°†å¤–éƒ¨åŒ–é…ç½®æ³¨å…¥åˆ°spring beanä¸­ï¼Ÿ</a>
<ul>
<li><a href="#value%E8%8E%B7%E5%8F%96%E9%85%8D%E7%BD%AE%E7%9A%84%E7%AE%80%E4%BB%8B">@Valueè·å–é…ç½®çš„ç®€ä»‹</a></li>
<li><a href="#%E5%9F%BA%E4%BA%8E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5">åŸºäºé…ç½®æ–‡ä»¶æ³¨å…¥</a></li>
<li><a href="#%E5%9F%BA%E4%BA%8E%E9%9D%9E%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6%E6%B3%A8%E5%85%A5">åŸºäºéé…ç½®æ–‡ä»¶æ³¨å…¥</a></li>
<li><a href="#%E9%BB%98%E8%AE%A4%E5%80%BC%E6%B3%A8%E5%85%A5">é»˜è®¤å€¼æ³¨å…¥</a></li>
</ul>
</li>
<li><a href="#%E7%B2%BE%E9%80%89%E9%9D%A2%E8%AF%95%E9%A2%98spring-ioc%E5%A6%82%E4%BD%95%E8%A7%A3%E5%86%B3%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E9%97%AE%E9%A2%98">ç²¾é€‰é¢è¯•é¢˜ï¼šspring IOCå¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼Ÿ</a>
<ul>
<li><a href="#%E4%BB%80%E4%B9%88%E6%98%AF%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96">ä»€ä¹ˆæ˜¯å¾ªç¯ä¾èµ–</a></li>
<li><a href="#spring-ioc%E5%A4%84%E7%90%86%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E7%9A%84%E6%80%9D%E8%B7%AF">spring iocå¤„ç†å¾ªç¯ä¾èµ–çš„æ€è·¯</a></li>
<li><a href="#%E5%A4%84%E7%90%86%E5%BE%AA%E7%8E%AF%E4%BE%9D%E8%B5%96%E4%B8%BE%E4%BE%8B">å¤„ç†å¾ªç¯ä¾èµ–ä¸¾ä¾‹</a></li>
</ul>
</li>
<li><a href="#jdk%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%92%8Ccglib%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†</a>
<ul>
<li><a href="#aop%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5">AOPçš„åŸºæœ¬æ¦‚å¿µ</a></li>
<li><a href="#%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8aop">ä¸ºä»€ä¹ˆè¦ä½¿ç”¨AOP</a></li>
<li><a href="#jdk%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">JDKåŠ¨æ€ä»£ç†</a></li>
<li><a href="#cglib%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86">CGLIBåŠ¨æ€ä»£ç†</a></li>
<li><a href="#jdk%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%92%8Ccglib%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%8C%BA%E5%88%AB">JDKåŠ¨æ€ä»£ç†å’ŒCGLIBåŠ¨æ€ä»£ç†åŒºåˆ«</a></li>
</ul>
</li>
<li><a href="#aspect-join-points-pointcuts%E5%92%8Cadvice%E8%AF%AD%E6%B3%95">Aspectã€Join Pointsã€Pointcutså’ŒAdviceè¯­æ³•</a>
<ul>
<li><a href="#spring-aop%E6%A0%B8%E5%BF%83%E6%A6%82%E5%BF%B5%E7%BB%BC%E8%BF%B0">Spring AOPæ ¸å¿ƒæ¦‚å¿µç»¼è¿°</a></li>
</ul>
</li>
<li><a href="#_%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90spring-aop-jdk%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86">_æºç åˆ†æï¼šSpring AOP JDKåŠ¨æ€ä»£ç†å®ç°åŸç†</a>
<ul>
<li><a href="#invoke%E5%AE%9E%E7%8E%B0aop%E4%B8%AD%E5%85%B7%E4%BD%93%E7%9A%84%E9%80%BB%E8%BE%91">invokeï¼šå®ç°AOPä¸­å…·ä½“çš„é€»è¾‘</a></li>
</ul>
</li>
<li><a href="#%E7%B2%BE%E9%80%89%E9%9D%A2%E8%AF%95%E9%A2%98spring-aop%E5%92%8Caspectj-aop%E5%AD%98%E5%9C%A8%E5%93%AA%E4%BA%9B%E5%8C%BA%E5%88%AB">ç²¾é€‰é¢è¯•é¢˜ï¼šSpring AOPå’ŒAspectJ AOPå­˜åœ¨å“ªäº›åŒºåˆ«ï¼Ÿ</a>
<ul>
<li><a href="#aop%E7%9A%84%E5%9F%BA%E6%9C%AC%E6%A6%82%E5%BF%B5-2">AOPçš„åŸºæœ¬æ¦‚å¿µ</a></li>
<li><a href="#springaop%E5%92%8Caspectj%E7%9A%84%E5%8C%BA%E5%88%AB">SpringAOPå’ŒAspectJçš„åŒºåˆ«</a></li>
<li><a href="#springaop%E5%92%8Caspectj%E5%AF%B9%E7%85%A7%E8%A1%A8">SpringAOPå’ŒAspectJå¯¹ç…§è¡¨</a></li>
</ul>
</li>
<li><a href="#%E5%BC%95%E5%85%A5logback%E6%A1%86%E6%9E%B6%E8%BF%9B%E8%A1%8C%E6%97%A5%E5%BF%97%E6%89%93%E5%8D%B0">å¼•å…¥logbackæ¡†æ¶è¿›è¡Œæ—¥å¿—æ‰“å°</a>
<ul>
<li><a href="#logback%E4%BB%8B%E7%BB%8D">logbackä»‹ç»</a></li>
<li><a href="#logback%E7%9A%84%E9%85%8D%E7%BD%AE%E4%BB%8B%E7%BB%8D">logbackçš„é…ç½®ä»‹ç»</a></li>
</ul>
</li>
<li><a href="#aspect%E6%B3%A8%E8%A7%A3%E6%98%AF%E6%80%8E%E4%B9%88%E8%BF%90%E4%BD%9C%E8%B5%B7%E6%9D%A5%E7%9A%84">@Aspectæ³¨è§£æ˜¯æ€ä¹ˆè¿ä½œèµ·æ¥çš„</a>
<ul>
<li><a href="#aspect%E6%89%A7%E8%A1%8C%E8%BF%87%E7%A8%8B">@Aspectæ‰§è¡Œè¿‡ç¨‹</a></li>
</ul>
</li>
<li><a href="#_%E4%BB%A3%E7%A0%81%E5%AE%9E%E6%88%98%E5%9F%BA%E4%BA%8Espring-aop%E6%9C%BA%E5%88%B6%E5%AE%9E%E7%8E%B0%E5%85%A8%E5%B1%80%E5%BC%82%E5%B8%B8%E5%A4%84%E7%90%86">_ä»£ç å®æˆ˜ï¼šåŸºäºSpring AOPæœºåˆ¶ï¼Œå®ç°å…¨å±€å¼‚å¸¸å¤„ç†</a>
<ul>
<li><a href="#controlleradvice%E4%B8%8Eexceptionhandler%E6%B3%A8%E8%A7%A3">ControllerAdviceä¸ExceptionHandleræ³¨è§£</a></li>
</ul>
</li>
<li><a href="#%E5%9F%BA%E4%BA%8Espring-aop%E6%9C%BA%E5%88%B6%E6%8B%A6%E6%88%AA%E5%A4%84%E7%90%86%E7%99%BB%E9%99%86%E4%BF%A1%E6%81%AF">åŸºäºSpring AOPæœºåˆ¶æ‹¦æˆªå¤„ç†ç™»é™†ä¿¡æ¯</a>
<ul>
<li><a href="#%E6%B7%BB%E5%8A%A0logininterceptor%E7%B1%BB%E6%8B%A6%E6%88%AA%E7%99%BB%E9%99%86%E4%BF%A1%E6%81%AF">æ·»åŠ LoginInterceptorç±»æ‹¦æˆªç™»é™†ä¿¡æ¯</a></li>
<li><a href="#%E9%85%8D%E7%BD%AEspring-webxml%E4%B8%AD%E7%9A%84%E6%8B%A6%E6%88%AA%E5%99%A8">é…ç½®spring-web.xmlä¸­çš„æ‹¦æˆªå™¨</a></li>
</ul>
</li>
<li><a href="#%E7%B2%BE%E9%80%89%E9%9D%A2%E8%AF%95%E9%A2%98spring-aop%E7%9A%84%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B">ç²¾é€‰é¢è¯•é¢˜ï¼šSpring AOPçš„è®¾è®¡æ¨¡å¼æœ‰å“ªäº›ï¼Ÿ</a>
<ul>
<li><a href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E5%9C%A8aop%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8">ç­–ç•¥æ¨¡å¼åœ¨AOPä¸­çš„ä½¿ç”¨</a></li>
<li><a href="#%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E5%9C%A8aop%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8-2">ç­–ç•¥æ¨¡å¼åœ¨AOPä¸­çš„ä½¿ç”¨</a></li>
<li><a href="#%E6%A8%A1%E6%9D%BF%E6%A8%A1%E5%BC%8F%E5%9C%A8aop%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8">æ¨¡æ¿æ¨¡å¼åœ¨AOPä¸­çš„ä½¿ç”¨</a></li>
<li><a href="#%E9%80%82%E9%85%8D%E5%99%A8%E6%A8%A1%E5%BC%8F%E5%9C%A8aop%E4%B8%AD%E7%9A%84%E4%BD%BF%E7%94%A8">é€‚é…å™¨æ¨¡å¼åœ¨AOPä¸­çš„ä½¿ç”¨</a></li>
</ul>
</li>
<li><a href="#%E5%85%88%E6%9D%A5%E7%9C%8B%E7%9C%8B%E5%8E%9F%E7%94%9Fjdbc%E5%A6%82%E4%BD%95%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E5%BA%93%E6%93%8D%E4%BD%9C">å…ˆæ¥çœ‹çœ‹åŸç”ŸJDBCå¦‚ä½•è¿›è¡Œæ•°æ®åº“æ“ä½œ</a>
<ul>
<li><a href="#jdbc%E7%AE%80%E4%BB%8B">JDBCç®€ä»‹</a></li>
<li><a href="#%E9%85%8D%E7%BD%AEjdbc%E8%AE%BF%E9%97%AE%E6%95%B0%E6%8D%AE">é…ç½®JDBCè®¿é—®æ•°æ®</a></li>
<li><a href="#jdbc%E7%9A%84%E5%BC%8A%E7%AB%AF">JDBCçš„å¼Šç«¯</a></li>
<li><a href="#%E5%9F%BA%E4%BA%8Edruid%E8%BF%9E%E6%8E%A5%E6%B1%A0%E8%BF%9B%E8%A1%8C%E6%95%B0%E6%8D%AE%E6%93%8D%E4%BD%9C%E6%8F%90%E5%8D%87%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD">åŸºäºDruidè¿æ¥æ± è¿›è¡Œæ•°æ®æ“ä½œï¼Œæå‡ç³»ç»Ÿæ€§èƒ½</a></li>
<li><a href="#druid%E8%BF%9E%E6%8E%A5%E6%B1%A0%E8%BF%98%E5%AD%98%E5%9C%A8%E5%93%AA%E4%BA%9B%E9%97%AE%E9%A2%98">Druidè¿æ¥æ± è¿˜å­˜åœ¨å“ªäº›é—®é¢˜</a></li>
<li><a href="#%E5%9F%BA%E4%BA%8Ejdbctemplate-%E6%A8%A1%E6%9D%BF%E6%96%B9%E5%BC%8F%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93%E8%A7%A3%E5%86%B3%E4%BB%A3%E7%A0%81%E9%87%8D%E5%A4%8D%E9%97%AE%E9%A2%98">åŸºäºJDBCTemplate æ¨¡æ¿æ–¹å¼æ“ä½œæ•°æ®åº“ï¼Œè§£å†³ä»£ç é‡å¤é—®é¢˜</a></li>
<li><a href="#%E6%80%9D%E8%80%83%E4%B8%80%E4%B8%8Bjdbctemplate%E6%93%8D%E4%BD%9C%E6%95%B0%E6%8D%AE%E5%BA%93%E5%AD%98%E5%9C%A8%E7%9A%84%E9%97%AE%E9%A2%98">æ€è€ƒä¸€ä¸‹JDBCTemplateæ“ä½œæ•°æ®åº“å­˜åœ¨çš„é—®é¢˜</a></li>
<li><a href="#mybatis%E8%BF%90%E8%A1%8C%E5%8E%9F%E7%90%86%E4%BB%8B%E7%BB%8D">Mybatisè¿è¡ŒåŸç†ä»‹ç»</a></li>
</ul>
</li>
<li><a href="#springevent%E4%BA%8B%E4%BB%B6%E9%80%9A%E7%9F%A5%E6%9C%BA%E5%88%B6%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86">SpringEventäº‹ä»¶é€šçŸ¥æœºåˆ¶åº•å±‚åŸç†</a>
<ul>
<li><a href="#springevent%E7%AE%80%E5%8D%95%E4%BD%BF%E7%94%A8">SpringEventç®€å•ä½¿ç”¨</a></li>
<li><a href="#spring-event-%E6%B5%81%E7%A8%8B%E5%88%86%E6%9E%90">Spring Event æµç¨‹åˆ†æ</a></li>
<li><a href="#springevent%E6%BA%90%E7%A0%81%E5%88%86%E6%9E%90">SpringEventæºç åˆ†æ</a></li>
<li><a href="#spring%E5%90%8C%E6%AD%A5%E5%92%8C%E5%BC%82%E6%AD%A5%E4%BA%8B%E4%BB%B6%E7%9A%84%E4%BD%BF%E7%94%A8%E5%9C%BA%E6%99%AF">SpringåŒæ­¥å’Œå¼‚æ­¥äº‹ä»¶çš„ä½¿ç”¨åœºæ™¯</a></li>
<li><a href="#spring%E6%B6%88%E6%81%AF%E5%A4%84%E7%90%86%E6%9C%BA%E5%88%B6">Springæ¶ˆæ¯å¤„ç†æœºåˆ¶</a></li>
<li><a href="#spring%E6%B6%88%E6%81%AF%E7%9A%84%E5%90%8C%E6%AD%A5%E5%A4%84%E7%90%86">Springæ¶ˆæ¯çš„åŒæ­¥å¤„ç†</a></li>
<li><a href="#spring%E6%B6%88%E6%81%AF%E7%9A%84%E5%BC%82%E6%AD%A5%E5%A4%84%E7%90%86">Springæ¶ˆæ¯çš„å¼‚æ­¥å¤„ç†</a></li>
</ul>
</li>
<li><a href="#%E7%8E%A9%E8%BD%ACspring-cache%E4%B8%ADcacheable%E6%B3%A8%E8%A7%A3%E7%9A%84%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86">ç©è½¬Spring Cacheä¸­@Cacheableæ³¨è§£çš„åº•å±‚åŸç†</a>
<ul>
<li><a href="#cacheable%E6%B3%A8%E8%A7%A3%E7%9A%84%E7%B1%BB%E7%BB%93%E6%9E%84">@Cacheableæ³¨è§£çš„ç±»ç»“æ„</a></li>
<li><a href="#cacheoperationsource-%E4%BB%8B%E7%BB%8D">CacheOperationSource ä»‹ç»</a></li>
<li><a href="#beanfactorycacheoperationsourceadvisor-%E4%BB%8B%E7%BB%8D">BeanFactoryCacheOperationSourceAdvisor ä»‹ç»</a></li>
<li><a href="#cacheinterceptor-%E4%BB%8B%E7%BB%8D">CacheInterceptor ä»‹ç»</a></li>
</ul>
</li>
<li><a href="#%E7%B2%BE%E9%80%89%E9%9D%A2%E8%AF%95%E9%A2%98%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E5%AF%BC%E8%87%B4spring%E4%BA%8B%E5%8A%A1%E5%A4%B1%E6%95%88">ç²¾é€‰é¢è¯•é¢˜ï¼šä»€ä¹ˆæƒ…å†µå¯¼è‡´Springäº‹åŠ¡å¤±æ•ˆï¼Ÿ</a></li>
</ul>
</li>
</ul>
</li>
</ul>

              </div>
            </div>
          </article>
        </div>

        
          <div class="next-post">
            <div class="next">ä¸‹ä¸€ç¯‡</div>
            <a href="https://zuolinlin.github.io/zuo.github.io/post/elasticsearch/">
              <h3 class="post-title">
                Elasticsearch
              </h3>
            </a>
          </div>
        

        

        <div class="site-footer">
  Powered by <a href="https://github.com/getgridea/gridea" target="_blank">zuozuozuo</a>
  <a class="rss" href="https://zuolinlin.github.io/zuo.github.io//atom.xml" target="_blank">
    <i class="ri-rss-line"></i> RSS
  </a>
</div>

      </div>
    </div>

    <script>
      hljs.initHighlightingOnLoad()

      let mainNavLinks = document.querySelectorAll(".markdownIt-TOC a");

      // This should probably be throttled.
      // Especially because it triggers during smooth scrolling.
      // https://lodash.com/docs/4.17.10#throttle
      // You could do like...
      // window.addEventListener("scroll", () => {
      //    _.throttle(doThatStuff, 100);
      // });
      // Only not doing it here to keep this Pen dependency-free.

      window.addEventListener("scroll", event => {
        let fromTop = window.scrollY;

        mainNavLinks.forEach((link, index) => {
          let section = document.getElementById(decodeURI(link.hash).substring(1));
          let nextSection = null
          if (mainNavLinks[index + 1]) {
            nextSection = document.getElementById(decodeURI(mainNavLinks[index + 1].hash).substring(1));
          }
          if (section.offsetTop <= fromTop) {
            if (nextSection) {
              if (nextSection.offsetTop > fromTop) {
                link.classList.add("current");
              } else {
                link.classList.remove("current");    
              }
            } else {
              link.classList.add("current");
            }
          } else {
            link.classList.remove("current");
          }
        });
      });

    </script>
  </body>
</html>
